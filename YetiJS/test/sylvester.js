function Vector(){}function Matrix(){}function Line(){}function Plane(){}var Sylvester={version:"0.1.3",precision:1e-6};Vector.prototype={e:function(a){return a<1||a>this.elements.length?null:this.elements[a-1]},dimensions:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},eql:function(a){var b=this.elements.length;var c=a.elements||a;if(b!=c.length){return false}do{if(Math.abs(this.elements[b-1]-c[b-1])>Sylvester.precision){return false}}while(--b);return true},dup:function(){return Vector.create(this.elements)},map:function(a){var b=[];this.each(function(c,d){b.push(a(c,d))});return Vector.create(b)},each:function(a){var b=this.elements.length,c=b,d;do{d=c-b;a(this.elements[d],d+1)}while(--b)},toUnitVector:function(){var a=this.modulus();if(a===0){return this.dup()}return this.map(function(b){return b/a})},angleFrom:function(a){var b=a.elements||a;var c=this.elements.length,d=c,e;if(c!=b.length){return null}var f=0,g=0,h=0;this.each(function(a,c){f+=a*b[c-1];g+=a*a;h+=b[c-1]*b[c-1]});g=Math.sqrt(g);h=Math.sqrt(h);if(g*h===0){return null}var i=f/(g*h);if(i<-1){i=-1}if(i>1){i=1}return Math.acos(i)},isParallelTo:function(a){var b=this.angleFrom(a);return b===null?null:b<=Sylvester.precision},isAntiparallelTo:function(a){var b=this.angleFrom(a);return b===null?null:Math.abs(b-Math.PI)<=Sylvester.precision},isPerpendicularTo:function(a){var b=this.dot(a);return b===null?null:Math.abs(b)<=Sylvester.precision},add:function(a){var b=a.elements||a;if(this.elements.length!=b.length){return null}return this.map(function(a,c){return a+b[c-1]})},subtract:function(a){var b=a.elements||a;if(this.elements.length!=b.length){return null}return this.map(function(a,c){return a-b[c-1]})},multiply:function(a){return this.map(function(b){return b*a})},x:function(){return this.elements[0]},y:function(){return this.elements[1]},z:function(){return this.elements[2]},setX:function(a){this.elements[0]=a},setY:function(a){this.elements[1]=a},setZ:function(a){this.elements[2]=a},dot:function(a){var b=a.elements||a;var c,d=0,e=this.elements.length;if(e!=b.length){return null}do{d+=this.elements[e-1]*b[e-1]}while(--e);return d},cross:function(a){var b=a.elements||a;if(this.elements.length!=3||b.length!=3){return null}var c=this.elements;return Vector.create([c[1]*b[2]-c[2]*b[1],c[2]*b[0]-c[0]*b[2],c[0]*b[1]-c[1]*b[0]])},max:function(){var a=0,b=this.elements.length,c=b,d;do{d=c-b;if(Math.abs(this.elements[d])>Math.abs(a)){a=this.elements[d]}}while(--b);return a},indexOf:function(a){var b=null,c=this.elements.length,d=c,e;do{e=d-c;if(b===null&&this.elements[e]==a){b=e+1}}while(--c);return b},toDiagonalMatrix:function(){return Matrix.Diagonal(this.elements)},round:function(){return this.map(function(a){return Math.round(a)})},snapTo:function(a){return this.map(function(b){return Math.abs(b-a)<=Sylvester.precision?a:b})},distanceFrom:function(a){if(a.anchor){return a.distanceFrom(this)}var b=a.elements||a;if(b.length!=this.elements.length){return null}var c=0,d;this.each(function(a,e){d=a-b[e-1];c+=d*d});return Math.sqrt(c)},liesOn:function(a){return a.contains(this)},liesIn:function(a){return a.contains(this)},rotate:function(a,b){var c,d,e,f,g;switch(this.elements.length){case 2:c=b.elements||b;if(c.length!=2){return null}d=Matrix.Rotation(a).elements;e=this.elements[0]-c[0];f=this.elements[1]-c[1];return Vector.create([c[0]+d[0][0]*e+d[0][1]*f,c[1]+d[1][0]*e+d[1][1]*f]);break;case 3:if(!b.direction){return null}var h=b.pointClosestTo(this).elements;d=Matrix.Rotation(a,b.direction).elements;e=this.elements[0]-h[0];f=this.elements[1]-h[1];g=this.elements[2]-h[2];return Vector.create([h[0]+d[0][0]*e+d[0][1]*f+d[0][2]*g,h[1]+d[1][0]*e+d[1][1]*f+d[1][2]*g,h[2]+d[2][0]*e+d[2][1]*f+d[2][2]*g]);break;default:return null}},reflectionIn:function(a){if(a.anchor){var b=this.elements.slice();var c=a.pointClosestTo(b).elements;return Vector.create([c[0]+(c[0]-b[0]),c[1]+(c[1]-b[1]),c[2]+(c[2]-(b[2]||0))])}else{var d=a.elements||a;if(this.elements.length!=d.length){return null}return this.map(function(a,b){return d[b-1]+(d[b-1]-a)})}},to3D:function(){var a=this.dup();switch(a.elements.length){case 3:break;case 2:a.elements.push(0);break;default:return null}return a},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(a){this.elements=(a.elements||a).slice();return this}};Vector.create=function(a){var b=new Vector;return b.setElements(a)};Vector.i=Vector.create([1,0,0]);Vector.j=Vector.create([0,1,0]);Vector.k=Vector.create([0,0,1]);Vector.Random=function(a){var b=[];do{b.push(Math.random())}while(--a);return Vector.create(b)};Vector.Zero=function(a){var b=[];do{b.push(0)}while(--a);return Vector.create(b)};Matrix.prototype={e:function(a,b){if(a<1||a>this.elements.length||b<1||b>this.elements[0].length){return null}return this.elements[a-1][b-1]},row:function(a){if(a>this.elements.length){return null}return Vector.create(this.elements[a-1])},col:function(a){if(a>this.elements[0].length){return null}var b=[],c=this.elements.length,d=c,e;do{e=d-c;b.push(this.elements[e][a-1])}while(--c);return Vector.create(b)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},cols:function(){return this.elements[0].length},eql:function(a){var b=a.elements||a;if(typeof b[0][0]=="undefined"){b=Matrix.create(b).elements}if(this.elements.length!=b.length||this.elements[0].length!=b[0].length){return false}var c=this.elements.length,d=c,e,f,g=this.elements[0].length,h;do{e=d-c;f=g;do{h=g-f;if(Math.abs(this.elements[e][h]-b[e][h])>Sylvester.precision){return false}}while(--f)}while(--c);return true},dup:function(){return Matrix.create(this.elements)},map:function(a){var b=[],c=this.elements.length,d=c,e,f,g=this.elements[0].length,h;do{e=d-c;f=g;b[e]=[];do{h=g-f;b[e][h]=a(this.elements[e][h],e+1,h+1)}while(--f)}while(--c);return Matrix.create(b)},isSameSizeAs:function(a){var b=a.elements||a;if(typeof b[0][0]=="undefined"){b=Matrix.create(b).elements}return this.elements.length==b.length&&this.elements[0].length==b[0].length},add:function(a){var b=a.elements||a;if(typeof b[0][0]=="undefined"){b=Matrix.create(b).elements}if(!this.isSameSizeAs(b)){return null}return this.map(function(a,c,d){return a+b[c-1][d-1]})},subtract:function(a){var b=a.elements||a;if(typeof b[0][0]=="undefined"){b=Matrix.create(b).elements}if(!this.isSameSizeAs(b)){return null}return this.map(function(a,c,d){return a-b[c-1][d-1]})},canMultiplyFromLeft:function(a){var b=a.elements||a;if(typeof b[0][0]=="undefined"){b=Matrix.create(b).elements}return this.elements[0].length==b.length},multiply:function(a){if(!a.elements){return this.map(function(b){return b*a})}var b=a.modulus?true:false;var c=a.elements||a;if(typeof c[0][0]=="undefined"){c=Matrix.create(c).elements}if(!this.canMultiplyFromLeft(c)){return null}var d=this.elements.length,e=d,f,g,h=c[0].length,i;var j=this.elements[0].length,k=[],l,m,n;do{f=e-d;k[f]=[];g=h;do{i=h-g;l=0;m=j;do{n=j-m;l+=this.elements[f][n]*c[n][i]}while(--m);k[f][i]=l}while(--g)}while(--d);var c=Matrix.create(k);return b?c.col(1):c},x:function(a){return this.multiply(a)},minor:function(a,b,c,d){var e=[],f=c,g,h,i;var j=this.elements.length,k=this.elements[0].length;do{g=c-f;e[g]=[];h=d;do{i=d-h;e[g][i]=this.elements[(a+g-1)%j][(b+i-1)%k]}while(--h)}while(--f);return Matrix.create(e)},transpose:function(){var a=this.elements.length,b=this.elements[0].length;var c=[],d=b,e,f,g;do{e=b-d;c[e]=[];f=a;do{g=a-f;c[e][g]=this.elements[g][e]}while(--f)}while(--d);return Matrix.create(c)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){var a=0,b=this.elements.length,c=b,d,e,f=this.elements[0].length,g;do{d=c-b;e=f;do{g=f-e;if(Math.abs(this.elements[d][g])>Math.abs(a)){a=this.elements[d][g]}}while(--e)}while(--b);return a},indexOf:function(a){var b=null,c=this.elements.length,d=c,e,f,g=this.elements[0].length,h;do{e=d-c;f=g;do{h=g-f;if(this.elements[e][h]==a){return{i:e+1,j:h+1}}}while(--f)}while(--c);return null},diagonal:function(){if(!this.isSquare){return null}var a=[],b=this.elements.length,c=b,d;do{d=c-b;a.push(this.elements[d][d])}while(--b);return Vector.create(a)},toRightTriangular:function(){var a=this.dup(),b;var c=this.elements.length,d=c,e,f,g=this.elements[0].length,h;do{e=d-c;if(a.elements[e][e]==0){for(j=e+1;j<d;j++){if(a.elements[j][e]!=0){b=[];f=g;do{h=g-f;b.push(a.elements[e][h]+a.elements[j][h])}while(--f);a.elements[e]=b;break}}}if(a.elements[e][e]!=0){for(j=e+1;j<d;j++){var i=a.elements[j][e]/a.elements[e][e];b=[];f=g;do{h=g-f;b.push(h<=e?0:a.elements[j][h]-a.elements[e][h]*i)}while(--f);a.elements[j]=b}}}while(--c);return a},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare()){return null}var a=this.toRightTriangular();var b=a.elements[0][0],c=a.elements.length-1,d=c,e;do{e=d-c+1;b=b*a.elements[e][e]}while(--c);return b},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&this.determinant()===0},trace:function(){if(!this.isSquare()){return null}var a=this.elements[0][0],b=this.elements.length-1,c=b,d;do{d=c-b+1;a+=this.elements[d][d]}while(--b);return a},tr:function(){return this.trace()},rank:function(){var a=this.toRightTriangular(),b=0;var c=this.elements.length,d=c,e,f,g=this.elements[0].length,h;do{e=d-c;f=g;do{h=g-f;if(Math.abs(a.elements[e][h])>Sylvester.precision){b++;break}}while(--f)}while(--c);return b},rk:function(){return this.rank()},augment:function(a){var b=a.elements||a;if(typeof b[0][0]=="undefined"){b=Matrix.create(b).elements}var c=this.dup(),d=c.elements[0].length;var e=c.elements.length,f=e,g,h,i=b[0].length,j;if(e!=b.length){return null}do{g=f-e;h=i;do{j=i-h;c.elements[g][d+j]=b[g][j]}while(--h)}while(--e);return c},inverse:function(){if(!this.isSquare()||this.isSingular()){return null}var a=this.elements.length,b=a,c,d;var e=this.augment(Matrix.I(a)).toRightTriangular();var f,g=e.elements[0].length,h,i,j;var k=[],l;do{c=a-1;i=[];f=g;k[c]=[];j=e.elements[c][c];do{h=g-f;l=e.elements[c][h]/j;i.push(l);if(h>=b){k[c].push(l)}}while(--f);e.elements[c]=i;for(d=0;d<c;d++){i=[];f=g;do{h=g-f;i.push(e.elements[d][h]-e.elements[c][h]*e.elements[d][c])}while(--f);e.elements[d]=i}}while(--a);return Matrix.create(k)},inv:function(){return this.inverse()},round:function(){return this.map(function(a){return Math.round(a)})},snapTo:function(a){return this.map(function(b){return Math.abs(b-a)<=Sylvester.precision?a:b})},inspect:function(){var a=[];var b=this.elements.length,c=b,d;do{d=c-b;a.push(Vector.create(this.elements[d]).inspect())}while(--b);return a.join("\n")},setElements:function(a){var b,c=a.elements||a;if(typeof c[0][0]!="undefined"){var d=c.length,e=d,f,g,h;this.elements=[];do{b=e-d;f=c[b].length;g=f;this.elements[b]=[];do{h=g-f;this.elements[b][h]=c[b][h]}while(--f)}while(--d);return this}var i=c.length,j=i;this.elements=[];do{b=j-i;this.elements.push([c[b]])}while(--i);return this}};Matrix.create=function(a){var b=new Matrix;return b.setElements(a)};Matrix.I=function(a){var b=[],c=a,d,e,f;do{d=c-a;b[d]=[];e=c;do{f=c-e;b[d][f]=d==f?1:0}while(--e)}while(--a);return Matrix.create(b)};Matrix.Diagonal=function(a){var b=a.length,c=b,d;var e=Matrix.I(b);do{d=c-b;e.elements[d][d]=a[d]}while(--b);return e};Matrix.Rotation=function(a,b){if(!b){return Matrix.create([[Math.cos(a),-Math.sin(a)],[Math.sin(a),Math.cos(a)]])}var c=b.dup();if(c.elements.length!=3){return null}var d=c.modulus();var e=c.elements[0]/d,f=c.elements[1]/d,g=c.elements[2]/d;var h=Math.sin(a),i=Math.cos(a),j=1-i;return Matrix.create([[j*e*e+i,j*e*f-h*g,j*e*g+h*f],[j*e*f+h*g,j*f*f+i,j*f*g-h*e],[j*e*g-h*f,j*f*g+h*e,j*g*g+i]])};Matrix.RotationX=function(a){var b=Math.cos(a),c=Math.sin(a);return Matrix.create([[1,0,0],[0,b,-c],[0,c,b]])};Matrix.RotationY=function(a){var b=Math.cos(a),c=Math.sin(a);return Matrix.create([[b,0,c],[0,1,0],[-c,0,b]])};Matrix.RotationZ=function(a){var b=Math.cos(a),c=Math.sin(a);return Matrix.create([[b,-c,0],[c,b,0],[0,0,1]])};Matrix.Random=function(a,b){return Matrix.Zero(a,b).map(function(){return Math.random()})};Matrix.Zero=function(a,b){var c=[],d=a,e,f,g;do{e=a-d;c[e]=[];f=b;do{g=b-f;c[e][g]=0}while(--f)}while(--d);return Matrix.create(c)};Line.prototype={eql:function(a){return this.isParallelTo(a)&&this.contains(a.anchor)},dup:function(){return Line.create(this.anchor,this.direction)},translate:function(a){var b=a.elements||a;return Line.create([this.anchor.elements[0]+b[0],this.anchor.elements[1]+b[1],this.anchor.elements[2]+(b[2]||0)],this.direction)},isParallelTo:function(a){if(a.normal){return a.isParallelTo(this)}var b=this.direction.angleFrom(a.direction);return Math.abs(b)<=Sylvester.precision||Math.abs(b-Math.PI)<=Sylvester.precision},distanceFrom:function(a){if(a.normal){return a.distanceFrom(this)}if(a.direction){if(this.isParallelTo(a)){return this.distanceFrom(a.anchor)}var b=this.direction.cross(a.direction).toUnitVector().elements;var c=this.anchor.elements,d=a.anchor.elements;return Math.abs((c[0]-d[0])*b[0]+(c[1]-d[1])*b[1]+(c[2]-d[2])*b[2])}else{var e=a.elements||a;var c=this.anchor.elements,f=this.direction.elements;var g=e[0]-c[0],h=e[1]-c[1],i=(e[2]||0)-c[2];var j=Math.sqrt(g*g+h*h+i*i);if(j===0)return 0;var k=(g*f[0]+h*f[1]+i*f[2])/j;var l=1-k*k;return Math.abs(j*Math.sqrt(l<0?0:l))}},contains:function(a){var b=this.distanceFrom(a);return b!==null&&b<=Sylvester.precision},liesIn:function(a){return a.contains(this)},intersects:function(a){if(a.normal){return a.intersects(this)}return!this.isParallelTo(a)&&this.distanceFrom(a)<=Sylvester.precision},intersectionWith:function(a){if(a.normal){return a.intersectionWith(this)}if(!this.intersects(a)){return null}var b=this.anchor.elements,c=this.direction.elements,d=a.anchor.elements,e=a.direction.elements;var f=c[0],g=c[1],h=c[2],i=e[0],j=e[1],k=e[2];var l=b[0]-d[0],m=b[1]-d[1],n=b[2]-d[2];var o=-f*l-g*m-h*n;var p=i*l+j*m+k*n;var q=f*f+g*g+h*h;var r=i*i+j*j+k*k;var s=f*i+g*j+h*k;var t=(o*r/q+s*p)/(r-s*s);return Vector.create([b[0]+t*f,b[1]+t*g,b[2]+t*h])},pointClosestTo:function(a){if(a.direction){if(this.intersects(a)){return this.intersectionWith(a)}if(this.isParallelTo(a)){return null}var b=this.direction.elements,c=a.direction.elements;var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];var j=f*g-d*i,k=d*h-e*g,l=e*i-f*h;var m=Vector.create([j*i-k*h,k*g-l*i,l*h-j*g]);var n=Plane.create(a.anchor,m);return n.intersectionWith(this)}else{var n=a.elements||a;if(this.contains(n)){return Vector.create(n)}var o=this.anchor.elements,b=this.direction.elements;var d=b[0],e=b[1],f=b[2],p=o[0],q=o[1],r=o[2];var j=d*(n[1]-q)-e*(n[0]-p),k=e*((n[2]||0)-r)-f*(n[1]-q),l=f*(n[0]-p)-d*((n[2]||0)-r);var s=Vector.create([e*j-f*l,f*k-d*j,d*l-e*k]);var t=this.distanceFrom(n)/s.modulus();return Vector.create([n[0]+s.elements[0]*t,n[1]+s.elements[1]*t,(n[2]||0)+s.elements[2]*t])}},rotate:function(a,b){if(typeof b.direction=="undefined"){b=Line.create(b.to3D(),Vector.k)}var c=Matrix.Rotation(a,b.direction).elements;var d=b.pointClosestTo(this.anchor).elements;var e=this.anchor.elements,f=this.direction.elements;var g=d[0],h=d[1],i=d[2],j=e[0],k=e[1],l=e[2];var m=j-g,n=k-h,o=l-i;return Line.create([g+c[0][0]*m+c[0][1]*n+c[0][2]*o,h+c[1][0]*m+c[1][1]*n+c[1][2]*o,i+c[2][0]*m+c[2][1]*n+c[2][2]*o],[c[0][0]*f[0]+c[0][1]*f[1]+c[0][2]*f[2],c[1][0]*f[0]+c[1][1]*f[1]+c[1][2]*f[2],c[2][0]*f[0]+c[2][1]*f[1]+c[2][2]*f[2]])},reflectionIn:function(a){if(a.normal){var b=this.anchor.elements,c=this.direction.elements;var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];var j=this.anchor.reflectionIn(a).elements;var k=d+g,l=e+h,m=f+i;var n=a.pointClosestTo([k,l,m]).elements;var o=[n[0]+(n[0]-k)-j[0],n[1]+(n[1]-l)-j[1],n[2]+(n[2]-m)-j[2]];return Line.create(j,o)}else if(a.direction){return this.rotate(Math.PI,a)}else{var p=a.elements||a;return Line.create(this.anchor.reflectionIn([p[0],p[1],p[2]||0]),this.direction)}},setVectors:function(a,b){a=Vector.create(a);b=Vector.create(b);if(a.elements.length==2){a.elements.push(0)}if(b.elements.length==2){b.elements.push(0)}if(a.elements.length>3||b.elements.length>3){return null}var c=b.modulus();if(c===0){return null}this.anchor=a;this.direction=Vector.create([b.elements[0]/c,b.elements[1]/c,b.elements[2]/c]);return this}};Line.create=function(a,b){var c=new Line;return c.setVectors(a,b)};Line.X=Line.create(Vector.Zero(3),Vector.i);Line.Y=Line.create(Vector.Zero(3),Vector.j);Line.Z=Line.create(Vector.Zero(3),Vector.k);Plane.prototype={eql:function(a){return this.contains(a.anchor)&&this.isParallelTo(a)},dup:function(){return Plane.create(this.anchor,this.normal)},translate:function(a){var b=a.elements||a;return Plane.create([this.anchor.elements[0]+b[0],this.anchor.elements[1]+b[1],this.anchor.elements[2]+(b[2]||0)],this.normal)},isParallelTo:function(a){var b;if(a.normal){b=this.normal.angleFrom(a.normal);return Math.abs(b)<=Sylvester.precision||Math.abs(Math.PI-b)<=Sylvester.precision}else if(a.direction){return this.normal.isPerpendicularTo(a.direction)}return null},isPerpendicularTo:function(a){var b=this.normal.angleFrom(a.normal);return Math.abs(Math.PI/2-b)<=Sylvester.precision},distanceFrom:function(a){if(this.intersects(a)||this.contains(a)){return 0}if(a.anchor){var b=this.anchor.elements,c=a.anchor.elements,d=this.normal.elements;return Math.abs((b[0]-c[0])*d[0]+(b[1]-c[1])*d[1]+(b[2]-c[2])*d[2])}else{var e=a.elements||a;var b=this.anchor.elements,d=this.normal.elements;return Math.abs((b[0]-e[0])*d[0]+(b[1]-e[1])*d[1]+(b[2]-(e[2]||0))*d[2])}},contains:function(a){if(a.normal){return null}if(a.direction){return this.contains(a.anchor)&&this.contains(a.anchor.add(a.direction))}else{var b=a.elements||a;var c=this.anchor.elements,d=this.normal.elements;var e=Math.abs(d[0]*(c[0]-b[0])+d[1]*(c[1]-b[1])+d[2]*(c[2]-(b[2]||0)));return e<=Sylvester.precision}},intersects:function(a){if(typeof a.direction=="undefined"&&typeof a.normal=="undefined"){return null}return!this.isParallelTo(a)},intersectionWith:function(a){if(!this.intersects(a)){return null}if(a.direction){var b=a.anchor.elements,c=a.direction.elements,d=this.anchor.elements,e=this.normal.elements;var f=(e[0]*(d[0]-b[0])+e[1]*(d[1]-b[1])+e[2]*(d[2]-b[2]))/(e[0]*c[0]+e[1]*c[1]+e[2]*c[2]);return Vector.create([b[0]+c[0]*f,b[1]+c[1]*f,b[2]+c[2]*f])}else if(a.normal){var g=this.normal.cross(a.normal).toUnitVector();var e=this.normal.elements,b=this.anchor.elements,h=a.normal.elements,i=a.anchor.elements;var j=Matrix.Zero(2,2),k=0;while(j.isSingular()){k++;j=Matrix.create([[e[k%3],e[(k+1)%3]],[h[k%3],h[(k+1)%3]]])}var l=j.inverse().elements;var m=e[0]*b[0]+e[1]*b[1]+e[2]*b[2];var n=h[0]*i[0]+h[1]*i[1]+h[2]*i[2];var o=[l[0][0]*m+l[0][1]*n,l[1][0]*m+l[1][1]*n];var p=[];for(var q=1;q<=3;q++){p.push(k==q?0:o[(q+(5-k)%3)%3])}return Line.create(p,g)}},pointClosestTo:function(a){var b=a.elements||a;var c=this.anchor.elements,d=this.normal.elements;var e=(c[0]-b[0])*d[0]+(c[1]-b[1])*d[1]+(c[2]-(b[2]||0))*d[2];return Vector.create([b[0]+d[0]*e,b[1]+d[1]*e,(b[2]||0)+d[2]*e])},rotate:function(a,b){var c=Matrix.Rotation(a,b.direction).elements;var d=b.pointClosestTo(this.anchor).elements;var e=this.anchor.elements,f=this.normal.elements;var g=d[0],h=d[1],i=d[2],j=e[0],k=e[1],l=e[2];var m=j-g,n=k-h,o=l-i;return Plane.create([g+c[0][0]*m+c[0][1]*n+c[0][2]*o,h+c[1][0]*m+c[1][1]*n+c[1][2]*o,i+c[2][0]*m+c[2][1]*n+c[2][2]*o],[c[0][0]*f[0]+c[0][1]*f[1]+c[0][2]*f[2],c[1][0]*f[0]+c[1][1]*f[1]+c[1][2]*f[2],c[2][0]*f[0]+c[2][1]*f[1]+c[2][2]*f[2]])},reflectionIn:function(a){if(a.normal){var b=this.anchor.elements,c=this.normal.elements;var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];var j=this.anchor.reflectionIn(a).elements;var k=d+g,l=e+h,m=f+i;var n=a.pointClosestTo([k,l,m]).elements;var o=[n[0]+(n[0]-k)-j[0],n[1]+(n[1]-l)-j[1],n[2]+(n[2]-m)-j[2]];return Plane.create(j,o)}else if(a.direction){return this.rotate(Math.PI,a)}else{var p=a.elements||a;return Plane.create(this.anchor.reflectionIn([p[0],p[1],p[2]||0]),this.normal)}},setVectors:function(a,b,c){a=Vector.create(a);a=a.to3D();if(a===null){return null}b=Vector.create(b);b=b.to3D();if(b===null){return null}if(typeof c=="undefined"){c=null}else{c=Vector.create(c);c=c.to3D();if(c===null){return null}}var d=a.elements[0],e=a.elements[1],f=a.elements[2];var g=b.elements[0],h=b.elements[1],i=b.elements[2];var j,k;if(c!==null){var l=c.elements[0],m=c.elements[1],n=c.elements[2];j=Vector.create([(h-e)*(n-f)-(i-f)*(m-e),(i-f)*(l-d)-(g-d)*(n-f),(g-d)*(m-e)-(h-e)*(l-d)]);k=j.modulus();if(k===0){return null}j=Vector.create([j.elements[0]/k,j.elements[1]/k,j.elements[2]/k])}else{k=Math.sqrt(g*g+h*h+i*i);if(k===0){return null}j=Vector.create([b.elements[0]/k,b.elements[1]/k,b.elements[2]/k])}this.anchor=a;this.normal=j;return this}};Plane.create=function(a,b,c){var d=new Plane;return d.setVectors(a,b,c)};Plane.XY=Plane.create(Vector.Zero(3),Vector.k);Plane.YZ=Plane.create(Vector.Zero(3),Vector.i);Plane.ZX=Plane.create(Vector.Zero(3),Vector.j);Plane.YX=Plane.XY;Plane.ZY=Plane.YZ;Plane.XZ=Plane.ZX;var $V=Vector.create;var $M=Matrix.create;var $L=Line.create;var $P=Plane.create