var Box2D={};(function(c,b){function a(){}if(!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function){Object.defineProperty=function(f,e,d){d.get instanceof Function&&f.__defineGetter__(e,d.get);d.set instanceof Function&&f.__defineSetter__(e,d.set)}}c.inherit=function(e,d){a.prototype=d.prototype;e.prototype=new a;e.prototype.constructor=e};c.generateCallback=function(e,d){return function(){d.apply(e,arguments)}};c.NVector=function(f){if(f===b){f=0}for(var e=Array(f||0),d=0;d<f;++d){e[d]=0}return e};c.is=function(e,d){if(e===null){return false}if(d instanceof Function&&e instanceof d){return true}if(e.constructor.__implements!=b&&e.constructor.__implements[d]){return true}return false};c.parseUInt=function(d){return Math.abs(parseInt(d))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;if(typeof Box2D==="undefined"){Box2D={}}if(typeof Box2D.Collision==="undefined"){Box2D.Collision={}}if(typeof Box2D.Collision.Shapes==="undefined"){Box2D.Collision.Shapes={}}if(typeof Box2D.Common==="undefined"){Box2D.Common={}}if(typeof Box2D.Common.Math==="undefined"){Box2D.Common.Math={}}if(typeof Box2D.Dynamics==="undefined"){Box2D.Dynamics={}}if(typeof Box2D.Dynamics.Contacts==="undefined"){Box2D.Dynamics.Contacts={}}if(typeof Box2D.Dynamics.Controllers==="undefined"){Box2D.Dynamics.Controllers={}}if(typeof Box2D.Dynamics.Joints==="undefined"){Box2D.Dynamics.Joints={}}(function(){function bp(){bp.b2AABB.apply(this,arguments)}function bo(){bo.b2Bound.apply(this,arguments)}function bi(){bi.b2BoundValues.apply(this,arguments);this.constructor===bi&&this.b2BoundValues.apply(this,arguments)}function au(){au.b2Collision.apply(this,arguments)}function ax(){ax.b2ContactID.apply(this,arguments);this.constructor===ax&&this.b2ContactID.apply(this,arguments)}function bw(){bw.b2ContactPoint.apply(this,arguments)}function a6(){a6.b2Distance.apply(this,arguments)}function aE(){aE.b2DistanceInput.apply(this,arguments)}function bv(){bv.b2DistanceOutput.apply(this,arguments)}function bb(){bb.b2DistanceProxy.apply(this,arguments)}function a5(){a5.b2DynamicTree.apply(this,arguments);this.constructor===a5&&this.b2DynamicTree.apply(this,arguments)}function bg(){bg.b2DynamicTreeBroadPhase.apply(this,arguments)}function bh(){bh.b2DynamicTreeNode.apply(this,arguments)}function bm(){bm.b2DynamicTreePair.apply(this,arguments)}function a4(){a4.b2Manifold.apply(this,arguments);this.constructor===a4&&this.b2Manifold.apply(this,arguments)}function a2(){a2.b2ManifoldPoint.apply(this,arguments);this.constructor===a2&&this.b2ManifoldPoint.apply(this,arguments)}function aK(){aK.b2Point.apply(this,arguments)}function at(){at.b2RayCastInput.apply(this,arguments);this.constructor===at&&this.b2RayCastInput.apply(this,arguments)}function az(){az.b2RayCastOutput.apply(this,arguments)}function bs(){bs.b2Segment.apply(this,arguments)}function bn(){bn.b2SeparationFunction.apply(this,arguments)}function be(){be.b2Simplex.apply(this,arguments);this.constructor===be&&this.b2Simplex.apply(this,arguments)}function br(){br.b2SimplexCache.apply(this,arguments)}function a9(){a9.b2SimplexVertex.apply(this,arguments)}function bf(){bf.b2TimeOfImpact.apply(this,arguments)}function a8(){a8.b2TOIInput.apply(this,arguments)}function bB(){bB.b2WorldManifold.apply(this,arguments);this.constructor===bB&&this.b2WorldManifold.apply(this,arguments)}function a0(){a0.ClipVertex.apply(this,arguments)}function aT(){aT.Features.apply(this,arguments)}function aO(){aO.b2CircleShape.apply(this,arguments);this.constructor===aO&&this.b2CircleShape.apply(this,arguments)}function aJ(){aJ.b2EdgeChainDef.apply(this,arguments);this.constructor===aJ&&this.b2EdgeChainDef.apply(this,arguments)}function aL(){aL.b2EdgeShape.apply(this,arguments);this.constructor===aL&&this.b2EdgeShape.apply(this,arguments)}function aF(){aF.b2MassData.apply(this,arguments)}function aD(){aD.b2PolygonShape.apply(this,arguments);this.constructor===aD&&this.b2PolygonShape.apply(this,arguments)}function aG(){aG.b2Shape.apply(this,arguments);this.constructor===aG&&this.b2Shape.apply(this,arguments)}function aX(){aX.b2Color.apply(this,arguments);this.constructor===aX&&this.b2Color.apply(this,arguments)}function aU(){aU.b2Settings.apply(this,arguments)}function aP(){aP.b2Mat22.apply(this,arguments);this.constructor===aP&&this.b2Mat22.apply(this,arguments)}function aW(){aW.b2Mat33.apply(this,arguments);this.constructor===aW&&this.b2Mat33.apply(this,arguments)}function aR(){aR.b2Math.apply(this,arguments)}function aQ(){aQ.b2Sweep.apply(this,arguments)}function aI(){aI.b2Transform.apply(this,arguments);this.constructor===aI&&this.b2Transform.apply(this,arguments)}function aC(){aC.b2Vec2.apply(this,arguments);this.constructor===aC&&this.b2Vec2.apply(this,arguments)}function aB(){aB.b2Vec3.apply(this,arguments);this.constructor===aB&&this.b2Vec3.apply(this,arguments)}function ay(){ay.b2Body.apply(this,arguments);this.constructor===ay&&this.b2Body.apply(this,arguments)}function aA(){aA.b2BodyDef.apply(this,arguments);this.constructor===aA&&this.b2BodyDef.apply(this,arguments)}function aw(){aw.b2ContactFilter.apply(this,arguments)}function bu(){bu.b2ContactImpulse.apply(this,arguments)}function bj(){bj.b2ContactListener.apply(this,arguments)}function a7(){a7.b2ContactManager.apply(this,arguments);this.constructor===a7&&this.b2ContactManager.apply(this,arguments)}function bc(){bc.b2DebugDraw.apply(this,arguments);this.constructor===bc&&this.b2DebugDraw.apply(this,arguments)}function a3(){a3.b2DestructionListener.apply(this,arguments)}function bG(){bG.b2FilterData.apply(this,arguments)}function bd(){bd.b2Fixture.apply(this,arguments);this.constructor===bd&&this.b2Fixture.apply(this,arguments)}function aH(){aH.b2FixtureDef.apply(this,arguments);this.constructor===aH&&this.b2FixtureDef.apply(this,arguments)}function al(){al.b2Island.apply(this,arguments);this.constructor===al&&this.b2Island.apply(this,arguments)}function af(){af.b2TimeStep.apply(this,arguments)}function ad(){ad.b2World.apply(this,arguments);this.constructor===ad&&this.b2World.apply(this,arguments)}function bO(){bO.b2CircleContact.apply(this,arguments)}function bL(){bL.b2Contact.apply(this,arguments);this.constructor===bL&&this.b2Contact.apply(this,arguments)}function bC(){bC.b2ContactConstraint.apply(this,arguments);this.constructor===bC&&this.b2ContactConstraint.apply(this,arguments)}function bF(){bF.b2ContactConstraintPoint.apply(this,arguments)}function bt(){bt.b2ContactEdge.apply(this,arguments)}function bk(){bk.b2ContactFactory.apply(this,arguments);this.constructor===bk&&this.b2ContactFactory.apply(this,arguments)}function aV(){aV.b2ContactRegister.apply(this,arguments)}function ap(){ap.b2ContactResult.apply(this,arguments)}function aM(){aM.b2ContactSolver.apply(this,arguments);this.constructor===aM&&this.b2ContactSolver.apply(this,arguments)}function ah(){ah.b2EdgeAndCircleContact.apply(this,arguments)}function am(){am.b2NullContact.apply(this,arguments);this.constructor===am&&this.b2NullContact.apply(this,arguments)}function bQ(){bQ.b2PolyAndCircleContact.apply(this,arguments)}function bI(){bI.b2PolyAndEdgeContact.apply(this,arguments)}function by(){by.b2PolygonContact.apply(this,arguments)}function ae(){ae.b2PositionSolverManifold.apply(this,arguments);this.constructor===ae&&this.b2PositionSolverManifold.apply(this,arguments)}function aZ(){aZ.b2BuoyancyController.apply(this,arguments)}function ar(){ar.b2ConstantAccelController.apply(this,arguments)}function aj(){aj.b2ConstantForceController.apply(this,arguments)}function ac(){ac.b2Controller.apply(this,arguments)}function bK(){bK.b2ControllerEdge.apply(this,arguments)}function bA(){bA.b2GravityController.apply(this,arguments)}function a1(){a1.b2TensorDampingController.apply(this,arguments)}function bN(){bN.b2DistanceJoint.apply(this,arguments);this.constructor===bN&&this.b2DistanceJoint.apply(this,arguments)}function bE(){bE.b2DistanceJointDef.apply(this,arguments);this.constructor===bE&&this.b2DistanceJointDef.apply(this,arguments)}function bq(){bq.b2FrictionJoint.apply(this,arguments);this.constructor===bq&&this.b2FrictionJoint.apply(this,arguments)}function aS(){aS.b2FrictionJointDef.apply(this,arguments);this.constructor===aS&&this.b2FrictionJointDef.apply(this,arguments)}function ao(){ao.b2GearJoint.apply(this,arguments);this.constructor===ao&&this.b2GearJoint.apply(this,arguments)}function ag(){ag.b2GearJointDef.apply(this,arguments);this.constructor===ag&&this.b2GearJointDef.apply(this,arguments)}function av(){av.b2Jacobian.apply(this,arguments)}function bP(){bP.b2Joint.apply(this,arguments);this.constructor===bP&&this.b2Joint.apply(this,arguments)}function bH(){bH.b2JointDef.apply(this,arguments);this.constructor===bH&&this.b2JointDef.apply(this,arguments)}function ak(){ak.b2JointEdge.apply(this,arguments)}function bx(){bx.b2LineJoint.apply(this,arguments);this.constructor===bx&&this.b2LineJoint.apply(this,arguments)}function aY(){aY.b2LineJointDef.apply(this,arguments);this.constructor===aY&&this.b2LineJointDef.apply(this,arguments)}function aq(){aq.b2MouseJoint.apply(this,arguments);this.constructor===aq&&this.b2MouseJoint.apply(this,arguments)}function ai(){ai.b2MouseJointDef.apply(this,arguments);this.constructor===ai&&this.b2MouseJointDef.apply(this,arguments)}function ab(){ab.b2PrismaticJoint.apply(this,arguments);this.constructor===ab&&this.b2PrismaticJoint.apply(this,arguments)}function bJ(){bJ.b2PrismaticJointDef.apply(this,arguments);this.constructor===bJ&&this.b2PrismaticJointDef.apply(this,arguments)}function bz(){bz.b2PulleyJoint.apply(this,arguments);this.constructor===bz&&this.b2PulleyJoint.apply(this,arguments)}function bM(){bM.b2PulleyJointDef.apply(this,arguments);this.constructor===bM&&this.b2PulleyJointDef.apply(this,arguments)}function bD(){bD.b2RevoluteJoint.apply(this,arguments);this.constructor===bD&&this.b2RevoluteJoint.apply(this,arguments)}function bl(){bl.b2RevoluteJointDef.apply(this,arguments);this.constructor===bl&&this.b2RevoluteJointDef.apply(this,arguments)}function aN(){aN.b2WeldJoint.apply(this,arguments);this.constructor===aN&&this.b2WeldJoint.apply(this,arguments)}function an(){an.b2WeldJointDef.apply(this,arguments);this.constructor===an&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";Box2D.Collision.b2AABB=bp;Box2D.Collision.b2Bound=bo;Box2D.Collision.b2BoundValues=bi;Box2D.Collision.b2Collision=au;Box2D.Collision.b2ContactID=ax;Box2D.Collision.b2ContactPoint=bw;Box2D.Collision.b2Distance=a6;Box2D.Collision.b2DistanceInput=aE;Box2D.Collision.b2DistanceOutput=bv;Box2D.Collision.b2DistanceProxy=bb;Box2D.Collision.b2DynamicTree=a5;Box2D.Collision.b2DynamicTreeBroadPhase=bg;Box2D.Collision.b2DynamicTreeNode=bh;Box2D.Collision.b2DynamicTreePair=bm;Box2D.Collision.b2Manifold=a4;Box2D.Collision.b2ManifoldPoint=a2;Box2D.Collision.b2Point=aK;Box2D.Collision.b2RayCastInput=at;Box2D.Collision.b2RayCastOutput=az;Box2D.Collision.b2Segment=bs;Box2D.Collision.b2SeparationFunction=bn;Box2D.Collision.b2Simplex=be;Box2D.Collision.b2SimplexCache=br;Box2D.Collision.b2SimplexVertex=a9;Box2D.Collision.b2TimeOfImpact=bf;Box2D.Collision.b2TOIInput=a8;Box2D.Collision.b2WorldManifold=bB;Box2D.Collision.ClipVertex=a0;Box2D.Collision.Features=aT;Box2D.Collision.Shapes.b2CircleShape=aO;Box2D.Collision.Shapes.b2EdgeChainDef=aJ;Box2D.Collision.Shapes.b2EdgeShape=aL;Box2D.Collision.Shapes.b2MassData=aF;Box2D.Collision.Shapes.b2PolygonShape=aD;Box2D.Collision.Shapes.b2Shape=aG;Box2D.Common.b2internal="Box2D.Common.b2internal";Box2D.Common.b2Color=aX;Box2D.Common.b2Settings=aU;Box2D.Common.Math.b2Mat22=aP;Box2D.Common.Math.b2Mat33=aW;Box2D.Common.Math.b2Math=aR;Box2D.Common.Math.b2Sweep=aQ;Box2D.Common.Math.b2Transform=aI;Box2D.Common.Math.b2Vec2=aC;Box2D.Common.Math.b2Vec3=aB;Box2D.Dynamics.b2Body=ay;Box2D.Dynamics.b2BodyDef=aA;Box2D.Dynamics.b2ContactFilter=aw;Box2D.Dynamics.b2ContactImpulse=bu;Box2D.Dynamics.b2ContactListener=bj;Box2D.Dynamics.b2ContactManager=a7;Box2D.Dynamics.b2DebugDraw=bc;Box2D.Dynamics.b2DestructionListener=a3;Box2D.Dynamics.b2FilterData=bG;Box2D.Dynamics.b2Fixture=bd;Box2D.Dynamics.b2FixtureDef=aH;Box2D.Dynamics.b2Island=al;Box2D.Dynamics.b2TimeStep=af;Box2D.Dynamics.b2World=ad;Box2D.Dynamics.Contacts.b2CircleContact=bO;Box2D.Dynamics.Contacts.b2Contact=bL;Box2D.Dynamics.Contacts.b2ContactConstraint=bC;Box2D.Dynamics.Contacts.b2ContactConstraintPoint=bF;Box2D.Dynamics.Contacts.b2ContactEdge=bt;Box2D.Dynamics.Contacts.b2ContactFactory=bk;Box2D.Dynamics.Contacts.b2ContactRegister=aV;Box2D.Dynamics.Contacts.b2ContactResult=ap;Box2D.Dynamics.Contacts.b2ContactSolver=aM;Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=ah;Box2D.Dynamics.Contacts.b2NullContact=am;Box2D.Dynamics.Contacts.b2PolyAndCircleContact=bQ;Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=bI;Box2D.Dynamics.Contacts.b2PolygonContact=by;Box2D.Dynamics.Contacts.b2PositionSolverManifold=ae;Box2D.Dynamics.Controllers.b2BuoyancyController=aZ;Box2D.Dynamics.Controllers.b2ConstantAccelController=ar;Box2D.Dynamics.Controllers.b2ConstantForceController=aj;Box2D.Dynamics.Controllers.b2Controller=ac;Box2D.Dynamics.Controllers.b2ControllerEdge=bK;Box2D.Dynamics.Controllers.b2GravityController=bA;Box2D.Dynamics.Controllers.b2TensorDampingController=a1;Box2D.Dynamics.Joints.b2DistanceJoint=bN;Box2D.Dynamics.Joints.b2DistanceJointDef=bE;Box2D.Dynamics.Joints.b2FrictionJoint=bq;Box2D.Dynamics.Joints.b2FrictionJointDef=aS;Box2D.Dynamics.Joints.b2GearJoint=ao;Box2D.Dynamics.Joints.b2GearJointDef=ag;Box2D.Dynamics.Joints.b2Jacobian=av;Box2D.Dynamics.Joints.b2Joint=bP;Box2D.Dynamics.Joints.b2JointDef=bH;Box2D.Dynamics.Joints.b2JointEdge=ak;Box2D.Dynamics.Joints.b2LineJoint=bx;Box2D.Dynamics.Joints.b2LineJointDef=aY;Box2D.Dynamics.Joints.b2MouseJoint=aq;Box2D.Dynamics.Joints.b2MouseJointDef=ai;Box2D.Dynamics.Joints.b2PrismaticJoint=ab;Box2D.Dynamics.Joints.b2PrismaticJointDef=bJ;Box2D.Dynamics.Joints.b2PulleyJoint=bz;Box2D.Dynamics.Joints.b2PulleyJointDef=bM;Box2D.Dynamics.Joints.b2RevoluteJoint=bD;Box2D.Dynamics.Joints.b2RevoluteJointDef=bl;Box2D.Dynamics.Joints.b2WeldJoint=aN;Box2D.Dynamics.Joints.b2WeldJointDef=an})();Box2D.postDefs=[];(function(){var ae=Box2D.Collision.Shapes.b2CircleShape,ad=Box2D.Collision.Shapes.b2PolygonShape,X=Box2D.Collision.Shapes.b2Shape,al=Box2D.Common.b2Settings,am=Box2D.Common.Math.b2Math,ai=Box2D.Common.Math.b2Sweep,r=Box2D.Common.Math.b2Transform,ap=Box2D.Common.Math.b2Vec2,ah=Box2D.Collision.b2AABB,v=Box2D.Collision.b2Bound,m=Box2D.Collision.b2BoundValues,P=Box2D.Collision.b2Collision,T=Box2D.Collision.b2ContactID,ab=Box2D.Collision.b2ContactPoint,f=Box2D.Collision.b2Distance,e=Box2D.Collision.b2DistanceInput,au=Box2D.Collision.b2DistanceOutput,ak=Box2D.Collision.b2DistanceProxy,an=Box2D.Collision.b2DynamicTree,ag=Box2D.Collision.b2DynamicTreeBroadPhase,ac=Box2D.Collision.b2DynamicTreeNode,C=Box2D.Collision.b2DynamicTreePair,af=Box2D.Collision.b2Manifold,t=Box2D.Collision.b2ManifoldPoint,J=Box2D.Collision.b2Point,s=Box2D.Collision.b2RayCastInput,aj=Box2D.Collision.b2RayCastOutput,b=Box2D.Collision.b2Segment,ay=Box2D.Collision.b2SeparationFunction,aw=Box2D.Collision.b2Simplex,at=Box2D.Collision.b2SimplexCache,av=Box2D.Collision.b2SimplexVertex,aq=Box2D.Collision.b2TimeOfImpact,ao=Box2D.Collision.b2TOIInput,ar=Box2D.Collision.b2WorldManifold,aA=Box2D.Collision.ClipVertex,az=Box2D.Collision.Features,ax=Box2D.Collision.IBroadPhase;ah.b2AABB=function(){this.lowerBound=new ap;this.upperBound=new ap};ah.prototype.IsValid=function(){var a=this.upperBound.y-this.lowerBound.y;return a=(a=this.upperBound.x-this.lowerBound.x>=0&&a>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};ah.prototype.GetCenter=function(){return new ap((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};ah.prototype.GetExtents=function(){return new ap((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};ah.prototype.Contains=function(a){var c=true;return c=(c=(c=(c=c&&this.lowerBound.x<=a.lowerBound.x)&&this.lowerBound.y<=a.lowerBound.y)&&a.upperBound.x<=this.upperBound.x)&&a.upperBound.y<=this.upperBound.y};ah.prototype.RayCast=function(l,k){var j=-Number.MAX_VALUE,d=Number.MAX_VALUE,a=k.p1.x,u=k.p1.y,p=k.p2.x-k.p1.x,q=k.p2.y-k.p1.y,o=Math.abs(q),c=l.normal,n=0,g=0,h=n=0;h=0;if(Math.abs(p)<Number.MIN_VALUE){if(a<this.lowerBound.x||this.upperBound.x<a){return false}}else{n=1/p;g=(this.lowerBound.x-a)*n;n=(this.upperBound.x-a)*n;h=-1;if(g>n){h=g;g=n;n=h;h=1}if(g>j){c.x=h;c.y=0;j=g}d=Math.min(d,n);if(j>d){return false}}if(o<Number.MIN_VALUE){if(u<this.lowerBound.y||this.upperBound.y<u){return false}}else{n=1/q;g=(this.lowerBound.y-u)*n;n=(this.upperBound.y-u)*n;h=-1;if(g>n){h=g;g=n;n=h;h=1}if(g>j){c.y=h;c.x=0;j=g}d=Math.min(d,n);if(j>d){return false}}l.fraction=j;return true};ah.prototype.TestOverlap=function(a){var d=a.lowerBound.y-this.upperBound.y,c=this.lowerBound.y-a.upperBound.y;if(a.lowerBound.x-this.upperBound.x>0||d>0){return false}if(this.lowerBound.x-a.upperBound.x>0||c>0){return false}return true};ah.Combine=function(a,d){var c=new ah;c.Combine(a,d);return c};ah.prototype.Combine=function(a,c){this.lowerBound.x=Math.min(a.lowerBound.x,c.lowerBound.x);this.lowerBound.y=Math.min(a.lowerBound.y,c.lowerBound.y);this.upperBound.x=Math.max(a.upperBound.x,c.upperBound.x);this.upperBound.y=Math.max(a.upperBound.y,c.upperBound.y)};v.b2Bound=function(){};v.prototype.IsLower=function(){return(this.value&1)==0};v.prototype.IsUpper=function(){return(this.value&1)==1};v.prototype.Swap=function(c){var g=this.value,d=this.proxy,a=this.stabbingCount;this.value=c.value;this.proxy=c.proxy;this.stabbingCount=c.stabbingCount;c.value=g;c.proxy=d;c.stabbingCount=a};m.b2BoundValues=function(){};m.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};P.b2Collision=function(){};P.ClipSegmentToLine=function(h,g,d,c){if(c===undefined){c=0}var a,n=0;a=g[0];var k=a.v;a=g[1];var l=a.v,j=d.x*k.x+d.y*k.y-c;a=d.x*l.x+d.y*l.y-c;j<=0&&h[n++].Set(g[0]);a<=0&&h[n++].Set(g[1]);if(j*a<0){d=j/(j-a);a=h[n];a=a.v;a.x=k.x+d*(l.x-k.x);a.y=k.y+d*(l.y-k.y);a=h[n];a.id=(j>0?g[0]:g[1]).id;++n}return n};P.EdgeSeparation=function(n,l,k,g,a){if(k===undefined){k=0}parseInt(n.m_vertexCount);var w=n.m_vertices;n=n.m_normals;var q=parseInt(g.m_vertexCount),u=g.m_vertices,p,c;p=l.R;c=n[k];n=p.col1.x*c.x+p.col2.x*c.y;g=p.col1.y*c.x+p.col2.y*c.y;p=a.R;var o=p.col1.x*n+p.col1.y*g;p=p.col2.x*n+p.col2.y*g;for(var h=0,j=Number.MAX_VALUE,d=0;d<q;++d){c=u[d];c=c.x*o+c.y*p;if(c<j){j=c;h=d}}c=w[k];p=l.R;k=l.position.x+(p.col1.x*c.x+p.col2.x*c.y);l=l.position.y+(p.col1.y*c.x+p.col2.y*c.y);c=u[h];p=a.R;w=a.position.x+(p.col1.x*c.x+p.col2.x*c.y);a=a.position.y+(p.col1.y*c.x+p.col2.y*c.y);w-=k;a-=l;return w*n+a*g};P.FindMaxSeparation=function(o,n,l,g,a){var y=parseInt(n.m_vertexCount),u=n.m_normals,w,q;q=a.R;w=g.m_centroid;var c=a.position.x+(q.col1.x*w.x+q.col2.x*w.y),p=a.position.y+(q.col1.y*w.x+q.col2.y*w.y);q=l.R;w=n.m_centroid;c-=l.position.x+(q.col1.x*w.x+q.col2.x*w.y);p-=l.position.y+(q.col1.y*w.x+q.col2.y*w.y);q=c*l.R.col1.x+p*l.R.col1.y;p=c*l.R.col2.x+p*l.R.col2.y;c=0;for(var h=-Number.MAX_VALUE,k=0;k<y;++k){w=u[k];w=w.x*q+w.y*p;if(w>h){h=w;c=k}}u=P.EdgeSeparation(n,l,c,g,a);w=parseInt(c-1>=0?c-1:y-1);q=P.EdgeSeparation(n,l,w,g,a);p=parseInt(c+1<y?c+1:0);h=P.EdgeSeparation(n,l,p,g,a);var d=k=0,j=0;if(q>u&&q>h){j=-1;k=w;d=q}else{if(h>u){j=1;k=p;d=h}else{o[0]=c;return u}}for(;;){c=j==-1?k-1>=0?k-1:y-1:k+1<y?k+1:0;u=P.EdgeSeparation(n,l,c,g,a);if(u>d){k=c;d=u}else{break}}o[0]=k;return d};P.FindIncidentEdge=function(k,j,h,d,a,q){if(d===undefined){d=0}parseInt(j.m_vertexCount);var o=j.m_normals,p=parseInt(a.m_vertexCount);j=a.m_vertices;a=a.m_normals;var n;n=h.R;h=o[d];o=n.col1.x*h.x+n.col2.x*h.y;var c=n.col1.y*h.x+n.col2.y*h.y;n=q.R;h=n.col1.x*o+n.col1.y*c;c=n.col2.x*o+n.col2.y*c;o=h;n=0;for(var l=Number.MAX_VALUE,g=0;g<p;++g){h=a[g];h=o*h.x+c*h.y;if(h<l){l=h;n=g}}a=parseInt(n);o=parseInt(a+1<p?a+1:0);p=k[0];h=j[a];n=q.R;p.v.x=q.position.x+(n.col1.x*h.x+n.col2.x*h.y);p.v.y=q.position.y+(n.col1.y*h.x+n.col2.y*h.y);p.id.features.referenceEdge=d;p.id.features.incidentEdge=a;p.id.features.incidentVertex=0;p=k[1];h=j[o];n=q.R;p.v.x=q.position.x+(n.col1.x*h.x+n.col2.x*h.y);p.v.y=q.position.y+(n.col1.y*h.x+n.col2.y*h.y);p.id.features.referenceEdge=d;p.id.features.incidentEdge=o;p.id.features.incidentVertex=1};P.MakeClipPointVector=function(){var a=new Vector(2);a[0]=new aA;a[1]=new aA;return a};P.CollidePolygons=function(p,n,l,g,a){var z;p.m_pointCount=0;var w=n.m_radius+g.m_radius;z=0;P.s_edgeAO[0]=z;var y=P.FindMaxSeparation(P.s_edgeAO,n,l,g,a);z=P.s_edgeAO[0];if(!(y>w)){var u=0;P.s_edgeBO[0]=u;var c=P.FindMaxSeparation(P.s_edgeBO,g,a,n,l);u=P.s_edgeBO[0];if(!(c>w)){var q=0,h=0;if(c>0.98*y+0.001){y=g;g=n;n=a;l=l;q=u;p.m_type=af.e_faceB;h=1}else{y=n;g=g;n=l;l=a;q=z;p.m_type=af.e_faceA;h=0}z=P.s_incidentEdge;P.FindIncidentEdge(z,y,n,q,g,l);u=parseInt(y.m_vertexCount);a=y.m_vertices;y=a[q];var k;k=q+1<u?a[parseInt(q+1)]:a[0];q=P.s_localTangent;q.Set(k.x-y.x,k.y-y.y);q.Normalize();a=P.s_localNormal;a.x=q.y;a.y=-q.x;g=P.s_planePoint;g.Set(0.5*(y.x+k.x),0.5*(y.y+k.y));c=P.s_tangent;u=n.R;c.x=u.col1.x*q.x+u.col2.x*q.y;c.y=u.col1.y*q.x+u.col2.y*q.y;var d=P.s_tangent2;d.x=-c.x;d.y=-c.y;q=P.s_normal;q.x=c.y;q.y=-c.x;var j=P.s_v11,o=P.s_v12;j.x=n.position.x+(u.col1.x*y.x+u.col2.x*y.y);j.y=n.position.y+(u.col1.y*y.x+u.col2.y*y.y);o.x=n.position.x+(u.col1.x*k.x+u.col2.x*k.y);o.y=n.position.y+(u.col1.y*k.x+u.col2.y*k.y);n=q.x*j.x+q.y*j.y;u=c.x*o.x+c.y*o.y+w;k=P.s_clipPoints1;y=P.s_clipPoints2;o=0;o=P.ClipSegmentToLine(k,z,d,-c.x*j.x-c.y*j.y+w);if(!(o<2)){o=P.ClipSegmentToLine(y,k,c,u);if(!(o<2)){p.m_localPlaneNormal.SetV(a);p.m_localPoint.SetV(g);for(g=a=0;g<al.b2_maxManifoldPoints;++g){z=y[g];if(q.x*z.v.x+q.y*z.v.y-n<=w){c=p.m_points[a];u=l.R;d=z.v.x-l.position.x;j=z.v.y-l.position.y;c.m_localPoint.x=d*u.col1.x+j*u.col1.y;c.m_localPoint.y=d*u.col2.x+j*u.col2.y;c.m_id.Set(z.id);c.m_id.features.flip=h;++a}}p.m_pointCount=a}}}}};P.CollideCircles=function(c,l,k,a,j){c.m_pointCount=0;var h,d;h=k.R;d=l.m_p;var g=k.position.x+(h.col1.x*d.x+h.col2.x*d.y);k=k.position.y+(h.col1.y*d.x+h.col2.y*d.y);h=j.R;d=a.m_p;g=j.position.x+(h.col1.x*d.x+h.col2.x*d.y)-g;j=j.position.y+(h.col1.y*d.x+h.col2.y*d.y)-k;h=l.m_radius+a.m_radius;if(!(g*g+j*j>h*h)){c.m_type=af.e_circles;c.m_localPoint.SetV(l.m_p);c.m_localPlaneNormal.SetZero();c.m_pointCount=1;c.m_points[0].m_localPoint.SetV(a.m_p);c.m_points[0].m_id.key=0}};P.CollidePolygonAndCircle=function(n,l,k,g,a){var w=n.m_pointCount=0,q=0,u,p;p=a.R;u=g.m_p;var c=a.position.y+(p.col1.y*u.x+p.col2.y*u.y);w=a.position.x+(p.col1.x*u.x+p.col2.x*u.y)-k.position.x;q=c-k.position.y;p=k.R;k=w*p.col1.x+q*p.col1.y;p=w*p.col2.x+q*p.col2.y;var o=0;c=-Number.MAX_VALUE;a=l.m_radius+g.m_radius;var h=parseInt(l.m_vertexCount),j=l.m_vertices;l=l.m_normals;for(var d=0;d<h;++d){u=j[d];w=k-u.x;q=p-u.y;u=l[d];w=u.x*w+u.y*q;if(w>a){return}if(w>c){c=w;o=d}}w=parseInt(o);q=parseInt(w+1<h?w+1:0);u=j[w];j=j[q];if(c<Number.MIN_VALUE){n.m_pointCount=1;n.m_type=af.e_faceA;n.m_localPlaneNormal.SetV(l[o]);n.m_localPoint.x=0.5*(u.x+j.x);n.m_localPoint.y=0.5*(u.y+j.y)}else{c=(k-j.x)*(u.x-j.x)+(p-j.y)*(u.y-j.y);if((k-u.x)*(j.x-u.x)+(p-u.y)*(j.y-u.y)<=0){if((k-u.x)*(k-u.x)+(p-u.y)*(p-u.y)>a*a){return}n.m_pointCount=1;n.m_type=af.e_faceA;n.m_localPlaneNormal.x=k-u.x;n.m_localPlaneNormal.y=p-u.y;n.m_localPlaneNormal.Normalize();n.m_localPoint.SetV(u)}else{if(c<=0){if((k-j.x)*(k-j.x)+(p-j.y)*(p-j.y)>a*a){return}n.m_pointCount=1;n.m_type=af.e_faceA;n.m_localPlaneNormal.x=k-j.x;n.m_localPlaneNormal.y=p-j.y;n.m_localPlaneNormal.Normalize();n.m_localPoint.SetV(j)}else{o=0.5*(u.x+j.x);u=0.5*(u.y+j.y);c=(k-o)*l[w].x+(p-u)*l[w].y;if(c>a){return}n.m_pointCount=1;n.m_type=af.e_faceA;n.m_localPlaneNormal.x=l[w].x;n.m_localPlaneNormal.y=l[w].y;n.m_localPlaneNormal.Normalize();n.m_localPoint.Set(o,u)}}}n.m_points[0].m_localPoint.SetV(g.m_p);n.m_points[0].m_id.key=0};P.TestOverlap=function(c,k){var j=k.lowerBound,a=c.upperBound,h=j.x-a.x,g=j.y-a.y;j=c.lowerBound;a=k.upperBound;var d=j.y-a.y;if(h>0||g>0){return false}if(j.x-a.x>0||d>0){return false}return true};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=P.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=P.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=P.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new ap;Box2D.Collision.b2Collision.s_localNormal=new ap;Box2D.Collision.b2Collision.s_planePoint=new ap;Box2D.Collision.b2Collision.s_normal=new ap;Box2D.Collision.b2Collision.s_tangent=new ap;Box2D.Collision.b2Collision.s_tangent2=new ap;Box2D.Collision.b2Collision.s_v11=new ap;Box2D.Collision.b2Collision.s_v12=new ap;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new ap;Box2D.Collision.b2Collision.b2_nullFeature=255});T.b2ContactID=function(){this.features=new az};T.prototype.b2ContactID=function(){this.features._m_id=this};T.prototype.Set=function(a){this.key=a._key};T.prototype.Copy=function(){var a=new T;a.key=this.key;return a};Object.defineProperty(T.prototype,"key",{enumerable:false,configurable:true,get:function(){return this._key}});Object.defineProperty(T.prototype,"key",{enumerable:false,configurable:true,set:function(a){if(a===undefined){a=0}this._key=a;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});ab.b2ContactPoint=function(){this.position=new ap;this.velocity=new ap;this.normal=new ap;this.id=new T};f.b2Distance=function(){};f.Distance=function(p,n,l){++f.b2_gjkCalls;var g=l.proxyA,a=l.proxyB,z=l.transformA,w=l.transformB,y=f.s_simplex;y.ReadCache(n,g,z,a,w);var u=y.m_vertices,c=f.s_saveA,q=f.s_saveB,h=0;y.GetClosestPoint().LengthSquared();for(var k=0,d,j=0;j<20;){h=y.m_count;for(k=0;k<h;k++){c[k]=u[k].indexA;q[k]=u[k].indexB}switch(y.m_count){case 1:break;case 2:y.Solve2();break;case 3:y.Solve3();break;default:al.b2Assert(false)}if(y.m_count==3){break}d=y.GetClosestPoint();d.LengthSquared();k=y.GetSearchDirection();if(k.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE){break}d=u[y.m_count];d.indexA=g.GetSupport(am.MulTMV(z.R,k.GetNegative()));d.wA=am.MulX(z,g.GetVertex(d.indexA));d.indexB=a.GetSupport(am.MulTMV(w.R,k));d.wB=am.MulX(w,a.GetVertex(d.indexB));d.w=am.SubtractVV(d.wB,d.wA);++j;++f.b2_gjkIters;var o=false;for(k=0;k<h;k++){if(d.indexA==c[k]&&d.indexB==q[k]){o=true;break}}if(o){break}++y.m_count}f.b2_gjkMaxIters=am.Max(f.b2_gjkMaxIters,j);y.GetWitnessPoints(p.pointA,p.pointB);p.distance=am.SubtractVV(p.pointA,p.pointB).Length();p.iterations=j;y.WriteCache(n);if(l.useRadii){n=g.m_radius;a=a.m_radius;if(p.distance>n+a&&p.distance>Number.MIN_VALUE){p.distance-=n+a;l=am.SubtractVV(p.pointB,p.pointA);l.Normalize();p.pointA.x+=n*l.x;p.pointA.y+=n*l.y;p.pointB.x-=a*l.x;p.pointB.y-=a*l.y}else{d=new ap;d.x=0.5*(p.pointA.x+p.pointB.x);d.y=0.5*(p.pointA.y+p.pointB.y);p.pointA.x=p.pointB.x=d.x;p.pointA.y=p.pointB.y=d.y;p.distance=0}}};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new aw;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});e.b2DistanceInput=function(){};au.b2DistanceOutput=function(){this.pointA=new ap;this.pointB=new ap};ak.b2DistanceProxy=function(){};ak.prototype.Set=function(a){switch(a.GetType()){case X.e_circleShape:a=a instanceof ae?a:null;this.m_vertices=new Vector(1,true);this.m_vertices[0]=a.m_p;this.m_count=1;this.m_radius=a.m_radius;break;case X.e_polygonShape:a=a instanceof ad?a:null;this.m_vertices=a.m_vertices;this.m_count=a.m_vertexCount;this.m_radius=a.m_radius;break;default:al.b2Assert(false)}};ak.prototype.GetSupport=function(c){for(var h=0,g=this.m_vertices[0].x*c.x+this.m_vertices[0].y*c.y,a=1;a<this.m_count;++a){var d=this.m_vertices[a].x*c.x+this.m_vertices[a].y*c.y;if(d>g){h=a;g=d}}return h};ak.prototype.GetSupportVertex=function(c){for(var h=0,g=this.m_vertices[0].x*c.x+this.m_vertices[0].y*c.y,a=1;a<this.m_count;++a){var d=this.m_vertices[a].x*c.x+this.m_vertices[a].y*c.y;if(d>g){h=a;g=d}}return this.m_vertices[h]};ak.prototype.GetVertexCount=function(){return this.m_count};ak.prototype.GetVertex=function(a){if(a===undefined){a=0}al.b2Assert(0<=a&&a<this.m_count);return this.m_vertices[a]};an.b2DynamicTree=function(){};an.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=0};an.prototype.CreateProxy=function(c,h){var g=this.AllocateNode(),a=al.b2_aabbExtension,d=al.b2_aabbExtension;g.aabb.lowerBound.x=c.lowerBound.x-a;g.aabb.lowerBound.y=c.lowerBound.y-d;g.aabb.upperBound.x=c.upperBound.x+a;g.aabb.upperBound.y=c.upperBound.y+d;g.userData=h;this.InsertLeaf(g);return g};an.prototype.DestroyProxy=function(a){this.RemoveLeaf(a);this.FreeNode(a)};an.prototype.MoveProxy=function(c,g,d){al.b2Assert(c.IsLeaf());if(c.aabb.Contains(g)){return false}this.RemoveLeaf(c);var a=al.b2_aabbExtension+al.b2_aabbMultiplier*(d.x>0?d.x:-d.x);d=al.b2_aabbExtension+al.b2_aabbMultiplier*(d.y>0?d.y:-d.y);c.aabb.lowerBound.x=g.lowerBound.x-a;c.aabb.lowerBound.y=g.lowerBound.y-d;c.aabb.upperBound.x=g.upperBound.x+a;c.aabb.upperBound.y=g.upperBound.y+d;this.InsertLeaf(c);return true};an.prototype.Rebalance=function(c){if(c===undefined){c=0}if(this.m_root!=null){for(var g=0;g<c;g++){for(var d=this.m_root,a=0;d.IsLeaf()==false;){d=this.m_path>>a&1?d.child2:d.child1;a=a+1&31}++this.m_path;this.RemoveLeaf(d);this.InsertLeaf(d)}}};an.prototype.GetFatAABB=function(a){return a.aabb};an.prototype.GetUserData=function(a){return a.userData};an.prototype.Query=function(c,h){if(this.m_root!=null){var g=new Vector,a=0;for(g[a++]=this.m_root;a>0;){var d=g[--a];if(d.aabb.TestOverlap(h)){if(d.IsLeaf()){if(!c(d)){break}}else{g[a++]=d.child1;g[a++]=d.child2}}}}};an.prototype.RayCast=function(k,j){if(this.m_root!=null){var h=j.p1,d=j.p2,a=am.SubtractVV(h,d);a.Normalize();a=am.CrossFV(1,a);var q=am.AbsV(a),o=j.maxFraction,p=new ah,n=0,c=0;n=h.x+o*(d.x-h.x);c=h.y+o*(d.y-h.y);p.lowerBound.x=Math.min(h.x,n);p.lowerBound.y=Math.min(h.y,c);p.upperBound.x=Math.max(h.x,n);p.upperBound.y=Math.max(h.y,c);var l=new Vector,g=0;for(l[g++]=this.m_root;g>0;){o=l[--g];if(o.aabb.TestOverlap(p)!=false){n=o.aabb.GetCenter();c=o.aabb.GetExtents();if(!(Math.abs(a.x*(h.x-n.x)+a.y*(h.y-n.y))-q.x*c.x-q.y*c.y>0)){if(o.IsLeaf()){n=new s;n.p1=j.p1;n.p2=j.p2;n.maxFraction=j.maxFraction;o=k(n,o);if(o==0){break}if(o>0){n=h.x+o*(d.x-h.x);c=h.y+o*(d.y-h.y);p.lowerBound.x=Math.min(h.x,n);p.lowerBound.y=Math.min(h.y,c);p.upperBound.x=Math.max(h.x,n);p.upperBound.y=Math.max(h.y,c)}}else{l[g++]=o.child1;l[g++]=o.child2}}}}}};an.prototype.AllocateNode=function(){if(this.m_freeList){var a=this.m_freeList;this.m_freeList=a.parent;a.parent=null;a.child1=null;a.child2=null;return a}return new ac};an.prototype.FreeNode=function(a){a.parent=this.m_freeList;this.m_freeList=a};an.prototype.InsertLeaf=function(c){++this.m_insertionCount;if(this.m_root==null){this.m_root=c;this.m_root.parent=null}else{var g=c.aabb.GetCenter(),d=this.m_root;if(d.IsLeaf()==false){do{var a=d.child1;d=d.child2;d=Math.abs((a.aabb.lowerBound.x+a.aabb.upperBound.x)/2-g.x)+Math.abs((a.aabb.lowerBound.y+a.aabb.upperBound.y)/2-g.y)<Math.abs((d.aabb.lowerBound.x+d.aabb.upperBound.x)/2-g.x)+Math.abs((d.aabb.lowerBound.y+d.aabb.upperBound.y)/2-g.y)?a:d}while(d.IsLeaf()==false)}g=d.parent;a=this.AllocateNode();a.parent=g;a.userData=null;a.aabb.Combine(c.aabb,d.aabb);if(g){if(d.parent.child1==d){g.child1=a}else{g.child2=a}a.child1=d;a.child2=c;d.parent=a;c.parent=a;do{if(g.aabb.Contains(a.aabb)){break}g.aabb.Combine(g.child1.aabb,g.child2.aabb);a=g;g=g.parent}while(g)}else{a.child1=d;a.child2=c;d.parent=a;this.m_root=c.parent=a}}};an.prototype.RemoveLeaf=function(a){if(a==this.m_root){this.m_root=null}else{var d=a.parent,c=d.parent;a=d.child1==a?d.child2:d.child1;if(c){if(c.child1==d){c.child1=a}else{c.child2=a}a.parent=c;for(this.FreeNode(d);c;){d=c.aabb;c.aabb=ah.Combine(c.child1.aabb,c.child2.aabb);if(d.Contains(c.aabb)){break}c=c.parent}}else{this.m_root=a;a.parent=null;this.FreeNode(d)}}};ag.b2DynamicTreeBroadPhase=function(){this.m_tree=new an;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};ag.prototype.CreateProxy=function(a,d){var c=this.m_tree.CreateProxy(a,d);++this.m_proxyCount;this.BufferMove(c);return c};ag.prototype.DestroyProxy=function(a){this.UnBufferMove(a);--this.m_proxyCount;this.m_tree.DestroyProxy(a)};ag.prototype.MoveProxy=function(a,d,c){this.m_tree.MoveProxy(a,d,c)&&this.BufferMove(a)};ag.prototype.TestOverlap=function(c,g){var d=this.m_tree.GetFatAABB(c),a=this.m_tree.GetFatAABB(g);return d.TestOverlap(a)};ag.prototype.GetUserData=function(a){return this.m_tree.GetUserData(a)};ag.prototype.GetFatAABB=function(a){return this.m_tree.GetFatAABB(a)};ag.prototype.GetProxyCount=function(){return this.m_proxyCount};ag.prototype.UpdatePairs=function(c){var k=this;var j=k.m_pairCount=0,a;for(j=0;j<k.m_moveBuffer.length;++j){a=k.m_moveBuffer[j];var h=k.m_tree.GetFatAABB(a);k.m_tree.Query(function(n){if(n==a){return true}if(k.m_pairCount==k.m_pairBuffer.length){k.m_pairBuffer[k.m_pairCount]=new C}var l=k.m_pairBuffer[k.m_pairCount];l.proxyA=n<a?n:a;l.proxyB=n>=a?n:a;++k.m_pairCount;return true},h)}for(j=k.m_moveBuffer.length=0;j<k.m_pairCount;){h=k.m_pairBuffer[j];var g=k.m_tree.GetUserData(h.proxyA),d=k.m_tree.GetUserData(h.proxyB);c(g,d);for(++j;j<k.m_pairCount;){g=k.m_pairBuffer[j];if(g.proxyA!=h.proxyA||g.proxyB!=h.proxyB){break}++j}}};ag.prototype.Query=function(a,c){this.m_tree.Query(a,c)};ag.prototype.RayCast=function(a,c){this.m_tree.RayCast(a,c)};ag.prototype.Validate=function(){};ag.prototype.Rebalance=function(a){if(a===undefined){a=0}this.m_tree.Rebalance(a)};ag.prototype.BufferMove=function(a){this.m_moveBuffer[this.m_moveBuffer.length]=a};ag.prototype.UnBufferMove=function(a){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(a)),1)};ag.prototype.ComparePairs=function(){return 0};ag.__implements={};ag.__implements[ax]=true;ac.b2DynamicTreeNode=function(){this.aabb=new ah};ac.prototype.IsLeaf=function(){return this.child1==null};C.b2DynamicTreePair=function(){};af.b2Manifold=function(){this.m_pointCount=0};af.prototype.b2Manifold=function(){this.m_points=new Vector(al.b2_maxManifoldPoints);for(var a=0;a<al.b2_maxManifoldPoints;a++){this.m_points[a]=new t}this.m_localPlaneNormal=new ap;this.m_localPoint=new ap};af.prototype.Reset=function(){for(var a=0;a<al.b2_maxManifoldPoints;a++){(this.m_points[a] instanceof t?this.m_points[a]:null).Reset()}this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};af.prototype.Set=function(a){this.m_pointCount=a.m_pointCount;for(var c=0;c<al.b2_maxManifoldPoints;c++){(this.m_points[c] instanceof t?this.m_points[c]:null).Set(a.m_points[c])}this.m_localPlaneNormal.SetV(a.m_localPlaneNormal);this.m_localPoint.SetV(a.m_localPoint);this.m_type=a.m_type};af.prototype.Copy=function(){var a=new af;a.Set(this);return a};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});t.b2ManifoldPoint=function(){this.m_localPoint=new ap;this.m_id=new T};t.prototype.b2ManifoldPoint=function(){this.Reset()};t.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.key=0};t.prototype.Set=function(a){this.m_localPoint.SetV(a.m_localPoint);this.m_normalImpulse=a.m_normalImpulse;this.m_tangentImpulse=a.m_tangentImpulse;this.m_id.Set(a.m_id)};J.b2Point=function(){this.p=new ap};J.prototype.Support=function(){return this.p};J.prototype.GetFirstVertex=function(){return this.p};s.b2RayCastInput=function(){this.p1=new ap;this.p2=new ap};s.prototype.b2RayCastInput=function(a,d,c){if(a===undefined){a=null}if(d===undefined){d=null}if(c===undefined){c=1}a&&this.p1.SetV(a);d&&this.p2.SetV(d);this.maxFraction=c};aj.b2RayCastOutput=function(){this.normal=new ap};b.b2Segment=function(){this.p1=new ap;this.p2=new ap};b.prototype.TestSegment=function(k,j,h,d){if(d===undefined){d=0}var a=h.p1,q=h.p2.x-a.x,o=h.p2.y-a.y;h=this.p2.y-this.p1.y;var p=-(this.p2.x-this.p1.x),n=100*Number.MIN_VALUE,c=-(q*h+o*p);if(c>n){var l=a.x-this.p1.x,g=a.y-this.p1.y;a=l*h+g*p;if(0<=a&&a<=d*c){d=-q*g+o*l;if(-n*c<=d&&d<=c*(1+n)){a/=c;d=Math.sqrt(h*h+p*p);h/=d;p/=d;k[0]=a;j.Set(h,p);return true}}}return false};b.prototype.Extend=function(a){this.ExtendForward(a);this.ExtendBackward(a)};b.prototype.ExtendForward=function(a){var d=this.p2.x-this.p1.x,c=this.p2.y-this.p1.y;a=Math.min(d>0?(a.upperBound.x-this.p1.x)/d:d<0?(a.lowerBound.x-this.p1.x)/d:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p1.y)/c:c<0?(a.lowerBound.y-this.p1.y)/c:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+d*a;this.p2.y=this.p1.y+c*a};b.prototype.ExtendBackward=function(a){var d=-this.p2.x+this.p1.x,c=-this.p2.y+this.p1.y;a=Math.min(d>0?(a.upperBound.x-this.p2.x)/d:d<0?(a.lowerBound.x-this.p2.x)/d:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p2.y)/c:c<0?(a.lowerBound.y-this.p2.y)/c:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+d*a;this.p1.y=this.p2.y+c*a};ay.b2SeparationFunction=function(){this.m_localPoint=new ap;this.m_axis=new ap};ay.prototype.Initialize=function(k,j,h,d,a){this.m_proxyA=j;this.m_proxyB=d;var q=parseInt(k.count);al.b2Assert(0<q&&q<3);var o,p,n,c,l=c=n=d=j=0,g=0;l=0;if(q==1){this.m_type=ay.e_points;o=this.m_proxyA.GetVertex(k.indexA[0]);p=this.m_proxyB.GetVertex(k.indexB[0]);q=o;k=h.R;j=h.position.x+(k.col1.x*q.x+k.col2.x*q.y);d=h.position.y+(k.col1.y*q.x+k.col2.y*q.y);q=p;k=a.R;n=a.position.x+(k.col1.x*q.x+k.col2.x*q.y);c=a.position.y+(k.col1.y*q.x+k.col2.y*q.y);this.m_axis.x=n-j;this.m_axis.y=c-d;this.m_axis.Normalize()}else{if(k.indexB[0]==k.indexB[1]){this.m_type=ay.e_faceA;j=this.m_proxyA.GetVertex(k.indexA[0]);d=this.m_proxyA.GetVertex(k.indexA[1]);p=this.m_proxyB.GetVertex(k.indexB[0]);this.m_localPoint.x=0.5*(j.x+d.x);this.m_localPoint.y=0.5*(j.y+d.y);this.m_axis=am.CrossVF(am.SubtractVV(d,j),1);this.m_axis.Normalize();q=this.m_axis;k=h.R;l=k.col1.x*q.x+k.col2.x*q.y;g=k.col1.y*q.x+k.col2.y*q.y;q=this.m_localPoint;k=h.R;j=h.position.x+(k.col1.x*q.x+k.col2.x*q.y);d=h.position.y+(k.col1.y*q.x+k.col2.y*q.y);q=p;k=a.R;n=a.position.x+(k.col1.x*q.x+k.col2.x*q.y);c=a.position.y+(k.col1.y*q.x+k.col2.y*q.y);l=(n-j)*l+(c-d)*g}else{if(k.indexA[0]==k.indexA[0]){this.m_type=ay.e_faceB;n=this.m_proxyB.GetVertex(k.indexB[0]);c=this.m_proxyB.GetVertex(k.indexB[1]);o=this.m_proxyA.GetVertex(k.indexA[0]);this.m_localPoint.x=0.5*(n.x+c.x);this.m_localPoint.y=0.5*(n.y+c.y);this.m_axis=am.CrossVF(am.SubtractVV(c,n),1);this.m_axis.Normalize();q=this.m_axis;k=a.R;l=k.col1.x*q.x+k.col2.x*q.y;g=k.col1.y*q.x+k.col2.y*q.y;q=this.m_localPoint;k=a.R;n=a.position.x+(k.col1.x*q.x+k.col2.x*q.y);c=a.position.y+(k.col1.y*q.x+k.col2.y*q.y);q=o;k=h.R;j=h.position.x+(k.col1.x*q.x+k.col2.x*q.y);d=h.position.y+(k.col1.y*q.x+k.col2.y*q.y);l=(j-n)*l+(d-c)*g}else{j=this.m_proxyA.GetVertex(k.indexA[0]);d=this.m_proxyA.GetVertex(k.indexA[1]);n=this.m_proxyB.GetVertex(k.indexB[0]);c=this.m_proxyB.GetVertex(k.indexB[1]);am.MulX(h,o);o=am.MulMV(h.R,am.SubtractVV(d,j));am.MulX(a,p);l=am.MulMV(a.R,am.SubtractVV(c,n));a=o.x*o.x+o.y*o.y;p=l.x*l.x+l.y*l.y;k=am.SubtractVV(l,o);h=o.x*k.x+o.y*k.y;k=l.x*k.x+l.y*k.y;o=o.x*l.x+o.y*l.y;g=a*p-o*o;l=0;if(g!=0){l=am.Clamp((o*k-h*p)/g,0,1)}if((o*l+k)/p<0){l=am.Clamp((o-h)/a,0,1)}o=new ap;o.x=j.x+l*(d.x-j.x);o.y=j.y+l*(d.y-j.y);p=new ap;p.x=n.x+l*(c.x-n.x);p.y=n.y+l*(c.y-n.y);if(l==0||l==1){this.m_type=ay.e_faceB;this.m_axis=am.CrossVF(am.SubtractVV(c,n),1);this.m_axis.Normalize();this.m_localPoint=p}else{this.m_type=ay.e_faceA;this.m_axis=am.CrossVF(am.SubtractVV(d,j),1);this.m_localPoint=o}}}l<0&&this.m_axis.NegativeSelf()}};ay.prototype.Evaluate=function(c,h){var g,a,d=0;switch(this.m_type){case ay.e_points:g=am.MulTMV(c.R,this.m_axis);a=am.MulTMV(h.R,this.m_axis.GetNegative());g=this.m_proxyA.GetSupportVertex(g);a=this.m_proxyB.GetSupportVertex(a);g=am.MulX(c,g);a=am.MulX(h,a);return d=(a.x-g.x)*this.m_axis.x+(a.y-g.y)*this.m_axis.y;case ay.e_faceA:d=am.MulMV(c.R,this.m_axis);g=am.MulX(c,this.m_localPoint);a=am.MulTMV(h.R,d.GetNegative());a=this.m_proxyB.GetSupportVertex(a);a=am.MulX(h,a);return d=(a.x-g.x)*d.x+(a.y-g.y)*d.y;case ay.e_faceB:d=am.MulMV(h.R,this.m_axis);a=am.MulX(h,this.m_localPoint);g=am.MulTMV(c.R,d.GetNegative());g=this.m_proxyA.GetSupportVertex(g);g=am.MulX(c,g);return d=(g.x-a.x)*d.x+(g.y-a.y)*d.y;default:al.b2Assert(false);return 0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4});aw.b2Simplex=function(){this.m_v1=new av;this.m_v2=new av;this.m_v3=new av;this.m_vertices=new Vector(3)};aw.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};aw.prototype.ReadCache=function(j,h,g,d,a){al.b2Assert(0<=j.count&&j.count<=3);var o,l;this.m_count=j.count;for(var n=this.m_vertices,k=0;k<this.m_count;k++){var c=n[k];c.indexA=j.indexA[k];c.indexB=j.indexB[k];o=h.GetVertex(c.indexA);l=d.GetVertex(c.indexB);c.wA=am.MulX(g,o);c.wB=am.MulX(a,l);c.w=am.SubtractVV(c.wB,c.wA);c.a=0}if(this.m_count>1){j=j.metric;o=this.GetMetric();if(o<0.5*j||2*j<o||o<Number.MIN_VALUE){this.m_count=0}}if(this.m_count==0){c=n[0];c.indexA=0;c.indexB=0;o=h.GetVertex(0);l=d.GetVertex(0);c.wA=am.MulX(g,o);c.wB=am.MulX(a,l);c.w=am.SubtractVV(c.wB,c.wA);this.m_count=1}};aw.prototype.WriteCache=function(a){a.metric=this.GetMetric();a.count=Box2D.parseUInt(this.m_count);for(var d=this.m_vertices,c=0;c<this.m_count;c++){a.indexA[c]=Box2D.parseUInt(d[c].indexA);a.indexB[c]=Box2D.parseUInt(d[c].indexB)}};aw.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var a=am.SubtractVV(this.m_v2.w,this.m_v1.w);return am.CrossVV(a,this.m_v1.w.GetNegative())>0?am.CrossFV(1,a):am.CrossVF(a,1);default:al.b2Assert(false);return new ap}};aw.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:al.b2Assert(false);return new ap;case 1:return this.m_v1.w;case 2:return new ap(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:al.b2Assert(false);return new ap}};aw.prototype.GetWitnessPoints=function(a,c){switch(this.m_count){case 0:al.b2Assert(false);break;case 1:a.SetV(this.m_v1.wA);c.SetV(this.m_v1.wB);break;case 2:a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;c.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;c.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:c.x=a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;c.y=a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:al.b2Assert(false)}};aw.prototype.GetMetric=function(){switch(this.m_count){case 0:al.b2Assert(false);return 0;case 1:return 0;case 2:return am.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return am.CrossVV(am.SubtractVV(this.m_v2.w,this.m_v1.w),am.SubtractVV(this.m_v3.w,this.m_v1.w));default:al.b2Assert(false);return 0}};aw.prototype.Solve2=function(){var a=this.m_v1.w,d=this.m_v2.w,c=am.SubtractVV(d,a);a=-(a.x*c.x+a.y*c.y);if(a<=0){this.m_count=this.m_v1.a=1}else{d=d.x*c.x+d.y*c.y;if(d<=0){this.m_count=this.m_v2.a=1;this.m_v1.Set(this.m_v2)}else{c=1/(d+a);this.m_v1.a=d*c;this.m_v2.a=a*c;this.m_count=2}}};aw.prototype.Solve3=function(){var j=this.m_v1.w,h=this.m_v2.w,g=this.m_v3.w,d=am.SubtractVV(h,j),a=am.Dot(j,d),p=am.Dot(h,d);a=-a;var n=am.SubtractVV(g,j),o=am.Dot(j,n),l=am.Dot(g,n);o=-o;var c=am.SubtractVV(g,h),k=am.Dot(h,c);c=am.Dot(g,c);k=-k;n=am.CrossVV(d,n);d=n*am.CrossVV(h,g);g=n*am.CrossVV(g,j);j=n*am.CrossVV(j,h);if(a<=0&&o<=0){this.m_count=this.m_v1.a=1}else{if(p>0&&a>0&&j<=0){l=1/(p+a);this.m_v1.a=p*l;this.m_v2.a=a*l;this.m_count=2}else{if(l>0&&o>0&&g<=0){p=1/(l+o);this.m_v1.a=l*p;this.m_v3.a=o*p;this.m_count=2;this.m_v2.Set(this.m_v3)}else{if(p<=0&&k<=0){this.m_count=this.m_v2.a=1;this.m_v1.Set(this.m_v2)}else{if(l<=0&&c<=0){this.m_count=this.m_v3.a=1;this.m_v1.Set(this.m_v3)}else{if(c>0&&k>0&&d<=0){p=1/(c+k);this.m_v2.a=c*p;this.m_v3.a=k*p;this.m_count=2;this.m_v1.Set(this.m_v3)}else{p=1/(d+g+j);this.m_v1.a=d*p;this.m_v2.a=g*p;this.m_v3.a=j*p;this.m_count=3}}}}}}};at.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};av.b2SimplexVertex=function(){};av.prototype.Set=function(a){this.wA.SetV(a.wA);this.wB.SetV(a.wB);this.w.SetV(a.w);this.a=a.a;this.indexA=a.indexA;this.indexB=a.indexB};aq.b2TimeOfImpact=function(){};aq.TimeOfImpact=function(q){++aq.b2_toiCalls;var o=q.proxyA,n=q.proxyB,g=q.sweepA,a=q.sweepB;al.b2Assert(g.t0==a.t0);al.b2Assert(1-g.t0>Number.MIN_VALUE);var A=o.m_radius+n.m_radius;q=q.tolerance;var y=0,z=0,w=0;aq.s_cache.count=0;for(aq.s_distanceInput.useRadii=false;;){g.GetTransform(aq.s_xfA,y);a.GetTransform(aq.s_xfB,y);aq.s_distanceInput.proxyA=o;aq.s_distanceInput.proxyB=n;aq.s_distanceInput.transformA=aq.s_xfA;aq.s_distanceInput.transformB=aq.s_xfB;f.Distance(aq.s_distanceOutput,aq.s_cache,aq.s_distanceInput);if(aq.s_distanceOutput.distance<=0){y=1;break}aq.s_fcn.Initialize(aq.s_cache,o,aq.s_xfA,n,aq.s_xfB);var c=aq.s_fcn.Evaluate(aq.s_xfA,aq.s_xfB);if(c<=0){y=1;break}if(z==0){w=c>A?am.Max(A-q,0.75*A):am.Max(c-q,0.02*A)}if(c-w<0.5*q){if(z==0){y=1;break}break}var u=y,j=y,l=1;c=c;g.GetTransform(aq.s_xfA,l);a.GetTransform(aq.s_xfB,l);var d=aq.s_fcn.Evaluate(aq.s_xfA,aq.s_xfB);if(d>=w){y=1;break}for(var k=0;;){var p=0;p=k&1?j+(w-c)*(l-j)/(d-c):0.5*(j+l);g.GetTransform(aq.s_xfA,p);a.GetTransform(aq.s_xfB,p);var h=aq.s_fcn.Evaluate(aq.s_xfA,aq.s_xfB);if(am.Abs(h-w)<0.025*q){u=p;break}if(h>w){j=p;c=h}else{l=p;d=h}++k;++aq.b2_toiRootIters;if(k==50){break}}aq.b2_toiMaxRootIters=am.Max(aq.b2_toiMaxRootIters,k);if(u<(1+100*Number.MIN_VALUE)*y){break}y=u;z++;++aq.b2_toiIters;if(z==1000){break}}aq.b2_toiMaxIters=am.Max(aq.b2_toiMaxIters,z);return y};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new at;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new e;Box2D.Collision.b2TimeOfImpact.s_xfA=new r;Box2D.Collision.b2TimeOfImpact.s_xfB=new r;Box2D.Collision.b2TimeOfImpact.s_fcn=new ay;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new au});ao.b2TOIInput=function(){this.proxyA=new ak;this.proxyB=new ak;this.sweepA=new ai;this.sweepB=new ai};ar.b2WorldManifold=function(){this.m_normal=new ap};ar.prototype.b2WorldManifold=function(){this.m_points=new Vector(al.b2_maxManifoldPoints);for(var a=0;a<al.b2_maxManifoldPoints;a++){this.m_points[a]=new ap}};ar.prototype.Initialize=function(l,k,j,d,a){if(j===undefined){j=0}if(a===undefined){a=0}if(l.m_pointCount!=0){var u=0,p,q,o=0,c=0,n=0,g=0,h=0;p=0;switch(l.m_type){case af.e_circles:q=k.R;p=l.m_localPoint;u=k.position.x+q.col1.x*p.x+q.col2.x*p.y;k=k.position.y+q.col1.y*p.x+q.col2.y*p.y;q=d.R;p=l.m_points[0].m_localPoint;l=d.position.x+q.col1.x*p.x+q.col2.x*p.y;d=d.position.y+q.col1.y*p.x+q.col2.y*p.y;p=l-u;q=d-k;o=p*p+q*q;if(o>Number.MIN_VALUE*Number.MIN_VALUE){o=Math.sqrt(o);this.m_normal.x=p/o;this.m_normal.y=q/o}else{this.m_normal.x=1;this.m_normal.y=0}p=k+j*this.m_normal.y;d=d-a*this.m_normal.y;this.m_points[0].x=0.5*(u+j*this.m_normal.x+(l-a*this.m_normal.x));this.m_points[0].y=0.5*(p+d);break;case af.e_faceA:q=k.R;p=l.m_localPlaneNormal;o=q.col1.x*p.x+q.col2.x*p.y;c=q.col1.y*p.x+q.col2.y*p.y;q=k.R;p=l.m_localPoint;n=k.position.x+q.col1.x*p.x+q.col2.x*p.y;g=k.position.y+q.col1.y*p.x+q.col2.y*p.y;this.m_normal.x=o;this.m_normal.y=c;for(u=0;u<l.m_pointCount;u++){q=d.R;p=l.m_points[u].m_localPoint;h=d.position.x+q.col1.x*p.x+q.col2.x*p.y;p=d.position.y+q.col1.y*p.x+q.col2.y*p.y;this.m_points[u].x=h+0.5*(j-(h-n)*o-(p-g)*c-a)*o;this.m_points[u].y=p+0.5*(j-(h-n)*o-(p-g)*c-a)*c}break;case af.e_faceB:q=d.R;p=l.m_localPlaneNormal;o=q.col1.x*p.x+q.col2.x*p.y;c=q.col1.y*p.x+q.col2.y*p.y;q=d.R;p=l.m_localPoint;n=d.position.x+q.col1.x*p.x+q.col2.x*p.y;g=d.position.y+q.col1.y*p.x+q.col2.y*p.y;this.m_normal.x=-o;this.m_normal.y=-c;for(u=0;u<l.m_pointCount;u++){q=k.R;p=l.m_points[u].m_localPoint;h=k.position.x+q.col1.x*p.x+q.col2.x*p.y;p=k.position.y+q.col1.y*p.x+q.col2.y*p.y;this.m_points[u].x=h+0.5*(a-(h-n)*o-(p-g)*c-j)*o;this.m_points[u].y=p+0.5*(a-(h-n)*o-(p-g)*c-j)*c}}}};aA.ClipVertex=function(){this.v=new ap;this.id=new T};aA.prototype.Set=function(a){this.v.SetV(a.v);this.id.Set(a.id)};az.Features=function(){};Object.defineProperty(az.prototype,"referenceEdge",{enumerable:false,configurable:true,get:function(){return this._referenceEdge}});Object.defineProperty(az.prototype,"referenceEdge",{enumerable:false,configurable:true,set:function(a){if(a===undefined){a=0}this._referenceEdge=a;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(az.prototype,"incidentEdge",{enumerable:false,configurable:true,get:function(){return this._incidentEdge}});Object.defineProperty(az.prototype,"incidentEdge",{enumerable:false,configurable:true,set:function(a){if(a===undefined){a=0}this._incidentEdge=a;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(az.prototype,"incidentVertex",{enumerable:false,configurable:true,get:function(){return this._incidentVertex}});Object.defineProperty(az.prototype,"incidentVertex",{enumerable:false,configurable:true,set:function(a){if(a===undefined){a=0}this._incidentVertex=a;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(az.prototype,"flip",{enumerable:false,configurable:true,get:function(){return this._flip}});Object.defineProperty(az.prototype,"flip",{enumerable:false,configurable:true,set:function(a){if(a===undefined){a=0}this._flip=a;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){var r=Box2D.Common.b2Settings,q=Box2D.Collision.Shapes.b2CircleShape,m=Box2D.Collision.Shapes.b2EdgeChainDef,l=Box2D.Collision.Shapes.b2EdgeShape,o=Box2D.Collision.Shapes.b2MassData,d=Box2D.Collision.Shapes.b2PolygonShape,g=Box2D.Collision.Shapes.b2Shape,c=Box2D.Common.Math.b2Mat22,b=Box2D.Common.Math.b2Math,h=Box2D.Common.Math.b2Transform,f=Box2D.Common.Math.b2Vec2,j=Box2D.Collision.b2Distance,k=Box2D.Collision.b2DistanceInput,n=Box2D.Collision.b2DistanceOutput,e=Box2D.Collision.b2DistanceProxy,a=Box2D.Collision.b2SimplexCache;Box2D.inherit(q,Box2D.Collision.Shapes.b2Shape);q.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;q.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new f};q.prototype.Copy=function(){var p=new q;p.Set(this);return p};q.prototype.Set=function(p){this.__super.Set.call(this,p);if(Box2D.is(p,q)){this.m_p.SetV((p instanceof q?p:null).m_p)}};q.prototype.TestPoint=function(p,v){var s=p.R,t=p.position.x+(s.col1.x*this.m_p.x+s.col2.x*this.m_p.y);s=p.position.y+(s.col1.y*this.m_p.x+s.col2.y*this.m_p.y);t=v.x-t;s=v.y-s;return t*t+s*s<=this.m_radius*this.m_radius};q.prototype.RayCast=function(s,y,B){var p=B.R,A=y.p1.x-(B.position.x+(p.col1.x*this.m_p.x+p.col2.x*this.m_p.y));B=y.p1.y-(B.position.y+(p.col1.y*this.m_p.x+p.col2.y*this.m_p.y));p=y.p2.x-y.p1.x;var v=y.p2.y-y.p1.y,C=A*p+B*v,t=p*p+v*v,w=C*C-t*(A*A+B*B-this.m_radius*this.m_radius);if(w<0||t<Number.MIN_VALUE){return false}C=-(C+Math.sqrt(w));if(0<=C&&C<=y.maxFraction*t){C/=t;s.fraction=C;s.normal.x=A+C*p;s.normal.y=B+C*v;s.normal.Normalize();return true}return false};q.prototype.ComputeAABB=function(p,v){var s=v.R,t=v.position.x+(s.col1.x*this.m_p.x+s.col2.x*this.m_p.y);s=v.position.y+(s.col1.y*this.m_p.x+s.col2.y*this.m_p.y);p.lowerBound.Set(t-this.m_radius,s-this.m_radius);p.upperBound.Set(t+this.m_radius,s+this.m_radius)};q.prototype.ComputeMass=function(p,s){if(s===undefined){s=0}p.mass=s*r.b2_pi*this.m_radius*this.m_radius;p.center.SetV(this.m_p);p.I=p.mass*(0.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};q.prototype.ComputeSubmergedArea=function(p,y,s,w){if(y===undefined){y=0}s=b.MulX(s,this.m_p);var t=-(b.Dot(p,s)-y);if(t<-this.m_radius+Number.MIN_VALUE){return 0}if(t>this.m_radius){w.SetV(s);return Math.PI*this.m_radius*this.m_radius}y=this.m_radius*this.m_radius;var v=t*t;t=y*(Math.asin(t/this.m_radius)+Math.PI/2)+t*Math.sqrt(y-v);y=-2/3*Math.pow(y-v,1.5)/t;w.x=s.x+p.x*y;w.y=s.y+p.y*y;return t};q.prototype.GetLocalPosition=function(){return this.m_p};q.prototype.SetLocalPosition=function(p){this.m_p.SetV(p)};q.prototype.GetRadius=function(){return this.m_radius};q.prototype.SetRadius=function(p){if(p===undefined){p=0}this.m_radius=p};q.prototype.b2CircleShape=function(p){if(p===undefined){p=0}this.__super.b2Shape.call(this);this.m_type=g.e_circleShape;this.m_radius=p};m.b2EdgeChainDef=function(){};m.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=true;this.vertices=[]};Box2D.inherit(l,Box2D.Collision.Shapes.b2Shape);l.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;l.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new f;this.m_v1=new f;this.m_v2=new f;this.m_coreV1=new f;this.m_coreV2=new f;this.m_normal=new f;this.m_direction=new f;this.m_cornerDir1=new f;this.m_cornerDir2=new f};l.prototype.TestPoint=function(){return false};l.prototype.RayCast=function(t,B,F){var s,C=B.p2.x-B.p1.x,y=B.p2.y-B.p1.y;s=F.R;var G=F.position.x+(s.col1.x*this.m_v1.x+s.col2.x*this.m_v1.y),w=F.position.y+(s.col1.y*this.m_v1.x+s.col2.y*this.m_v1.y),A=F.position.y+(s.col1.y*this.m_v2.x+s.col2.y*this.m_v2.y)-w;F=-(F.position.x+(s.col1.x*this.m_v2.x+s.col2.x*this.m_v2.y)-G);s=100*Number.MIN_VALUE;var v=-(C*A+y*F);if(v>s){G=B.p1.x-G;var p=B.p1.y-w;w=G*A+p*F;if(0<=w&&w<=B.maxFraction*v){B=-C*p+y*G;if(-s*v<=B&&B<=v*(1+s)){w/=v;t.fraction=w;B=Math.sqrt(A*A+F*F);t.normal.x=A/B;t.normal.y=F/B;return true}}}return false};l.prototype.ComputeAABB=function(p,y){var s=y.R,w=y.position.x+(s.col1.x*this.m_v1.x+s.col2.x*this.m_v1.y),t=y.position.y+(s.col1.y*this.m_v1.x+s.col2.y*this.m_v1.y),v=y.position.x+(s.col1.x*this.m_v2.x+s.col2.x*this.m_v2.y);s=y.position.y+(s.col1.y*this.m_v2.x+s.col2.y*this.m_v2.y);if(w<v){p.lowerBound.x=w;p.upperBound.x=v}else{p.lowerBound.x=v;p.upperBound.x=w}if(t<s){p.lowerBound.y=t;p.upperBound.y=s}else{p.lowerBound.y=s;p.upperBound.y=t}};l.prototype.ComputeMass=function(p){p.mass=0;p.center.SetV(this.m_v1);p.I=0};l.prototype.ComputeSubmergedArea=function(p,A,s,y){if(A===undefined){A=0}var t=new f(p.x*A,p.y*A),w=b.MulX(s,this.m_v1);s=b.MulX(s,this.m_v2);var v=b.Dot(p,w)-A;p=b.Dot(p,s)-A;if(v>0){if(p>0){return 0}else{w.x=-p/(v-p)*w.x+v/(v-p)*s.x;w.y=-p/(v-p)*w.y+v/(v-p)*s.y}}else{if(p>0){s.x=-p/(v-p)*w.x+v/(v-p)*s.x;s.y=-p/(v-p)*w.y+v/(v-p)*s.y}}y.x=(t.x+w.x+s.x)/3;y.y=(t.y+w.y+s.y)/3;return 0.5*((w.x-t.x)*(s.y-t.y)-(w.y-t.y)*(s.x-t.x))};l.prototype.GetLength=function(){return this.m_length};l.prototype.GetVertex1=function(){return this.m_v1};l.prototype.GetVertex2=function(){return this.m_v2};l.prototype.GetCoreVertex1=function(){return this.m_coreV1};l.prototype.GetCoreVertex2=function(){return this.m_coreV2};l.prototype.GetNormalVector=function(){return this.m_normal};l.prototype.GetDirectionVector=function(){return this.m_direction};l.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};l.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};l.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};l.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};l.prototype.GetFirstVertex=function(p){var s=p.R;return new f(p.position.x+(s.col1.x*this.m_coreV1.x+s.col2.x*this.m_coreV1.y),p.position.y+(s.col1.y*this.m_coreV1.x+s.col2.y*this.m_coreV1.y))};l.prototype.GetNextEdge=function(){return this.m_nextEdge};l.prototype.GetPrevEdge=function(){return this.m_prevEdge};l.prototype.Support=function(p,A,s){if(A===undefined){A=0}if(s===undefined){s=0}var y=p.R,t=p.position.x+(y.col1.x*this.m_coreV1.x+y.col2.x*this.m_coreV1.y),w=p.position.y+(y.col1.y*this.m_coreV1.x+y.col2.y*this.m_coreV1.y),v=p.position.x+(y.col1.x*this.m_coreV2.x+y.col2.x*this.m_coreV2.y);p=p.position.y+(y.col1.y*this.m_coreV2.x+y.col2.y*this.m_coreV2.y);if(t*A+w*s>v*A+p*s){this.s_supportVec.x=t;this.s_supportVec.y=w}else{this.s_supportVec.x=v;this.s_supportVec.y=p}return this.s_supportVec};l.prototype.b2EdgeShape=function(p,s){this.__super.b2Shape.call(this);this.m_type=g.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=p;this.m_v2=s;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-r.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-r.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-r.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-r.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};l.prototype.SetPrevEdge=function(p,v,s,t){this.m_prevEdge=p;this.m_coreV1=v;this.m_cornerDir1=s;this.m_cornerConvex1=t};l.prototype.SetNextEdge=function(p,v,s,t){this.m_nextEdge=p;this.m_coreV2=v;this.m_cornerDir2=s;this.m_cornerConvex2=t};o.b2MassData=function(){this.mass=0;this.center=new f(0,0);this.I=0};Box2D.inherit(d,Box2D.Collision.Shapes.b2Shape);d.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;d.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};d.prototype.Copy=function(){var p=new d;p.Set(this);return p};d.prototype.Set=function(p){this.__super.Set.call(this,p);if(Box2D.is(p,d)){p=p instanceof d?p:null;this.m_centroid.SetV(p.m_centroid);this.m_vertexCount=p.m_vertexCount;this.Reserve(this.m_vertexCount);for(var s=0;s<this.m_vertexCount;s++){this.m_vertices[s].SetV(p.m_vertices[s]);this.m_normals[s].SetV(p.m_normals[s])}}};d.prototype.SetAsArray=function(p,w){if(w===undefined){w=0}var s=new Vector,v=0,t;for(v=0;v<p.length;++v){t=p[v];s.push(t)}this.SetAsVector(s,w)};d.AsArray=function(p,t){if(t===undefined){t=0}var s=new d;s.SetAsArray(p,t);return s};d.prototype.SetAsVector=function(p,w){if(w===undefined){w=0}if(w==0){w=p.length}r.b2Assert(2<=w);this.m_vertexCount=w;this.Reserve(w);var s=0;for(s=0;s<this.m_vertexCount;s++){this.m_vertices[s].SetV(p[s])}for(s=0;s<this.m_vertexCount;++s){var v=parseInt(s),t=parseInt(s+1<this.m_vertexCount?s+1:0);v=b.SubtractVV(this.m_vertices[t],this.m_vertices[v]);r.b2Assert(v.LengthSquared()>Number.MIN_VALUE);this.m_normals[s].SetV(b.CrossVF(v,1));this.m_normals[s].Normalize()}this.m_centroid=d.ComputeCentroid(this.m_vertices,this.m_vertexCount)};d.AsVector=function(p,t){if(t===undefined){t=0}var s=new d;s.SetAsVector(p,t);return s};d.prototype.SetAsBox=function(p,s){if(p===undefined){p=0}if(s===undefined){s=0}this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-p,-s);this.m_vertices[1].Set(p,-s);this.m_vertices[2].Set(p,s);this.m_vertices[3].Set(-p,s);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};d.AsBox=function(p,t){if(p===undefined){p=0}if(t===undefined){t=0}var s=new d;s.SetAsBox(p,t);return s};d.prototype.SetAsOrientedBox=function(p,v,s,t){if(p===undefined){p=0}if(v===undefined){v=0}if(s===undefined){s=null}if(t===undefined){t=0}this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-p,-v);this.m_vertices[1].Set(p,-v);this.m_vertices[2].Set(p,v);this.m_vertices[3].Set(-p,v);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=s;p=new h;p.position=s;p.R.Set(t);for(s=0;s<this.m_vertexCount;++s){this.m_vertices[s]=b.MulX(p,this.m_vertices[s]);this.m_normals[s]=b.MulMV(p.R,this.m_normals[s])}};d.AsOrientedBox=function(p,w,s,v){if(p===undefined){p=0}if(w===undefined){w=0}if(s===undefined){s=null}if(v===undefined){v=0}var t=new d;t.SetAsOrientedBox(p,w,s,v);return t};d.prototype.SetAsEdge=function(p,s){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(p);this.m_vertices[1].SetV(s);this.m_centroid.x=0.5*(p.x+s.x);this.m_centroid.y=0.5*(p.y+s.y);this.m_normals[0]=b.CrossVF(b.SubtractVV(s,p),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};d.AsEdge=function(p,t){var s=new d;s.SetAsEdge(p,t);return s};d.prototype.TestPoint=function(p,B){var s;s=p.R;for(var A=B.x-p.position.x,t=B.y-p.position.y,y=A*s.col1.x+t*s.col1.y,w=A*s.col2.x+t*s.col2.y,v=0;v<this.m_vertexCount;++v){s=this.m_vertices[v];A=y-s.x;t=w-s.y;s=this.m_normals[v];if(s.x*A+s.y*t>0){return false}}return true};d.prototype.RayCast=function(v,F,I){var s=0,G=F.maxFraction,A=0,J=0,y,B;A=F.p1.x-I.position.x;J=F.p1.y-I.position.y;y=I.R;var w=A*y.col1.x+J*y.col1.y,p=A*y.col2.x+J*y.col2.y;A=F.p2.x-I.position.x;J=F.p2.y-I.position.y;y=I.R;F=A*y.col1.x+J*y.col1.y-w;y=A*y.col2.x+J*y.col2.y-p;for(var t=parseInt(-1),C=0;C<this.m_vertexCount;++C){B=this.m_vertices[C];A=B.x-w;J=B.y-p;B=this.m_normals[C];A=B.x*A+B.y*J;J=B.x*F+B.y*y;if(J==0){if(A<0){return false}}else{if(J<0&&A<s*J){s=A/J;t=C}else{if(J>0&&A<G*J){G=A/J}}}if(G<s-Number.MIN_VALUE){return false}}if(t>=0){v.fraction=s;y=I.R;B=this.m_normals[t];v.normal.x=y.col1.x*B.x+y.col2.x*B.y;v.normal.y=y.col1.y*B.x+y.col2.y*B.y;return true}return false};d.prototype.ComputeAABB=function(s,A){for(var C=A.R,p=this.m_vertices[0],B=A.position.x+(C.col1.x*p.x+C.col2.x*p.y),w=A.position.y+(C.col1.y*p.x+C.col2.y*p.y),F=B,v=w,y=1;y<this.m_vertexCount;++y){p=this.m_vertices[y];var t=A.position.x+(C.col1.x*p.x+C.col2.x*p.y);p=A.position.y+(C.col1.y*p.x+C.col2.y*p.y);B=B<t?B:t;w=w<p?w:p;F=F>t?F:t;v=v>p?v:p}s.lowerBound.x=B-this.m_radius;s.lowerBound.y=w-this.m_radius;s.upperBound.x=F+this.m_radius;s.upperBound.y=v+this.m_radius};d.prototype.ComputeMass=function(w,J){if(J===undefined){J=0}if(this.m_vertexCount==2){w.center.x=0.5*(this.m_vertices[0].x+this.m_vertices[1].x);w.center.y=0.5*(this.m_vertices[0].y+this.m_vertices[1].y);w.mass=0;w.I=0}else{for(var L=0,s=0,K=0,F=0,M=1/3,B=0;B<this.m_vertexCount;++B){var G=this.m_vertices[B],A=B+1<this.m_vertexCount?this.m_vertices[parseInt(B+1)]:this.m_vertices[0],p=G.x-0,t=G.y-0,I=A.x-0,C=A.y-0,v=p*C-t*I,y=0.5*v;K+=y;L+=y*M*(0+G.x+A.x);s+=y*M*(0+G.y+A.y);G=p;t=t;I=I;C=C;F+=v*(M*(0.25*(G*G+I*G+I*I)+(0*G+0*I))+0+(M*(0.25*(t*t+C*t+C*C)+(0*t+0*C))+0))}w.mass=J*K;L*=1/K;s*=1/K;w.center.Set(L,s);w.I=J*F}};d.prototype.ComputeSubmergedArea=function(t,B,F,s){if(B===undefined){B=0}var C=b.MulTMV(F.R,t),y=B-b.Dot(t,F.position),G=new Vector_a2j_Number,w=0,A=parseInt(-1);B=parseInt(-1);var v=false;for(t=t=0;t<this.m_vertexCount;++t){G[t]=b.Dot(C,this.m_vertices[t])-y;var p=G[t]<-Number.MIN_VALUE;if(t>0){if(p){if(!v){A=t-1;w++}}else{if(v){B=t-1;w++}}}v=p}switch(w){case 0:if(v){t=new o;this.ComputeMass(t,1);s.SetV(b.MulX(F,t.center));return t.mass}else{return 0}case 1:if(A==-1){A=this.m_vertexCount-1}else{B=this.m_vertexCount-1}}t=parseInt((A+1)%this.m_vertexCount);C=parseInt((B+1)%this.m_vertexCount);y=(0-G[A])/(G[t]-G[A]);G=(0-G[B])/(G[C]-G[B]);A=new f(this.m_vertices[A].x*(1-y)+this.m_vertices[t].x*y,this.m_vertices[A].y*(1-y)+this.m_vertices[t].y*y);B=new f(this.m_vertices[B].x*(1-G)+this.m_vertices[C].x*G,this.m_vertices[B].y*(1-G)+this.m_vertices[C].y*G);G=0;y=new f;w=this.m_vertices[t];for(t=t;t!=C;){t=(t+1)%this.m_vertexCount;v=t==C?B:this.m_vertices[t];p=0.5*((w.x-A.x)*(v.y-A.y)-(w.y-A.y)*(v.x-A.x));G+=p;y.x+=p*(A.x+w.x+v.x)/3;y.y+=p*(A.y+w.y+v.y)/3;w=v}y.Multiply(1/G);s.SetV(b.MulX(F,y));return G};d.prototype.GetVertexCount=function(){return this.m_vertexCount};d.prototype.GetVertices=function(){return this.m_vertices};d.prototype.GetNormals=function(){return this.m_normals};d.prototype.GetSupport=function(p){for(var w=0,s=this.m_vertices[0].x*p.x+this.m_vertices[0].y*p.y,v=1;v<this.m_vertexCount;++v){var t=this.m_vertices[v].x*p.x+this.m_vertices[v].y*p.y;if(t>s){w=v;s=t}}return w};d.prototype.GetSupportVertex=function(p){for(var w=0,s=this.m_vertices[0].x*p.x+this.m_vertices[0].y*p.y,v=1;v<this.m_vertexCount;++v){var t=this.m_vertices[v].x*p.x+this.m_vertices[v].y*p.y;if(t>s){w=v;s=t}}return this.m_vertices[w]};d.prototype.Validate=function(){return false};d.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=g.e_polygonShape;this.m_centroid=new f;this.m_vertices=new Vector;this.m_normals=new Vector};d.prototype.Reserve=function(p){if(p===undefined){p=0}for(var s=parseInt(this.m_vertices.length);s<p;s++){this.m_vertices[s]=new f;this.m_normals[s]=new f}};d.ComputeCentroid=function(s,y){if(y===undefined){y=0}for(var B=new f,p=0,A=1/3,v=0;v<y;++v){var C=s[v],t=v+1<y?s[parseInt(v+1)]:s[0],w=0.5*((C.x-0)*(t.y-0)-(C.y-0)*(t.x-0));p+=w;B.x+=w*A*(0+C.x+t.x);B.y+=w*A*(0+C.y+t.y)}B.x*=1/p;B.y*=1/p;return B};d.ComputeOBB=function(K,y,B){if(B===undefined){B=0}var F=0,A=new Vector(B+1);for(F=0;F<B;++F){A[F]=y[F]}A[B]=A[0];y=Number.MAX_VALUE;for(F=1;F<=B;++F){var v=A[parseInt(F-1)],C=A[F].x-v.x,t=A[F].y-v.y,w=Math.sqrt(C*C+t*t);C/=w;t/=w;for(var s=-t,Q=C,p=w=Number.MAX_VALUE,P=-Number.MAX_VALUE,M=-Number.MAX_VALUE,J=0;J<B;++J){var L=A[J].x-v.x,I=A[J].y-v.y,G=C*L+t*I;L=s*L+Q*I;if(G<w){w=G}if(L<p){p=L}if(G>P){P=G}if(L>M){M=L}}J=(P-w)*(M-p);if(J<0.95*y){y=J;K.R.col1.x=C;K.R.col1.y=t;K.R.col2.x=s;K.R.col2.y=Q;C=0.5*(w+P);t=0.5*(p+M);s=K.R;K.center.x=v.x+(s.col1.x*C+s.col2.x*t);K.center.y=v.y+(s.col1.y*C+s.col2.y*t);K.extents.x=0.5*(P-w);K.extents.y=0.5*(M-p)}}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new c});g.b2Shape=function(){};g.prototype.Copy=function(){return null};g.prototype.Set=function(p){this.m_radius=p.m_radius};g.prototype.GetType=function(){return this.m_type};g.prototype.TestPoint=function(){return false};g.prototype.RayCast=function(){return false};g.prototype.ComputeAABB=function(){};g.prototype.ComputeMass=function(){};g.prototype.ComputeSubmergedArea=function(){return 0};g.TestOverlap=function(p,w,s,v){var t=new k;t.proxyA=new e;t.proxyA.Set(p);t.proxyB=new e;t.proxyB.Set(s);t.transformA=w;t.transformB=v;t.useRadii=true;p=new a;p.count=0;w=new n;j.Distance(w,p,t);return w.distance<10*Number.MIN_VALUE};g.prototype.b2Shape=function(){this.m_type=g.e_unknownShape;this.m_radius=r.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})})();(function(){var c=Box2D.Common.b2Color,b=Box2D.Common.b2Settings,a=Box2D.Common.Math.b2Math;c.b2Color=function(){this._b=this._g=this._r=0};c.prototype.b2Color=function(f,e,d){if(f===undefined){f=0}if(e===undefined){e=0}if(d===undefined){d=0}this._r=Box2D.parseUInt(255*a.Clamp(f,0,1));this._g=Box2D.parseUInt(255*a.Clamp(e,0,1));this._b=Box2D.parseUInt(255*a.Clamp(d,0,1))};c.prototype.Set=function(f,e,d){if(f===undefined){f=0}if(e===undefined){e=0}if(d===undefined){d=0}this._r=Box2D.parseUInt(255*a.Clamp(f,0,1));this._g=Box2D.parseUInt(255*a.Clamp(e,0,1));this._b=Box2D.parseUInt(255*a.Clamp(d,0,1))};Object.defineProperty(c.prototype,"r",{enumerable:false,configurable:true,set:function(d){if(d===undefined){d=0}this._r=Box2D.parseUInt(255*a.Clamp(d,0,1))}});Object.defineProperty(c.prototype,"g",{enumerable:false,configurable:true,set:function(d){if(d===undefined){d=0}this._g=Box2D.parseUInt(255*a.Clamp(d,0,1))}});Object.defineProperty(c.prototype,"b",{enumerable:false,configurable:true,set:function(d){if(d===undefined){d=0}this._b=Box2D.parseUInt(255*a.Clamp(d,0,1))}});Object.defineProperty(c.prototype,"color",{enumerable:false,configurable:true,get:function(){return this._r<<16|this._g<<8|this._b}});b.b2Settings=function(){};b.b2MixFriction=function(e,d){if(e===undefined){e=0}if(d===undefined){d=0}return Math.sqrt(e*d)};b.b2MixRestitution=function(e,d){if(e===undefined){e=0}if(d===undefined){d=0}return e>d?e:d};b.b2Assert=function(d){if(!d){throw"Assertion Failed"}};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=0.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*b.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=0.005;Box2D.Common.b2Settings.b2_angularSlop=2/180*b.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*b.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=1;Box2D.Common.b2Settings.b2_maxLinearCorrection=0.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*b.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=b.b2_maxTranslation*b.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=0.5*b.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=b.b2_maxRotation*b.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=0.2;Box2D.Common.b2Settings.b2_timeToSleep=0.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=0.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*b.b2_pi})})();(function(){var f=Box2D.Common.Math.b2Mat22,e=Box2D.Common.Math.b2Mat33,c=Box2D.Common.Math.b2Math,g=Box2D.Common.Math.b2Sweep,b=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,d=Box2D.Common.Math.b2Vec3;f.b2Mat22=function(){this.col1=new a;this.col2=new a};f.prototype.b2Mat22=function(){this.SetIdentity()};f.FromAngle=function(h){if(h===undefined){h=0}var j=new f;j.Set(h);return j};f.FromVV=function(j,k){var h=new f;h.SetVV(j,k);return h};f.prototype.Set=function(h){if(h===undefined){h=0}var j=Math.cos(h);h=Math.sin(h);this.col1.x=j;this.col2.x=-h;this.col1.y=h;this.col2.y=j};f.prototype.SetVV=function(h,j){this.col1.SetV(h);this.col2.SetV(j)};f.prototype.Copy=function(){var h=new f;h.SetM(this);return h};f.prototype.SetM=function(h){this.col1.SetV(h.col1);this.col2.SetV(h.col2)};f.prototype.AddM=function(h){this.col1.x+=h.col1.x;this.col1.y+=h.col1.y;this.col2.x+=h.col2.x;this.col2.y+=h.col2.y};f.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};f.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};f.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};f.prototype.GetInverse=function(l){var n=this.col1.x,k=this.col2.x,j=this.col1.y,m=this.col2.y,h=n*m-k*j;if(h!=0){h=1/h}l.col1.x=h*m;l.col2.x=-h*k;l.col1.y=-h*j;l.col2.y=h*n;return l};f.prototype.Solve=function(n,q,m){if(q===undefined){q=0}if(m===undefined){m=0}var k=this.col1.x,o=this.col2.x,j=this.col1.y,l=this.col2.y,h=k*l-o*j;if(h!=0){h=1/h}n.x=h*(l*q-o*m);n.y=h*(k*m-j*q);return n};f.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};e.b2Mat33=function(){this.col1=new d;this.col2=new d;this.col3=new d};e.prototype.b2Mat33=function(j,k,h){if(j===undefined){j=null}if(k===undefined){k=null}if(h===undefined){h=null}if(!j&&!k&&!h){this.col1.SetZero();this.col2.SetZero();this.col3.SetZero()}else{this.col1.SetV(j);this.col2.SetV(k);this.col3.SetV(h)}};e.prototype.SetVVV=function(j,k,h){this.col1.SetV(j);this.col2.SetV(k);this.col3.SetV(h)};e.prototype.Copy=function(){return new e(this.col1,this.col2,this.col3)};e.prototype.SetM=function(h){this.col1.SetV(h.col1);this.col2.SetV(h.col2);this.col3.SetV(h.col3)};e.prototype.AddM=function(h){this.col1.x+=h.col1.x;this.col1.y+=h.col1.y;this.col1.z+=h.col1.z;this.col2.x+=h.col2.x;this.col2.y+=h.col2.y;this.col2.z+=h.col2.z;this.col3.x+=h.col3.x;this.col3.y+=h.col3.y;this.col3.z+=h.col3.z};e.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};e.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};e.prototype.Solve22=function(n,q,m){if(q===undefined){q=0}if(m===undefined){m=0}var k=this.col1.x,o=this.col2.x,j=this.col1.y,l=this.col2.y,h=k*l-o*j;if(h!=0){h=1/h}n.x=h*(l*q-o*m);n.y=h*(k*m-j*q);return n};e.prototype.Solve33=function(m,l,r,o){if(l===undefined){l=0}if(r===undefined){r=0}if(o===undefined){o=0}var s=this.col1.x,v=this.col1.y,w=this.col1.z,n=this.col2.x,j=this.col2.y,q=this.col2.z,t=this.col3.x,A=this.col3.y,h=this.col3.z,y=s*(j*h-q*A)+v*(q*t-n*h)+w*(n*A-j*t);if(y!=0){y=1/y}m.x=y*(l*(j*h-q*A)+r*(q*t-n*h)+o*(n*A-j*t));m.y=y*(s*(r*h-o*A)+v*(o*t-l*h)+w*(l*A-r*t));m.z=y*(s*(j*o-q*r)+v*(q*l-n*o)+w*(n*r-j*l));return m};c.b2Math=function(){};c.IsValid=function(h){if(h===undefined){h=0}return isFinite(h)};c.Dot=function(h,j){return h.x*j.x+h.y*j.y};c.CrossVV=function(h,j){return h.x*j.y-h.y*j.x};c.CrossVF=function(h,j){if(j===undefined){j=0}return new a(j*h.y,-j*h.x)};c.CrossFV=function(h,j){if(h===undefined){h=0}return new a(-h*j.y,h*j.x)};c.MulMV=function(h,j){return new a(h.col1.x*j.x+h.col2.x*j.y,h.col1.y*j.x+h.col2.y*j.y)};c.MulTMV=function(h,j){return new a(c.Dot(j,h.col1),c.Dot(j,h.col2))};c.MulX=function(j,k){var h=c.MulMV(j.R,k);h.x+=j.position.x;h.y+=j.position.y;return h};c.MulXT=function(k,l){var j=c.SubtractVV(l,k.position),h=j.x*k.R.col1.x+j.y*k.R.col1.y;j.y=j.x*k.R.col2.x+j.y*k.R.col2.y;j.x=h;return j};c.AddVV=function(h,j){return new a(h.x+j.x,h.y+j.y)};c.SubtractVV=function(h,j){return new a(h.x-j.x,h.y-j.y)};c.Distance=function(k,l){var j=k.x-l.x,h=k.y-l.y;return Math.sqrt(j*j+h*h)};c.DistanceSquared=function(k,l){var j=k.x-l.x,h=k.y-l.y;return j*j+h*h};c.MulFV=function(h,j){if(h===undefined){h=0}return new a(h*j.x,h*j.y)};c.AddMM=function(h,j){return f.FromVV(c.AddVV(h.col1,j.col1),c.AddVV(h.col2,j.col2))};c.MulMM=function(h,j){return f.FromVV(c.MulMV(h,j.col1),c.MulMV(h,j.col2))};c.MulTMM=function(k,l){var j=new a(c.Dot(k.col1,l.col1),c.Dot(k.col2,l.col1)),h=new a(c.Dot(k.col1,l.col2),c.Dot(k.col2,l.col2));return f.FromVV(j,h)};c.Abs=function(h){if(h===undefined){h=0}return h>0?h:-h};c.AbsV=function(h){return new a(c.Abs(h.x),c.Abs(h.y))};c.AbsM=function(h){return f.FromVV(c.AbsV(h.col1),c.AbsV(h.col2))};c.Min=function(h,j){if(h===undefined){h=0}if(j===undefined){j=0}return h<j?h:j};c.MinV=function(h,j){return new a(c.Min(h.x,j.x),c.Min(h.y,j.y))};c.Max=function(h,j){if(h===undefined){h=0}if(j===undefined){j=0}return h>j?h:j};c.MaxV=function(h,j){return new a(c.Max(h.x,j.x),c.Max(h.y,j.y))};c.Clamp=function(j,k,h){if(j===undefined){j=0}if(k===undefined){k=0}if(h===undefined){h=0}return j<k?k:j>h?h:j};c.ClampV=function(j,k,h){return c.MaxV(k,c.MinV(j,h))};c.Swap=function(j,k){var h=j[0];j[0]=k[0];k[0]=h};c.Random=function(){return Math.random()*2-1};c.RandomRange=function(j,k){if(j===undefined){j=0}if(k===undefined){k=0}var h=Math.random();return h=(k-j)*h+j};c.NextPowerOfTwo=function(h){if(h===undefined){h=0}h|=h>>1&2147483647;h|=h>>2&1073741823;h|=h>>4&268435455;h|=h>>8&16777215;h|=h>>16&65535;return h+1};c.IsPowerOfTwo=function(h){if(h===undefined){h=0}return h>0&&(h&h-1)==0};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new a(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=f.FromVV(new a(1,0),new a(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new b(c.b2Vec2_zero,c.b2Mat22_identity)});g.b2Sweep=function(){this.localCenter=new a;this.c0=new a;this.c=new a};g.prototype.Set=function(h){this.localCenter.SetV(h.localCenter);this.c0.SetV(h.c0);this.c.SetV(h.c);this.a0=h.a0;this.a=h.a;this.t0=h.t0};g.prototype.Copy=function(){var h=new g;h.localCenter.SetV(this.localCenter);h.c0.SetV(this.c0);h.c.SetV(this.c);h.a0=this.a0;h.a=this.a;h.t0=this.t0;return h};g.prototype.GetTransform=function(j,k){if(k===undefined){k=0}j.position.x=(1-k)*this.c0.x+k*this.c.x;j.position.y=(1-k)*this.c0.y+k*this.c.y;j.R.Set((1-k)*this.a0+k*this.a);var h=j.R;j.position.x-=h.col1.x*this.localCenter.x+h.col2.x*this.localCenter.y;j.position.y-=h.col1.y*this.localCenter.x+h.col2.y*this.localCenter.y};g.prototype.Advance=function(h){if(h===undefined){h=0}if(this.t0<h&&1-this.t0>Number.MIN_VALUE){var j=(h-this.t0)/(1-this.t0);this.c0.x=(1-j)*this.c0.x+j*this.c.x;this.c0.y=(1-j)*this.c0.y+j*this.c.y;this.a0=(1-j)*this.a0+j*this.a;this.t0=h}};b.b2Transform=function(){this.position=new a;this.R=new f};b.prototype.b2Transform=function(h,j){if(h===undefined){h=null}if(j===undefined){j=null}if(h){this.position.SetV(h);this.R.SetM(j)}};b.prototype.Initialize=function(h,j){this.position.SetV(h);this.R.SetM(j)};b.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};b.prototype.Set=function(h){this.position.SetV(h.position);this.R.SetM(h.R)};b.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};a.b2Vec2=function(){};a.prototype.b2Vec2=function(h,j){if(h===undefined){h=0}if(j===undefined){j=0}this.x=h;this.y=j};a.prototype.SetZero=function(){this.y=this.x=0};a.prototype.Set=function(h,j){if(h===undefined){h=0}if(j===undefined){j=0}this.x=h;this.y=j};a.prototype.SetV=function(h){this.x=h.x;this.y=h.y};a.prototype.GetNegative=function(){return new a(-this.x,-this.y)};a.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};a.Make=function(h,j){if(h===undefined){h=0}if(j===undefined){j=0}return new a(h,j)};a.prototype.Copy=function(){return new a(this.x,this.y)};a.prototype.Add=function(h){this.x+=h.x;this.y+=h.y};a.prototype.Subtract=function(h){this.x-=h.x;this.y-=h.y};a.prototype.Multiply=function(h){if(h===undefined){h=0}this.x*=h;this.y*=h};a.prototype.MulM=function(h){var j=this.x;this.x=h.col1.x*j+h.col2.x*this.y;this.y=h.col1.y*j+h.col2.y*this.y};a.prototype.MulTM=function(h){var j=c.Dot(this,h.col1);this.y=c.Dot(this,h.col2);this.x=j};a.prototype.CrossVF=function(h){if(h===undefined){h=0}var j=this.x;this.x=h*this.y;this.y=-h*j};a.prototype.CrossFV=function(h){if(h===undefined){h=0}var j=this.x;this.x=-h*this.y;this.y=h*j};a.prototype.MinV=function(h){this.x=this.x<h.x?this.x:h.x;this.y=this.y<h.y?this.y:h.y};a.prototype.MaxV=function(h){this.x=this.x>h.x?this.x:h.x;this.y=this.y>h.y?this.y:h.y};a.prototype.Abs=function(){if(this.x<0){this.x=-this.x}if(this.y<0){this.y=-this.y}};a.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};a.prototype.Normalize=function(){var h=Math.sqrt(this.x*this.x+this.y*this.y);if(h<Number.MIN_VALUE){return 0}var j=1/h;this.x*=j;this.y*=j;return h};a.prototype.IsValid=function(){return c.IsValid(this.x)&&c.IsValid(this.y)};d.b2Vec3=function(){};d.prototype.b2Vec3=function(j,k,h){if(j===undefined){j=0}if(k===undefined){k=0}if(h===undefined){h=0}this.x=j;this.y=k;this.z=h};d.prototype.SetZero=function(){this.x=this.y=this.z=0};d.prototype.Set=function(j,k,h){if(j===undefined){j=0}if(k===undefined){k=0}if(h===undefined){h=0}this.x=j;this.y=k;this.z=h};d.prototype.SetV=function(h){this.x=h.x;this.y=h.y;this.z=h.z};d.prototype.GetNegative=function(){return new d(-this.x,-this.y,-this.z)};d.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};d.prototype.Copy=function(){return new d(this.x,this.y,this.z)};d.prototype.Add=function(h){this.x+=h.x;this.y+=h.y;this.z+=h.z};d.prototype.Subtract=function(h){this.x-=h.x;this.y-=h.y;this.z-=h.z};d.prototype.Multiply=function(h){if(h===undefined){h=0}this.x*=h;this.y*=h;this.z*=h}})();(function(){var af=Box2D.Common.Math.b2Math,ad=Box2D.Common.Math.b2Sweep,P=Box2D.Common.Math.b2Transform,T=Box2D.Common.Math.b2Vec2,ac=Box2D.Common.b2Color,ak=Box2D.Common.b2Settings,f=Box2D.Collision.b2AABB,al=Box2D.Collision.b2ContactPoint,aj=Box2D.Collision.b2DynamicTreeBroadPhase,r=Box2D.Collision.b2RayCastInput,e=Box2D.Collision.b2RayCastOutput,v=Box2D.Collision.Shapes.b2CircleShape,C=Box2D.Collision.Shapes.b2EdgeShape,X=Box2D.Collision.Shapes.b2MassData,c=Box2D.Collision.Shapes.b2PolygonShape,b=Box2D.Collision.Shapes.b2Shape,ap=Box2D.Dynamics.b2Body,J=Box2D.Dynamics.b2BodyDef,ae=Box2D.Dynamics.b2ContactFilter,ah=Box2D.Dynamics.b2ContactImpulse,ab=Box2D.Dynamics.b2ContactListener,s=Box2D.Dynamics.b2ContactManager,ag=Box2D.Dynamics.b2DebugDraw,m=Box2D.Dynamics.b2DestructionListener,t=Box2D.Dynamics.b2FilterData,g=Box2D.Dynamics.b2Fixture,au=Box2D.Dynamics.b2FixtureDef,a=Box2D.Dynamics.b2Island,at=Box2D.Dynamics.b2TimeStep,ar=Box2D.Dynamics.b2World,ao=Box2D.Dynamics.Contacts.b2Contact,aq=Box2D.Dynamics.Contacts.b2ContactFactory,am=Box2D.Dynamics.Contacts.b2ContactSolver,ai=Box2D.Dynamics.Joints.b2Joint,an=Box2D.Dynamics.Joints.b2PulleyJoint;ap.b2Body=function(){this.m_xf=new P;this.m_sweep=new ad;this.m_linearVelocity=new T;this.m_force=new T};ap.prototype.connectEdges=function(h,n,j){if(j===undefined){j=0}var d=Math.atan2(n.GetDirectionVector().y,n.GetDirectionVector().x);j=af.MulFV(Math.tan((d-j)*0.5),n.GetDirectionVector());j=af.SubtractVV(j,n.GetNormalVector());j=af.MulFV(ak.b2_toiSlop,j);j=af.AddVV(j,n.GetVertex1());var l=af.AddVV(h.GetDirectionVector(),n.GetDirectionVector());l.Normalize();var k=af.Dot(h.GetDirectionVector(),n.GetNormalVector())>0;h.SetNextEdge(n,j,l,k);n.SetPrevEdge(h,j,l,k);return d};ap.prototype.CreateFixture=function(d){if(this.m_world.IsLocked()==true){return null}var h=new g;h.Create(this,this.m_xf,d);this.m_flags&ap.e_activeFlag&&h.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);h.m_next=this.m_fixtureList;this.m_fixtureList=h;++this.m_fixtureCount;h.m_body=this;h.m_density>0&&this.ResetMassData();this.m_world.m_flags|=ar.e_newFixture;return h};ap.prototype.CreateFixture2=function(d,j){if(j===undefined){j=0}var h=new au;h.shape=d;h.density=j;return this.CreateFixture(h)};ap.prototype.DestroyFixture=function(h){if(this.m_world.IsLocked()!=true){for(var l=this.m_fixtureList,j=null;l!=null;){if(l==h){if(j){j.m_next=h.m_next}else{this.m_fixtureList=h.m_next}break}j=l;l=l.m_next}for(l=this.m_contactList;l;){j=l.contact;l=l.next;var d=j.GetFixtureA(),k=j.GetFixtureB();if(h==d||h==k){this.m_world.m_contactManager.Destroy(j)}}this.m_flags&ap.e_activeFlag&&h.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);h.Destroy();h.m_body=null;h.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};ap.prototype.SetPositionAndAngle=function(h,k){if(k===undefined){k=0}var j;if(this.m_world.IsLocked()!=true){this.m_xf.R.Set(k);this.m_xf.position.SetV(h);j=this.m_xf.R;var d=this.m_sweep.localCenter;this.m_sweep.c.x=j.col1.x*d.x+j.col2.x*d.y;this.m_sweep.c.y=j.col1.y*d.x+j.col2.y*d.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=k;d=this.m_world.m_contactManager.m_broadPhase;for(j=this.m_fixtureList;j;j=j.m_next){j.Synchronize(d,this.m_xf,this.m_xf)}this.m_world.m_contactManager.FindNewContacts()}};ap.prototype.SetTransform=function(d){this.SetPositionAndAngle(d.position,d.GetAngle())};ap.prototype.GetTransform=function(){return this.m_xf};ap.prototype.GetPosition=function(){return this.m_xf.position};ap.prototype.SetPosition=function(d){this.SetPositionAndAngle(d,this.GetAngle())};ap.prototype.GetAngle=function(){return this.m_sweep.a};ap.prototype.SetAngle=function(d){if(d===undefined){d=0}this.SetPositionAndAngle(this.GetPosition(),d)};ap.prototype.GetWorldCenter=function(){return this.m_sweep.c};ap.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};ap.prototype.SetLinearVelocity=function(d){this.m_type!=ap.b2_staticBody&&this.m_linearVelocity.SetV(d)};ap.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};ap.prototype.SetAngularVelocity=function(d){if(d===undefined){d=0}if(this.m_type!=ap.b2_staticBody){this.m_angularVelocity=d}};ap.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};ap.prototype.GetDefinition=function(){var d=new J;d.type=this.GetType();d.allowSleep=(this.m_flags&ap.e_allowSleepFlag)==ap.e_allowSleepFlag;d.angle=this.GetAngle();d.angularDamping=this.m_angularDamping;d.angularVelocity=this.m_angularVelocity;d.fixedRotation=(this.m_flags&ap.e_fixedRotationFlag)==ap.e_fixedRotationFlag;d.bullet=(this.m_flags&ap.e_bulletFlag)==ap.e_bulletFlag;d.awake=(this.m_flags&ap.e_awakeFlag)==ap.e_awakeFlag;d.linearDamping=this.m_linearDamping;d.linearVelocity.SetV(this.GetLinearVelocity());d.position=this.GetPosition();d.userData=this.GetUserData();return d};ap.prototype.ApplyForce=function(d,h){if(this.m_type==ap.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_force.x+=d.x;this.m_force.y+=d.y;this.m_torque+=(h.x-this.m_sweep.c.x)*d.y-(h.y-this.m_sweep.c.y)*d.x}};ap.prototype.ApplyTorque=function(d){if(d===undefined){d=0}if(this.m_type==ap.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_torque+=d}};ap.prototype.ApplyImpulse=function(d,h){if(this.m_type==ap.b2_dynamicBody){this.IsAwake()==false&&this.SetAwake(true);this.m_linearVelocity.x+=this.m_invMass*d.x;this.m_linearVelocity.y+=this.m_invMass*d.y;this.m_angularVelocity+=this.m_invI*((h.x-this.m_sweep.c.x)*d.y-(h.y-this.m_sweep.c.y)*d.x)}};ap.prototype.Split=function(j){for(var p=this.GetLinearVelocity().Copy(),l=this.GetAngularVelocity(),h=this.GetWorldCenter(),o=this.m_world.CreateBody(this.GetDefinition()),n,d=this.m_fixtureList;d;){if(j(d)){var k=d.m_next;if(n){n.m_next=k}else{this.m_fixtureList=k}this.m_fixtureCount--;d.m_next=o.m_fixtureList;o.m_fixtureList=d;o.m_fixtureCount++;d.m_body=o;d=k}else{n=d;d=d.m_next}}this.ResetMassData();o.ResetMassData();n=this.GetWorldCenter();j=o.GetWorldCenter();n=af.AddVV(p,af.CrossFV(l,af.SubtractVV(n,h)));p=af.AddVV(p,af.CrossFV(l,af.SubtractVV(j,h)));this.SetLinearVelocity(n);o.SetLinearVelocity(p);this.SetAngularVelocity(l);o.SetAngularVelocity(l);this.SynchronizeFixtures();o.SynchronizeFixtures();return o};ap.prototype.Merge=function(h){var l;for(l=h.m_fixtureList;l;){var j=l.m_next;h.m_fixtureCount--;l.m_next=this.m_fixtureList;this.m_fixtureList=l;this.m_fixtureCount++;l.m_body=k;l=j}d.m_fixtureCount=0;var d=this,k=h;d.GetWorldCenter();k.GetWorldCenter();d.GetLinearVelocity().Copy();k.GetLinearVelocity().Copy();d.GetAngularVelocity();k.GetAngularVelocity();d.ResetMassData();this.SynchronizeFixtures()};ap.prototype.GetMass=function(){return this.m_mass};ap.prototype.GetInertia=function(){return this.m_I};ap.prototype.GetMassData=function(d){d.mass=this.m_mass;d.I=this.m_I;d.center.SetV(this.m_sweep.localCenter)};ap.prototype.SetMassData=function(d){ak.b2Assert(this.m_world.IsLocked()==false);if(this.m_world.IsLocked()!=true){if(this.m_type==ap.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=d.mass;if(this.m_mass<=0){this.m_mass=1}this.m_invMass=1/this.m_mass;if(d.I>0&&(this.m_flags&ap.e_fixedRotationFlag)==0){this.m_I=d.I-this.m_mass*(d.center.x*d.center.x+d.center.y*d.center.y);this.m_invI=1/this.m_I}var h=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(d.center);this.m_sweep.c0.SetV(af.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-h.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-h.x)}}};ap.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(!(this.m_type==ap.b2_staticBody||this.m_type==ap.b2_kinematicBody)){for(var d=T.Make(0,0),j=this.m_fixtureList;j;j=j.m_next){if(j.m_density!=0){var h=j.GetMassData();this.m_mass+=h.mass;d.x+=h.center.x*h.mass;d.y+=h.center.y*h.mass;this.m_I+=h.I}}if(this.m_mass>0){this.m_invMass=1/this.m_mass;d.x*=this.m_invMass;d.y*=this.m_invMass}else{this.m_invMass=this.m_mass=1}if(this.m_I>0&&(this.m_flags&ap.e_fixedRotationFlag)==0){this.m_I-=this.m_mass*(d.x*d.x+d.y*d.y);this.m_I*=this.m_inertiaScale;ak.b2Assert(this.m_I>0);this.m_invI=1/this.m_I}else{this.m_invI=this.m_I=0}j=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(d);this.m_sweep.c0.SetV(af.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-j.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-j.x)}};ap.prototype.GetWorldPoint=function(d){var h=this.m_xf.R;d=new T(h.col1.x*d.x+h.col2.x*d.y,h.col1.y*d.x+h.col2.y*d.y);d.x+=this.m_xf.position.x;d.y+=this.m_xf.position.y;return d};ap.prototype.GetWorldVector=function(d){return af.MulMV(this.m_xf.R,d)};ap.prototype.GetLocalPoint=function(d){return af.MulXT(this.m_xf,d)};ap.prototype.GetLocalVector=function(d){return af.MulTMV(this.m_xf.R,d)};ap.prototype.GetLinearVelocityFromWorldPoint=function(d){return new T(this.m_linearVelocity.x-this.m_angularVelocity*(d.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(d.x-this.m_sweep.c.x))};ap.prototype.GetLinearVelocityFromLocalPoint=function(d){var h=this.m_xf.R;d=new T(h.col1.x*d.x+h.col2.x*d.y,h.col1.y*d.x+h.col2.y*d.y);d.x+=this.m_xf.position.x;d.y+=this.m_xf.position.y;return new T(this.m_linearVelocity.x-this.m_angularVelocity*(d.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(d.x-this.m_sweep.c.x))};ap.prototype.GetLinearDamping=function(){return this.m_linearDamping};ap.prototype.SetLinearDamping=function(d){if(d===undefined){d=0}this.m_linearDamping=d};ap.prototype.GetAngularDamping=function(){return this.m_angularDamping};ap.prototype.SetAngularDamping=function(d){if(d===undefined){d=0}this.m_angularDamping=d};ap.prototype.SetType=function(d){if(d===undefined){d=0}if(this.m_type!=d){this.m_type=d;this.ResetMassData();if(this.m_type==ap.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0}this.SetAwake(true);this.m_force.SetZero();this.m_torque=0;for(d=this.m_contactList;d;d=d.next){d.contact.FlagForFiltering()}}};ap.prototype.GetType=function(){return this.m_type};ap.prototype.SetBullet=function(d){if(d){this.m_flags|=ap.e_bulletFlag}else{this.m_flags&=~ap.e_bulletFlag}};ap.prototype.IsBullet=function(){return(this.m_flags&ap.e_bulletFlag)==ap.e_bulletFlag};ap.prototype.SetSleepingAllowed=function(d){if(d){this.m_flags|=ap.e_allowSleepFlag}else{this.m_flags&=~ap.e_allowSleepFlag;this.SetAwake(true)}};ap.prototype.SetAwake=function(d){if(d){this.m_flags|=ap.e_awakeFlag;this.m_sleepTime=0}else{this.m_flags&=~ap.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0}};ap.prototype.IsAwake=function(){return(this.m_flags&ap.e_awakeFlag)==ap.e_awakeFlag};ap.prototype.SetFixedRotation=function(d){if(d){this.m_flags|=ap.e_fixedRotationFlag}else{this.m_flags&=~ap.e_fixedRotationFlag}this.ResetMassData()};ap.prototype.IsFixedRotation=function(){return(this.m_flags&ap.e_fixedRotationFlag)==ap.e_fixedRotationFlag};ap.prototype.SetActive=function(d){if(d!=this.IsActive()){var h;if(d){this.m_flags|=ap.e_activeFlag;d=this.m_world.m_contactManager.m_broadPhase;for(h=this.m_fixtureList;h;h=h.m_next){h.CreateProxy(d,this.m_xf)}}else{this.m_flags&=~ap.e_activeFlag;d=this.m_world.m_contactManager.m_broadPhase;for(h=this.m_fixtureList;h;h=h.m_next){h.DestroyProxy(d)}for(d=this.m_contactList;d;){h=d;d=d.next;this.m_world.m_contactManager.Destroy(h.contact)}this.m_contactList=null}}};ap.prototype.IsActive=function(){return(this.m_flags&ap.e_activeFlag)==ap.e_activeFlag};ap.prototype.IsSleepingAllowed=function(){return(this.m_flags&ap.e_allowSleepFlag)==ap.e_allowSleepFlag};ap.prototype.GetFixtureList=function(){return this.m_fixtureList};ap.prototype.GetJointList=function(){return this.m_jointList};ap.prototype.GetControllerList=function(){return this.m_controllerList};ap.prototype.GetContactList=function(){return this.m_contactList};ap.prototype.GetNext=function(){return this.m_next};ap.prototype.GetUserData=function(){return this.m_userData};ap.prototype.SetUserData=function(d){this.m_userData=d};ap.prototype.GetWorld=function(){return this.m_world};ap.prototype.b2Body=function(h,k){this.m_flags=0;if(h.bullet){this.m_flags|=ap.e_bulletFlag}if(h.fixedRotation){this.m_flags|=ap.e_fixedRotationFlag}if(h.allowSleep){this.m_flags|=ap.e_allowSleepFlag}if(h.awake){this.m_flags|=ap.e_awakeFlag}if(h.active){this.m_flags|=ap.e_activeFlag}this.m_world=k;this.m_xf.position.SetV(h.position);this.m_xf.R.Set(h.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=h.angle;var j=this.m_xf.R,d=this.m_sweep.localCenter;this.m_sweep.c.x=j.col1.x*d.x+j.col2.x*d.y;this.m_sweep.c.y=j.col1.y*d.x+j.col2.y*d.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_contactList=this.m_controllerList=this.m_jointList=null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.SetV(h.linearVelocity);this.m_angularVelocity=h.angularVelocity;this.m_linearDamping=h.linearDamping;this.m_angularDamping=h.angularDamping;this.m_force.Set(0,0);this.m_sleepTime=this.m_torque=0;this.m_type=h.type;if(this.m_type==ap.b2_dynamicBody){this.m_invMass=this.m_mass=1}else{this.m_invMass=this.m_mass=0}this.m_invI=this.m_I=0;this.m_inertiaScale=h.inertiaScale;this.m_userData=h.userData;this.m_fixtureList=null;this.m_fixtureCount=0};ap.prototype.SynchronizeFixtures=function(){var d=ap.s_xf1;d.R.Set(this.m_sweep.a0);var j=d.R,h=this.m_sweep.localCenter;d.position.x=this.m_sweep.c0.x-(j.col1.x*h.x+j.col2.x*h.y);d.position.y=this.m_sweep.c0.y-(j.col1.y*h.x+j.col2.y*h.y);h=this.m_world.m_contactManager.m_broadPhase;for(j=this.m_fixtureList;j;j=j.m_next){j.Synchronize(h,d,this.m_xf)}};ap.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var d=this.m_xf.R,h=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(d.col1.x*h.x+d.col2.x*h.y);this.m_xf.position.y=this.m_sweep.c.y-(d.col1.y*h.x+d.col2.y*h.y)};ap.prototype.ShouldCollide=function(d){if(this.m_type!=ap.b2_dynamicBody&&d.m_type!=ap.b2_dynamicBody){return false}for(var h=this.m_jointList;h;h=h.next){if(h.other==d){if(h.joint.m_collideConnected==false){return false}}}return true};ap.prototype.Advance=function(d){if(d===undefined){d=0}this.m_sweep.Advance(d);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new P;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});J.b2BodyDef=function(){this.position=new T;this.linearVelocity=new T};J.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=true;this.bullet=this.fixedRotation=false;this.type=ap.b2_staticBody;this.active=true;this.inertiaScale=1};ae.b2ContactFilter=function(){};ae.prototype.ShouldCollide=function(h,k){var j=h.GetFilterData(),d=k.GetFilterData();if(j.groupIndex==d.groupIndex&&j.groupIndex!=0){return j.groupIndex>0}return(j.maskBits&d.categoryBits)!=0&&(j.categoryBits&d.maskBits)!=0};ae.prototype.RayCollide=function(d,h){if(!d){return true}return this.ShouldCollide(d instanceof g?d:null,h)};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new ae});ah.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(ak.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(ak.b2_maxManifoldPoints)};ab.b2ContactListener=function(){};ab.prototype.BeginContact=function(){};ab.prototype.EndContact=function(){};ab.prototype.PreSolve=function(){};ab.prototype.PostSolve=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new ab});s.b2ContactManager=function(){};s.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=ae.b2_defaultFilter;this.m_contactListener=ab.b2_defaultListener;this.m_contactFactory=new aq(this.m_allocator);this.m_broadPhase=new aj};s.prototype.AddPair=function(p,n){var j=p instanceof g?p:null,o=n instanceof g?n:null,l=j.GetBody(),k=o.GetBody();if(l!=k){for(var h=k.GetContactList();h;){if(h.other==l){var d=h.contact.GetFixtureA(),q=h.contact.GetFixtureB();if(d==j&&q==o){return}if(d==o&&q==j){return}}h=h.next}if(k.ShouldCollide(l)!=false){if(this.m_contactFilter.ShouldCollide(j,o)!=false){h=this.m_contactFactory.Create(j,o);j=h.GetFixtureA();o=h.GetFixtureB();l=j.m_body;k=o.m_body;h.m_prev=null;h.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null){this.m_world.m_contactList.m_prev=h}this.m_world.m_contactList=h;h.m_nodeA.contact=h;h.m_nodeA.other=k;h.m_nodeA.prev=null;h.m_nodeA.next=l.m_contactList;if(l.m_contactList!=null){l.m_contactList.prev=h.m_nodeA}l.m_contactList=h.m_nodeA;h.m_nodeB.contact=h;h.m_nodeB.other=l;h.m_nodeB.prev=null;h.m_nodeB.next=k.m_contactList;if(k.m_contactList!=null){k.m_contactList.prev=h.m_nodeB}k.m_contactList=h.m_nodeB;++this.m_world.m_contactCount}}}};s.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};s.prototype.Destroy=function(d){var j=d.GetFixtureA(),h=d.GetFixtureB();j=j.GetBody();h=h.GetBody();d.IsTouching()&&this.m_contactListener.EndContact(d);if(d.m_prev){d.m_prev.m_next=d.m_next}if(d.m_next){d.m_next.m_prev=d.m_prev}if(d==this.m_world.m_contactList){this.m_world.m_contactList=d.m_next}if(d.m_nodeA.prev){d.m_nodeA.prev.next=d.m_nodeA.next}if(d.m_nodeA.next){d.m_nodeA.next.prev=d.m_nodeA.prev}if(d.m_nodeA==j.m_contactList){j.m_contactList=d.m_nodeA.next}if(d.m_nodeB.prev){d.m_nodeB.prev.next=d.m_nodeB.next}if(d.m_nodeB.next){d.m_nodeB.next.prev=d.m_nodeB.prev}if(d.m_nodeB==h.m_contactList){h.m_contactList=d.m_nodeB.next}this.m_contactFactory.Destroy(d);--this.m_contactCount};s.prototype.Collide=function(){for(var h=this.m_world.m_contactList;h;){var l=h.GetFixtureA(),j=h.GetFixtureB(),d=l.GetBody(),k=j.GetBody();if(d.IsAwake()==false&&k.IsAwake()==false){h=h.GetNext()}else{if(h.m_flags&ao.e_filterFlag){if(k.ShouldCollide(d)==false){l=h;h=l.GetNext();this.Destroy(l);continue}if(this.m_contactFilter.ShouldCollide(l,j)==false){l=h;h=l.GetNext();this.Destroy(l);continue}h.m_flags&=~ao.e_filterFlag}if(this.m_broadPhase.TestOverlap(l.m_proxy,j.m_proxy)==false){l=h;h=l.GetNext();this.Destroy(l)}else{h.Update(this.m_contactListener);h=h.GetNext()}}}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new al});ag.b2DebugDraw=function(){};ag.prototype.b2DebugDraw=function(){};ag.prototype.SetFlags=function(){};ag.prototype.GetFlags=function(){};ag.prototype.AppendFlags=function(){};ag.prototype.ClearFlags=function(){};ag.prototype.SetSprite=function(){};ag.prototype.GetSprite=function(){};ag.prototype.SetDrawScale=function(){};ag.prototype.GetDrawScale=function(){};ag.prototype.SetLineThickness=function(){};ag.prototype.GetLineThickness=function(){};ag.prototype.SetAlpha=function(){};ag.prototype.GetAlpha=function(){};ag.prototype.SetFillAlpha=function(){};ag.prototype.GetFillAlpha=function(){};ag.prototype.SetXFormScale=function(){};ag.prototype.GetXFormScale=function(){};ag.prototype.DrawPolygon=function(){};ag.prototype.DrawSolidPolygon=function(){};ag.prototype.DrawCircle=function(){};ag.prototype.DrawSolidCircle=function(){};ag.prototype.DrawSegment=function(){};ag.prototype.DrawTransform=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});m.b2DestructionListener=function(){};m.prototype.SayGoodbyeJoint=function(){};m.prototype.SayGoodbyeFixture=function(){};t.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};t.prototype.Copy=function(){var d=new t;d.categoryBits=this.categoryBits;d.maskBits=this.maskBits;d.groupIndex=this.groupIndex;return d};g.b2Fixture=function(){this.m_filter=new t};g.prototype.GetType=function(){return this.m_shape.GetType()};g.prototype.GetShape=function(){return this.m_shape};g.prototype.SetSensor=function(h){if(this.m_isSensor!=h){this.m_isSensor=h;if(this.m_body!=null){for(h=this.m_body.GetContactList();h;){var k=h.contact,j=k.GetFixtureA(),d=k.GetFixtureB();if(j==this||d==this){k.SetSensor(j.IsSensor()||d.IsSensor())}h=h.next}}}};g.prototype.IsSensor=function(){return this.m_isSensor};g.prototype.SetFilterData=function(h){this.m_filter=h.Copy();if(!this.m_body){for(h=this.m_body.GetContactList();h;){var k=h.contact,j=k.GetFixtureA(),d=k.GetFixtureB();if(j==this||d==this){k.FlagForFiltering()}h=h.next}}};g.prototype.GetFilterData=function(){return this.m_filter.Copy()};g.prototype.GetBody=function(){return this.m_body};g.prototype.GetNext=function(){return this.m_next};g.prototype.GetUserData=function(){return this.m_userData};g.prototype.SetUserData=function(d){this.m_userData=d};g.prototype.TestPoint=function(d){return this.m_shape.TestPoint(this.m_body.GetTransform(),d)};g.prototype.RayCast=function(d,h){return this.m_shape.RayCast(d,h,this.m_body.GetTransform())};g.prototype.GetMassData=function(d){if(d===undefined){d=null}if(d==null){d=new X}this.m_shape.ComputeMass(d,this.m_density);return d};g.prototype.SetDensity=function(d){if(d===undefined){d=0}this.m_density=d};g.prototype.GetDensity=function(){return this.m_density};g.prototype.GetFriction=function(){return this.m_friction};g.prototype.SetFriction=function(d){if(d===undefined){d=0}this.m_friction=d};g.prototype.GetRestitution=function(){return this.m_restitution};g.prototype.SetRestitution=function(d){if(d===undefined){d=0}this.m_restitution=d};g.prototype.GetAABB=function(){return this.m_aabb};g.prototype.b2Fixture=function(){this.m_aabb=new f;this.m_shape=this.m_next=this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0};g.prototype.Create=function(d,j,h){this.m_userData=h.userData;this.m_friction=h.friction;this.m_restitution=h.restitution;this.m_body=d;this.m_next=null;this.m_filter=h.filter.Copy();this.m_isSensor=h.isSensor;this.m_shape=h.shape.Copy();this.m_density=h.density};g.prototype.Destroy=function(){this.m_shape=null};g.prototype.CreateProxy=function(d,h){this.m_shape.ComputeAABB(this.m_aabb,h);this.m_proxy=d.CreateProxy(this.m_aabb,this)};g.prototype.DestroyProxy=function(d){if(this.m_proxy!=null){d.DestroyProxy(this.m_proxy);this.m_proxy=null}};g.prototype.Synchronize=function(h,l,j){if(this.m_proxy){var d=new f,k=new f;this.m_shape.ComputeAABB(d,l);this.m_shape.ComputeAABB(k,j);this.m_aabb.Combine(d,k);l=af.SubtractVV(j.position,l.position);h.MoveProxy(this.m_proxy,this.m_aabb,l)}};au.b2FixtureDef=function(){this.filter=new t};au.prototype.b2FixtureDef=function(){this.userData=this.shape=null;this.friction=0.2;this.density=this.restitution=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=false};a.b2Island=function(){};a.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};a.prototype.Initialize=function(j,o,k,h,n,l){if(j===undefined){j=0}if(o===undefined){o=0}if(k===undefined){k=0}var d=0;this.m_bodyCapacity=j;this.m_contactCapacity=o;this.m_jointCapacity=k;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=h;this.m_listener=n;this.m_contactSolver=l;for(d=this.m_bodies.length;d<j;d++){this.m_bodies[d]=null}for(d=this.m_contacts.length;d<o;d++){this.m_contacts[d]=null}for(d=this.m_joints.length;d<k;d++){this.m_joints[d]=null}};a.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};a.prototype.Solve=function(j,p,l){var h=0,o=0,n;for(h=0;h<this.m_bodyCount;++h){o=this.m_bodies[h];if(o.GetType()==ap.b2_dynamicBody){o.m_linearVelocity.x+=j.dt*(p.x+o.m_invMass*o.m_force.x);o.m_linearVelocity.y+=j.dt*(p.y+o.m_invMass*o.m_force.y);o.m_angularVelocity+=j.dt*o.m_invI*o.m_torque;o.m_linearVelocity.Multiply(af.Clamp(1-j.dt*o.m_linearDamping,0,1));o.m_angularVelocity*=af.Clamp(1-j.dt*o.m_angularDamping,0,1)}}this.m_contactSolver.Initialize(j,this.m_contacts,this.m_contactCount,this.m_allocator);p=this.m_contactSolver;p.InitVelocityConstraints(j);for(h=0;h<this.m_jointCount;++h){n=this.m_joints[h];n.InitVelocityConstraints(j)}for(h=0;h<j.velocityIterations;++h){for(o=0;o<this.m_jointCount;++o){n=this.m_joints[o];n.SolveVelocityConstraints(j)}p.SolveVelocityConstraints()}for(h=0;h<this.m_jointCount;++h){n=this.m_joints[h];n.FinalizeVelocityConstraints()}p.FinalizeVelocityConstraints();for(h=0;h<this.m_bodyCount;++h){o=this.m_bodies[h];if(o.GetType()!=ap.b2_staticBody){var d=j.dt*o.m_linearVelocity.x,k=j.dt*o.m_linearVelocity.y;if(d*d+k*k>ak.b2_maxTranslationSquared){o.m_linearVelocity.Normalize();o.m_linearVelocity.x*=ak.b2_maxTranslation*j.inv_dt;o.m_linearVelocity.y*=ak.b2_maxTranslation*j.inv_dt}d=j.dt*o.m_angularVelocity;if(d*d>ak.b2_maxRotationSquared){o.m_angularVelocity=o.m_angularVelocity<0?-ak.b2_maxRotation*j.inv_dt:ak.b2_maxRotation*j.inv_dt}o.m_sweep.c0.SetV(o.m_sweep.c);o.m_sweep.a0=o.m_sweep.a;o.m_sweep.c.x+=j.dt*o.m_linearVelocity.x;o.m_sweep.c.y+=j.dt*o.m_linearVelocity.y;o.m_sweep.a+=j.dt*o.m_angularVelocity;o.SynchronizeTransform()}}for(h=0;h<j.positionIterations;++h){d=p.SolvePositionConstraints(ak.b2_contactBaumgarte);k=true;for(o=0;o<this.m_jointCount;++o){n=this.m_joints[o];n=n.SolvePositionConstraints(ak.b2_contactBaumgarte);k=k&&n}if(d&&k){break}}this.Report(p.m_constraints);if(l){l=Number.MAX_VALUE;p=ak.b2_linearSleepTolerance*ak.b2_linearSleepTolerance;d=ak.b2_angularSleepTolerance*ak.b2_angularSleepTolerance;for(h=0;h<this.m_bodyCount;++h){o=this.m_bodies[h];if(o.GetType()!=ap.b2_staticBody){if((o.m_flags&ap.e_allowSleepFlag)==0){l=o.m_sleepTime=0}if((o.m_flags&ap.e_allowSleepFlag)==0||o.m_angularVelocity*o.m_angularVelocity>d||af.Dot(o.m_linearVelocity,o.m_linearVelocity)>p){l=o.m_sleepTime=0}else{o.m_sleepTime+=j.dt;l=af.Min(l,o.m_sleepTime)}}}if(l>=ak.b2_timeToSleep){for(h=0;h<this.m_bodyCount;++h){o=this.m_bodies[h];o.SetAwake(false)}}}};a.prototype.SolveTOI=function(j){var o=0,k=0;this.m_contactSolver.Initialize(j,this.m_contacts,this.m_contactCount,this.m_allocator);var h=this.m_contactSolver;for(o=0;o<this.m_jointCount;++o){this.m_joints[o].InitVelocityConstraints(j)}for(o=0;o<j.velocityIterations;++o){h.SolveVelocityConstraints();for(k=0;k<this.m_jointCount;++k){this.m_joints[k].SolveVelocityConstraints(j)}}for(o=0;o<this.m_bodyCount;++o){k=this.m_bodies[o];if(k.GetType()!=ap.b2_staticBody){var n=j.dt*k.m_linearVelocity.x,l=j.dt*k.m_linearVelocity.y;if(n*n+l*l>ak.b2_maxTranslationSquared){k.m_linearVelocity.Normalize();k.m_linearVelocity.x*=ak.b2_maxTranslation*j.inv_dt;k.m_linearVelocity.y*=ak.b2_maxTranslation*j.inv_dt}n=j.dt*k.m_angularVelocity;if(n*n>ak.b2_maxRotationSquared){k.m_angularVelocity=k.m_angularVelocity<0?-ak.b2_maxRotation*j.inv_dt:ak.b2_maxRotation*j.inv_dt}k.m_sweep.c0.SetV(k.m_sweep.c);k.m_sweep.a0=k.m_sweep.a;k.m_sweep.c.x+=j.dt*k.m_linearVelocity.x;k.m_sweep.c.y+=j.dt*k.m_linearVelocity.y;k.m_sweep.a+=j.dt*k.m_angularVelocity;k.SynchronizeTransform()}}for(o=0;o<j.positionIterations;++o){n=h.SolvePositionConstraints(0.75);l=true;for(k=0;k<this.m_jointCount;++k){var d=this.m_joints[k].SolvePositionConstraints(ak.b2_contactBaumgarte);l=l&&d}if(n&&l){break}}this.Report(h.m_constraints)};a.prototype.Report=function(h){if(this.m_listener!=null){for(var l=0;l<this.m_contactCount;++l){for(var j=this.m_contacts[l],d=h[l],k=0;k<d.pointCount;++k){a.s_impulse.normalImpulses[k]=d.points[k].normalImpulse;a.s_impulse.tangentImpulses[k]=d.points[k].tangentImpulse}this.m_listener.PostSolve(j,a.s_impulse)}}};a.prototype.AddBody=function(d){d.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=d};a.prototype.AddContact=function(d){this.m_contacts[this.m_contactCount++]=d};a.prototype.AddJoint=function(d){this.m_joints[this.m_jointCount++]=d};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new ah});at.b2TimeStep=function(){};at.prototype.Set=function(d){this.dt=d.dt;this.inv_dt=d.inv_dt;this.positionIterations=d.positionIterations;this.velocityIterations=d.velocityIterations;this.warmStarting=d.warmStarting};ar.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new s;this.m_contactSolver=new am;this.m_island=new a};ar.prototype.b2World=function(d,h){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;ar.m_warmStarting=true;ar.m_continuousPhysics=true;this.m_allowSleep=h;this.m_gravity=d;this.m_inv_dt0=0;this.m_contactManager.m_world=this;this.m_groundBody=this.CreateBody(new J)};ar.prototype.SetDestructionListener=function(d){this.m_destructionListener=d};ar.prototype.SetContactFilter=function(d){this.m_contactManager.m_contactFilter=d};ar.prototype.SetContactListener=function(d){this.m_contactManager.m_contactListener=d};ar.prototype.SetDebugDraw=function(d){this.m_debugDraw=d};ar.prototype.SetBroadPhase=function(h){var k=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=h;for(var j=this.m_bodyList;j;j=j.m_next){for(var d=j.m_fixtureList;d;d=d.m_next){d.m_proxy=h.CreateProxy(k.GetFatAABB(d.m_proxy),d)}}};ar.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};ar.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};ar.prototype.CreateBody=function(d){if(this.IsLocked()==true){return null}d=new ap(d,this);d.m_prev=null;if(d.m_next=this.m_bodyList){this.m_bodyList.m_prev=d}this.m_bodyList=d;++this.m_bodyCount;return d};ar.prototype.DestroyBody=function(d){if(this.IsLocked()!=true){for(var j=d.m_jointList;j;){var h=j;j=j.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(h.joint);this.DestroyJoint(h.joint)}for(j=d.m_controllerList;j;){h=j;j=j.nextController;h.controller.RemoveBody(d)}for(j=d.m_contactList;j;){h=j;j=j.next;this.m_contactManager.Destroy(h.contact)}d.m_contactList=null;for(j=d.m_fixtureList;j;){h=j;j=j.m_next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(h);h.DestroyProxy(this.m_contactManager.m_broadPhase);h.Destroy()}d.m_fixtureList=null;d.m_fixtureCount=0;if(d.m_prev){d.m_prev.m_next=d.m_next}if(d.m_next){d.m_next.m_prev=d.m_prev}if(d==this.m_bodyList){this.m_bodyList=d.m_next}--this.m_bodyCount}};ar.prototype.CreateJoint=function(h){var k=ai.Create(h,null);k.m_prev=null;if(k.m_next=this.m_jointList){this.m_jointList.m_prev=k}this.m_jointList=k;++this.m_jointCount;k.m_edgeA.joint=k;k.m_edgeA.other=k.m_bodyB;k.m_edgeA.prev=null;if(k.m_edgeA.next=k.m_bodyA.m_jointList){k.m_bodyA.m_jointList.prev=k.m_edgeA}k.m_bodyA.m_jointList=k.m_edgeA;k.m_edgeB.joint=k;k.m_edgeB.other=k.m_bodyA;k.m_edgeB.prev=null;if(k.m_edgeB.next=k.m_bodyB.m_jointList){k.m_bodyB.m_jointList.prev=k.m_edgeB}k.m_bodyB.m_jointList=k.m_edgeB;var j=h.bodyA,d=h.bodyB;if(h.collideConnected==false){for(h=d.GetContactList();h;){h.other==j&&h.contact.FlagForFiltering();h=h.next}}return k};ar.prototype.DestroyJoint=function(h){var k=h.m_collideConnected;if(h.m_prev){h.m_prev.m_next=h.m_next}if(h.m_next){h.m_next.m_prev=h.m_prev}if(h==this.m_jointList){this.m_jointList=h.m_next}var j=h.m_bodyA,d=h.m_bodyB;j.SetAwake(true);d.SetAwake(true);if(h.m_edgeA.prev){h.m_edgeA.prev.next=h.m_edgeA.next}if(h.m_edgeA.next){h.m_edgeA.next.prev=h.m_edgeA.prev}if(h.m_edgeA==j.m_jointList){j.m_jointList=h.m_edgeA.next}h.m_edgeA.prev=null;h.m_edgeA.next=null;if(h.m_edgeB.prev){h.m_edgeB.prev.next=h.m_edgeB.next}if(h.m_edgeB.next){h.m_edgeB.next.prev=h.m_edgeB.prev}if(h.m_edgeB==d.m_jointList){d.m_jointList=h.m_edgeB.next}h.m_edgeB.prev=null;h.m_edgeB.next=null;ai.Destroy(h,null);--this.m_jointCount;if(k==false){for(h=d.GetContactList();h;){h.other==j&&h.contact.FlagForFiltering();h=h.next}}};ar.prototype.AddController=function(d){d.m_next=this.m_controllerList;d.m_prev=null;this.m_controllerList=d;d.m_world=this;this.m_controllerCount++;return d};ar.prototype.RemoveController=function(d){if(d.m_prev){d.m_prev.m_next=d.m_next}if(d.m_next){d.m_next.m_prev=d.m_prev}if(this.m_controllerList==d){this.m_controllerList=d.m_next}this.m_controllerCount--};ar.prototype.CreateController=function(d){if(d.m_world!=this){throw Error("Controller can only be a member of one world")}d.m_next=this.m_controllerList;d.m_prev=null;if(this.m_controllerList){this.m_controllerList.m_prev=d}this.m_controllerList=d;++this.m_controllerCount;d.m_world=this;return d};ar.prototype.DestroyController=function(d){d.Clear();if(d.m_next){d.m_next.m_prev=d.m_prev}if(d.m_prev){d.m_prev.m_next=d.m_next}if(d==this.m_controllerList){this.m_controllerList=d.m_next}--this.m_controllerCount};ar.prototype.SetWarmStarting=function(d){ar.m_warmStarting=d};ar.prototype.SetContinuousPhysics=function(d){ar.m_continuousPhysics=d};ar.prototype.GetBodyCount=function(){return this.m_bodyCount};ar.prototype.GetJointCount=function(){return this.m_jointCount};ar.prototype.GetContactCount=function(){return this.m_contactCount};ar.prototype.SetGravity=function(d){this.m_gravity=d};ar.prototype.GetGravity=function(){return this.m_gravity};ar.prototype.GetGroundBody=function(){return this.m_groundBody};ar.prototype.Step=function(h,k,j){if(h===undefined){h=0}if(k===undefined){k=0}if(j===undefined){j=0}if(this.m_flags&ar.e_newFixture){this.m_contactManager.FindNewContacts();this.m_flags&=~ar.e_newFixture}this.m_flags|=ar.e_locked;var d=ar.s_timestep2;d.dt=h;d.velocityIterations=k;d.positionIterations=j;d.inv_dt=h>0?1/h:0;d.dtRatio=this.m_inv_dt0*h;d.warmStarting=ar.m_warmStarting;this.m_contactManager.Collide();d.dt>0&&this.Solve(d);ar.m_continuousPhysics&&d.dt>0&&this.SolveTOI(d);if(d.dt>0){this.m_inv_dt0=d.inv_dt}this.m_flags&=~ar.e_locked};ar.prototype.ClearForces=function(){for(var d=this.m_bodyList;d;d=d.m_next){d.m_force.SetZero();d.m_torque=0}};ar.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){var j=this.m_debugDraw.GetFlags(),o,k,h;new T;new T;new T;var n;new f;new f;n=[new T,new T,new T,new T];var l=new ac(0,0,0);if(j&ag.e_shapeBit){for(o=this.m_bodyList;o;o=o.m_next){n=o.m_xf;for(k=o.GetFixtureList();k;k=k.m_next){h=k.GetShape();if(o.IsActive()==false){l.Set(0.5,0.5,0.3)}else{if(o.GetType()==ap.b2_staticBody){l.Set(0.5,0.9,0.5)}else{if(o.GetType()==ap.b2_kinematicBody){l.Set(0.5,0.5,0.9)}else{o.IsAwake()==false?l.Set(0.6,0.6,0.6):l.Set(0.9,0.7,0.7)}}}this.DrawShape(h,n,l)}}}if(j&ag.e_jointBit){for(o=this.m_jointList;o;o=o.m_next){this.DrawJoint(o)}}if(j&ag.e_controllerBit){for(o=this.m_controllerList;o;o=o.m_next){o.Draw(this.m_debugDraw)}}if(j&ag.e_pairBit){l.Set(0.3,0.9,0.9);for(o=this.m_contactManager.m_contactList;o;o=o.GetNext()){h=o.GetFixtureA();k=o.GetFixtureB();h=h.GetAABB().GetCenter();k=k.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(h,k,l)}}if(j&ag.e_aabbBit){h=this.m_contactManager.m_broadPhase;n=[new T,new T,new T,new T];for(o=this.m_bodyList;o;o=o.GetNext()){if(o.IsActive()!=false){for(k=o.GetFixtureList();k;k=k.GetNext()){var d=h.GetFatAABB(k.m_proxy);n[0].Set(d.lowerBound.x,d.lowerBound.y);n[1].Set(d.upperBound.x,d.lowerBound.y);n[2].Set(d.upperBound.x,d.upperBound.y);n[3].Set(d.lowerBound.x,d.upperBound.y);this.m_debugDraw.DrawPolygon(n,4,l)}}}}if(j&ag.e_centerOfMassBit){for(o=this.m_bodyList;o;o=o.m_next){n=ar.s_xf;n.R=o.m_xf.R;n.position=o.GetWorldCenter();this.m_debugDraw.DrawTransform(n)}}}};ar.prototype.QueryAABB=function(d,j){var h=this.m_contactManager.m_broadPhase;h.Query(function(k){return d(h.GetUserData(k))},j)};ar.prototype.QueryShape=function(h,l,j){if(j===undefined){j=null}if(j==null){j=new P;j.SetIdentity()}var d=this.m_contactManager.m_broadPhase,k=new f;l.ComputeAABB(k,j);d.Query(function(n){n=d.GetUserData(n) instanceof g?d.GetUserData(n):null;if(b.TestOverlap(l,j,n.GetShape(),n.GetBody().GetTransform())){return h(n)}return true},k)};ar.prototype.QueryPoint=function(h,k){var j=this.m_contactManager.m_broadPhase,d=new f;d.lowerBound.Set(k.x-ak.b2_linearSlop,k.y-ak.b2_linearSlop);d.upperBound.Set(k.x+ak.b2_linearSlop,k.y+ak.b2_linearSlop);j.Query(function(l){l=j.GetUserData(l) instanceof g?j.GetUserData(l):null;if(l.TestPoint(k)){return h(l)}return true},d)};ar.prototype.RayCast=function(h,n,j){var d=this.m_contactManager.m_broadPhase,l=new e,k=new r(n,j);d.RayCast(function(o,w){var u=d.GetUserData(w);u=u instanceof g?u:null;if(u.RayCast(l,o)){var p=l.fraction,q=new T((1-p)*n.x+p*j.x,(1-p)*n.y+p*j.y);return h(u,q,l.normal,p)}return o.maxFraction},k)};ar.prototype.RayCastOne=function(d,j){var h;this.RayCast(function(l,o,n,k){if(k===undefined){k=0}h=l;return k},d,j);return h};ar.prototype.RayCastAll=function(d,j){var h=new Vector;this.RayCast(function(k){h[h.length]=k;return 1},d,j);return h};ar.prototype.GetBodyList=function(){return this.m_bodyList};ar.prototype.GetJointList=function(){return this.m_jointList};ar.prototype.GetContactList=function(){return this.m_contactList};ar.prototype.IsLocked=function(){return(this.m_flags&ar.e_locked)>0};ar.prototype.Solve=function(j){for(var p,l=this.m_controllerList;l;l=l.m_next){l.Step(j)}l=this.m_island;l.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(p=this.m_bodyList;p;p=p.m_next){p.m_flags&=~ap.e_islandFlag}for(var h=this.m_contactList;h;h=h.m_next){h.m_flags&=~ao.e_islandFlag}for(h=this.m_jointList;h;h=h.m_next){h.m_islandFlag=false}parseInt(this.m_bodyCount);h=this.s_stack;for(var o=this.m_bodyList;o;o=o.m_next){if(!(o.m_flags&ap.e_islandFlag)){if(!(o.IsAwake()==false||o.IsActive()==false)){if(o.GetType()!=ap.b2_staticBody){l.Clear();var n=0;h[n++]=o;for(o.m_flags|=ap.e_islandFlag;n>0;){p=h[--n];l.AddBody(p);p.IsAwake()==false&&p.SetAwake(true);if(p.GetType()!=ap.b2_staticBody){for(var d,k=p.m_contactList;k;k=k.next){if(!(k.contact.m_flags&ao.e_islandFlag)){if(!(k.contact.IsSensor()==true||k.contact.IsEnabled()==false||k.contact.IsTouching()==false)){l.AddContact(k.contact);k.contact.m_flags|=ao.e_islandFlag;d=k.other;if(!(d.m_flags&ap.e_islandFlag)){h[n++]=d;d.m_flags|=ap.e_islandFlag}}}}for(p=p.m_jointList;p;p=p.next){if(p.joint.m_islandFlag!=true){d=p.other;if(d.IsActive()!=false){l.AddJoint(p.joint);p.joint.m_islandFlag=true;if(!(d.m_flags&ap.e_islandFlag)){h[n++]=d;d.m_flags|=ap.e_islandFlag}}}}}}l.Solve(j,this.m_gravity,this.m_allowSleep);for(n=0;n<l.m_bodyCount;++n){p=l.m_bodies[n];if(p.GetType()==ap.b2_staticBody){p.m_flags&=~ap.e_islandFlag}}}}}}for(n=0;n<h.length;++n){if(!h[n]){break}h[n]=null}for(p=this.m_bodyList;p;p=p.m_next){p.IsAwake()==false||p.IsActive()==false||p.GetType()!=ap.b2_staticBody&&p.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()};ar.prototype.SolveTOI=function(p){var n,j,o,l=this.m_island;l.Initialize(this.m_bodyCount,ak.b2_maxTOIContactsPerIsland,ak.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var k=ar.s_queue;for(n=this.m_bodyList;n;n=n.m_next){n.m_flags&=~ap.e_islandFlag;n.m_sweep.t0=0}for(o=this.m_contactList;o;o=o.m_next){o.m_flags&=~(ao.e_toiFlag|ao.e_islandFlag)}for(o=this.m_jointList;o;o=o.m_next){o.m_islandFlag=false}for(;;){var h=null,d=1;for(o=this.m_contactList;o;o=o.m_next){if(!(o.IsSensor()==true||o.IsEnabled()==false||o.IsContinuous()==false)){n=1;if(o.m_flags&ao.e_toiFlag){n=o.m_toi}else{n=o.m_fixtureA;j=o.m_fixtureB;n=n.m_body;j=j.m_body;if((n.GetType()!=ap.b2_dynamicBody||n.IsAwake()==false)&&(j.GetType()!=ap.b2_dynamicBody||j.IsAwake()==false)){continue}var q=n.m_sweep.t0;if(n.m_sweep.t0<j.m_sweep.t0){q=j.m_sweep.t0;n.m_sweep.Advance(q)}else{if(j.m_sweep.t0<n.m_sweep.t0){q=n.m_sweep.t0;j.m_sweep.Advance(q)}}n=o.ComputeTOI(n.m_sweep,j.m_sweep);ak.b2Assert(0<=n&&n<=1);if(n>0&&n<1){n=(1-n)*q+n;if(n>1){n=1}}o.m_toi=n;o.m_flags|=ao.e_toiFlag}if(Number.MIN_VALUE<n&&n<d){h=o;d=n}}}if(h==null||1-100*Number.MIN_VALUE<d){break}n=h.m_fixtureA;j=h.m_fixtureB;n=n.m_body;j=j.m_body;ar.s_backupA.Set(n.m_sweep);ar.s_backupB.Set(j.m_sweep);n.Advance(d);j.Advance(d);h.Update(this.m_contactManager.m_contactListener);h.m_flags&=~ao.e_toiFlag;if(h.IsSensor()==true||h.IsEnabled()==false){n.m_sweep.Set(ar.s_backupA);j.m_sweep.Set(ar.s_backupB);n.SynchronizeTransform();j.SynchronizeTransform()}else{if(h.IsTouching()!=false){n=n;if(n.GetType()!=ap.b2_dynamicBody){n=j}l.Clear();h=o=0;k[o+h++]=n;for(n.m_flags|=ap.e_islandFlag;h>0;){n=k[o++];--h;l.AddBody(n);n.IsAwake()==false&&n.SetAwake(true);if(n.GetType()==ap.b2_dynamicBody){for(j=n.m_contactList;j;j=j.next){if(l.m_contactCount==l.m_contactCapacity){break}if(!(j.contact.m_flags&ao.e_islandFlag)){if(!(j.contact.IsSensor()==true||j.contact.IsEnabled()==false||j.contact.IsTouching()==false)){l.AddContact(j.contact);j.contact.m_flags|=ao.e_islandFlag;q=j.other;if(!(q.m_flags&ap.e_islandFlag)){if(q.GetType()!=ap.b2_staticBody){q.Advance(d);q.SetAwake(true)}k[o+h]=q;++h;q.m_flags|=ap.e_islandFlag}}}}for(n=n.m_jointList;n;n=n.next){if(l.m_jointCount!=l.m_jointCapacity){if(n.joint.m_islandFlag!=true){q=n.other;if(q.IsActive()!=false){l.AddJoint(n.joint);n.joint.m_islandFlag=true;if(!(q.m_flags&ap.e_islandFlag)){if(q.GetType()!=ap.b2_staticBody){q.Advance(d);q.SetAwake(true)}k[o+h]=q;++h;q.m_flags|=ap.e_islandFlag}}}}}}}o=ar.s_timestep;o.warmStarting=false;o.dt=(1-d)*p.dt;o.inv_dt=1/o.dt;o.dtRatio=0;o.velocityIterations=p.velocityIterations;o.positionIterations=p.positionIterations;l.SolveTOI(o);for(d=d=0;d<l.m_bodyCount;++d){n=l.m_bodies[d];n.m_flags&=~ap.e_islandFlag;if(n.IsAwake()!=false){if(n.GetType()==ap.b2_dynamicBody){n.SynchronizeFixtures();for(j=n.m_contactList;j;j=j.next){j.contact.m_flags&=~ao.e_toiFlag}}}}for(d=0;d<l.m_contactCount;++d){o=l.m_contacts[d];o.m_flags&=~(ao.e_toiFlag|ao.e_islandFlag)}for(d=0;d<l.m_jointCount;++d){o=l.m_joints[d];o.m_islandFlag=false}this.m_contactManager.FindNewContacts()}}}};ar.prototype.DrawJoint=function(j){var p=j.GetBodyA(),l=j.GetBodyB(),h=p.m_xf.position,o=l.m_xf.position,n=j.GetAnchorA(),d=j.GetAnchorB(),k=ar.s_jointColor;switch(j.m_type){case ai.e_distanceJoint:this.m_debugDraw.DrawSegment(n,d,k);break;case ai.e_pulleyJoint:p=j instanceof an?j:null;j=p.GetGroundAnchorA();p=p.GetGroundAnchorB();this.m_debugDraw.DrawSegment(j,n,k);this.m_debugDraw.DrawSegment(p,d,k);this.m_debugDraw.DrawSegment(j,p,k);break;case ai.e_mouseJoint:this.m_debugDraw.DrawSegment(n,d,k);break;default:p!=this.m_groundBody&&this.m_debugDraw.DrawSegment(h,n,k);this.m_debugDraw.DrawSegment(n,d,k);l!=this.m_groundBody&&this.m_debugDraw.DrawSegment(o,d,k)}};ar.prototype.DrawShape=function(h,n,j){switch(h.m_type){case b.e_circleShape:var d=h instanceof v?h:null;this.m_debugDraw.DrawSolidCircle(af.MulX(n,d.m_p),d.m_radius,n.R.col1,j);break;case b.e_polygonShape:d=0;d=h instanceof c?h:null;h=parseInt(d.GetVertexCount());var l=d.GetVertices(),k=new Vector(h);for(d=0;d<h;++d){k[d]=af.MulX(n,l[d])}this.m_debugDraw.DrawSolidPolygon(k,h,j);break;case b.e_edgeShape:d=h instanceof C?h:null;this.m_debugDraw.DrawSegment(af.MulX(n,d.GetVertex1()),af.MulX(n,d.GetVertex2()),j)}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new at;Box2D.Dynamics.b2World.s_xf=new P;Box2D.Dynamics.b2World.s_backupA=new ad;Box2D.Dynamics.b2World.s_backupB=new ad;Box2D.Dynamics.b2World.s_timestep=new at;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new ac(0.5,0.8,0.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();(function(){var ab=Box2D.Collision.Shapes.b2CircleShape,T=Box2D.Collision.Shapes.b2EdgeShape,t=Box2D.Collision.Shapes.b2PolygonShape,v=Box2D.Collision.Shapes.b2Shape,P=Box2D.Dynamics.Contacts.b2CircleContact,af=Box2D.Dynamics.Contacts.b2Contact,f=Box2D.Dynamics.Contacts.b2ContactConstraint,ag=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,ae=Box2D.Dynamics.Contacts.b2ContactEdge,m=Box2D.Dynamics.Contacts.b2ContactFactory,e=Box2D.Dynamics.Contacts.b2ContactRegister,q=Box2D.Dynamics.Contacts.b2ContactResult,r=Box2D.Dynamics.Contacts.b2ContactSolver,C=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,c=Box2D.Dynamics.Contacts.b2NullContact,b=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,ai=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,s=Box2D.Dynamics.Contacts.b2PolygonContact,X=Box2D.Dynamics.Contacts.b2PositionSolverManifold,ad=Box2D.Dynamics.b2Body,J=Box2D.Dynamics.b2TimeStep,n=Box2D.Common.b2Settings,ac=Box2D.Common.Math.b2Mat22,j=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Vec2,g=Box2D.Collision.b2Collision,al=Box2D.Collision.b2ContactID,a=Box2D.Collision.b2Manifold,ak=Box2D.Collision.b2TimeOfImpact,aj=Box2D.Collision.b2TOIInput,ah=Box2D.Collision.b2WorldManifold;Box2D.inherit(P,Box2D.Dynamics.Contacts.b2Contact);P.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;P.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};P.Create=function(){return new P};P.Destroy=function(){};P.prototype.Reset=function(d,h){this.__super.Reset.call(this,d,h)};P.prototype.Evaluate=function(){var d=this.m_fixtureA.GetBody(),h=this.m_fixtureB.GetBody();g.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape() instanceof ab?this.m_fixtureA.GetShape():null,d.m_xf,this.m_fixtureB.GetShape() instanceof ab?this.m_fixtureB.GetShape():null,h.m_xf)};af.b2Contact=function(){this.m_nodeA=new ae;this.m_nodeB=new ae;this.m_manifold=new a;this.m_oldManifold=new a};af.prototype.GetManifold=function(){return this.m_manifold};af.prototype.GetWorldManifold=function(h){var l=this.m_fixtureA.GetBody(),k=this.m_fixtureB.GetBody(),p=this.m_fixtureA.GetShape(),d=this.m_fixtureB.GetShape();h.Initialize(this.m_manifold,l.GetTransform(),p.m_radius,k.GetTransform(),d.m_radius)};af.prototype.IsTouching=function(){return(this.m_flags&af.e_touchingFlag)==af.e_touchingFlag};af.prototype.IsContinuous=function(){return(this.m_flags&af.e_continuousFlag)==af.e_continuousFlag};af.prototype.SetSensor=function(d){if(d){this.m_flags|=af.e_sensorFlag}else{this.m_flags&=~af.e_sensorFlag}};af.prototype.IsSensor=function(){return(this.m_flags&af.e_sensorFlag)==af.e_sensorFlag};af.prototype.SetEnabled=function(d){if(d){this.m_flags|=af.e_enabledFlag}else{this.m_flags&=~af.e_enabledFlag}};af.prototype.IsEnabled=function(){return(this.m_flags&af.e_enabledFlag)==af.e_enabledFlag};af.prototype.GetNext=function(){return this.m_next};af.prototype.GetFixtureA=function(){return this.m_fixtureA};af.prototype.GetFixtureB=function(){return this.m_fixtureB};af.prototype.FlagForFiltering=function(){this.m_flags|=af.e_filterFlag};af.prototype.b2Contact=function(){};af.prototype.Reset=function(d,k){if(d===undefined){d=null}if(k===undefined){k=null}this.m_flags=af.e_enabledFlag;if(!d||!k){this.m_fixtureB=this.m_fixtureA=null}else{if(d.IsSensor()||k.IsSensor()){this.m_flags|=af.e_sensorFlag}var h=d.GetBody(),l=k.GetBody();if(h.GetType()!=ad.b2_dynamicBody||h.IsBullet()||l.GetType()!=ad.b2_dynamicBody||l.IsBullet()){this.m_flags|=af.e_continuousFlag}this.m_fixtureA=d;this.m_fixtureB=k;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}};af.prototype.Update=function(l){var h=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=h;this.m_flags|=af.e_enabledFlag;var d=false;h=(this.m_flags&af.e_touchingFlag)==af.e_touchingFlag;var k=this.m_fixtureA.m_body,A=this.m_fixtureB.m_body,y=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&af.e_sensorFlag){if(y){d=this.m_fixtureA.GetShape();y=this.m_fixtureB.GetShape();k=k.GetTransform();A=A.GetTransform();d=v.TestOverlap(d,k,y,A)}this.m_manifold.m_pointCount=0}else{if(k.GetType()!=ad.b2_dynamicBody||k.IsBullet()||A.GetType()!=ad.b2_dynamicBody||A.IsBullet()){this.m_flags|=af.e_continuousFlag}else{this.m_flags&=~af.e_continuousFlag}if(y){this.Evaluate();d=this.m_manifold.m_pointCount>0;for(y=0;y<this.m_manifold.m_pointCount;++y){var p=this.m_manifold.m_points[y];p.m_normalImpulse=0;p.m_tangentImpulse=0;for(var z=p.m_id,w=0;w<this.m_oldManifold.m_pointCount;++w){var u=this.m_oldManifold.m_points[w];if(u.m_id.key==z.key){p.m_normalImpulse=u.m_normalImpulse;p.m_tangentImpulse=u.m_tangentImpulse;break}}}}else{this.m_manifold.m_pointCount=0}if(d!=h){k.SetAwake(true);A.SetAwake(true)}}if(d){this.m_flags|=af.e_touchingFlag}else{this.m_flags&=~af.e_touchingFlag}h==false&&d==true&&l.BeginContact(this);h==true&&d==false&&l.EndContact(this);(this.m_flags&af.e_sensorFlag)==0&&l.PreSolve(this,this.m_oldManifold)};af.prototype.Evaluate=function(){};af.prototype.ComputeTOI=function(d,h){af.s_input.proxyA.Set(this.m_fixtureA.GetShape());af.s_input.proxyB.Set(this.m_fixtureB.GetShape());af.s_input.sweepA=d;af.s_input.sweepB=h;af.s_input.tolerance=n.b2_linearSlop;return ak.TimeOfImpact(af.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64;Box2D.Dynamics.Contacts.b2Contact.s_input=new aj});f.b2ContactConstraint=function(){this.localPlaneNormal=new o;this.localPoint=new o;this.normal=new o;this.normalMass=new ac;this.K=new ac};f.prototype.b2ContactConstraint=function(){this.points=new Vector(n.b2_maxManifoldPoints);for(var d=0;d<n.b2_maxManifoldPoints;d++){this.points[d]=new ag}};ag.b2ContactConstraintPoint=function(){this.localPoint=new o;this.rA=new o;this.rB=new o};ae.b2ContactEdge=function(){};m.b2ContactFactory=function(){};m.prototype.b2ContactFactory=function(d){this.m_allocator=d;this.InitializeRegisters()};m.prototype.AddType=function(d,k,h,l){if(h===undefined){h=0}if(l===undefined){l=0}this.m_registers[h][l].createFcn=d;this.m_registers[h][l].destroyFcn=k;this.m_registers[h][l].primary=true;if(h!=l){this.m_registers[l][h].createFcn=d;this.m_registers[l][h].destroyFcn=k;this.m_registers[l][h].primary=false}};m.prototype.InitializeRegisters=function(){this.m_registers=new Vector(v.e_shapeTypeCount);for(var d=0;d<v.e_shapeTypeCount;d++){this.m_registers[d]=new Vector(v.e_shapeTypeCount);for(var h=0;h<v.e_shapeTypeCount;h++){this.m_registers[d][h]=new e}}this.AddType(P.Create,P.Destroy,v.e_circleShape,v.e_circleShape);this.AddType(b.Create,b.Destroy,v.e_polygonShape,v.e_circleShape);this.AddType(s.Create,s.Destroy,v.e_polygonShape,v.e_polygonShape);this.AddType(C.Create,C.Destroy,v.e_edgeShape,v.e_circleShape);this.AddType(ai.Create,ai.Destroy,v.e_polygonShape,v.e_edgeShape)};m.prototype.Create=function(d,k){var h=parseInt(d.GetType()),l=parseInt(k.GetType());h=this.m_registers[h][l];if(h.pool){l=h.pool;h.pool=l.m_next;h.poolCount--;l.Reset(d,k);return l}l=h.createFcn;if(l!=null){if(h.primary){l=l(this.m_allocator);l.Reset(d,k)}else{l=l(this.m_allocator);l.Reset(k,d)}return l}else{return null}};m.prototype.Destroy=function(d){if(d.m_manifold.m_pointCount>0){d.m_fixtureA.m_body.SetAwake(true);d.m_fixtureB.m_body.SetAwake(true)}var k=parseInt(d.m_fixtureA.GetType()),h=parseInt(d.m_fixtureB.GetType());k=this.m_registers[k][h];k.poolCount++;d.m_next=k.pool;k.pool=d;k=k.destroyFcn;k(d,this.m_allocator)};e.b2ContactRegister=function(){};q.b2ContactResult=function(){this.position=new o;this.normal=new o;this.id=new al};r.b2ContactSolver=function(){this.m_step=new J;this.m_constraints=new Vector};r.prototype.b2ContactSolver=function(){};r.prototype.Initialize=function(K,G,E,H){if(E===undefined){E=0}var R;this.m_step.Set(K);this.m_allocator=H;K=0;for(this.m_constraintCount=E;this.m_constraints.length<this.m_constraintCount;){this.m_constraints[this.m_constraints.length]=new f}for(K=0;K<E;++K){R=G[K];H=R.m_fixtureA;var O=R.m_fixtureB,L=H.m_shape.m_radius,Q=O.m_shape.m_radius,N=H.m_body,M=O.m_body,I=R.GetManifold(),D=n.b2MixFriction(H.GetFriction(),O.GetFriction()),A=n.b2MixRestitution(H.GetRestitution(),O.GetRestitution()),y=N.m_linearVelocity.x,z=N.m_linearVelocity.y,w=M.m_linearVelocity.x,B=M.m_linearVelocity.y,u=N.m_angularVelocity,h=M.m_angularVelocity;n.b2Assert(I.m_pointCount>0);r.s_worldManifold.Initialize(I,N.m_xf,L,M.m_xf,Q);O=r.s_worldManifold.m_normal.x;R=r.s_worldManifold.m_normal.y;H=this.m_constraints[K];H.bodyA=N;H.bodyB=M;H.manifold=I;H.normal.x=O;H.normal.y=R;H.pointCount=I.m_pointCount;H.friction=D;H.restitution=A;H.localPlaneNormal.x=I.m_localPlaneNormal.x;H.localPlaneNormal.y=I.m_localPlaneNormal.y;H.localPoint.x=I.m_localPoint.x;H.localPoint.y=I.m_localPoint.y;H.radius=L+Q;H.type=I.m_type;for(L=0;L<H.pointCount;++L){D=I.m_points[L];Q=H.points[L];Q.normalImpulse=D.m_normalImpulse;Q.tangentImpulse=D.m_tangentImpulse;Q.localPoint.SetV(D.m_localPoint);D=Q.rA.x=r.s_worldManifold.m_points[L].x-N.m_sweep.c.x;A=Q.rA.y=r.s_worldManifold.m_points[L].y-N.m_sweep.c.y;var p=Q.rB.x=r.s_worldManifold.m_points[L].x-M.m_sweep.c.x,d=Q.rB.y=r.s_worldManifold.m_points[L].y-M.m_sweep.c.y,k=D*R-A*O,l=p*R-d*O;k*=k;l*=l;Q.normalMass=1/(N.m_invMass+M.m_invMass+N.m_invI*k+M.m_invI*l);var F=N.m_mass*N.m_invMass+M.m_mass*M.m_invMass;F+=N.m_mass*N.m_invI*k+M.m_mass*M.m_invI*l;Q.equalizedMass=1/F;l=R;F=-O;k=D*F-A*l;l=p*F-d*l;k*=k;l*=l;Q.tangentMass=1/(N.m_invMass+M.m_invMass+N.m_invI*k+M.m_invI*l);Q.velocityBias=0;D=H.normal.x*(w+-h*d-y- -u*A)+H.normal.y*(B+h*p-z-u*D);if(D<-n.b2_velocityThreshold){Q.velocityBias+=-H.restitution*D}}if(H.pointCount==2){B=H.points[0];w=H.points[1];I=N.m_invMass;N=N.m_invI;y=M.m_invMass;M=M.m_invI;z=B.rA.x*R-B.rA.y*O;B=B.rB.x*R-B.rB.y*O;u=w.rA.x*R-w.rA.y*O;w=w.rB.x*R-w.rB.y*O;O=I+y+N*z*z+M*B*B;R=I+y+N*u*u+M*w*w;M=I+y+N*z*u+M*B*w;if(O*O<100*(O*R-M*M)){H.K.col1.Set(O,M);H.K.col2.Set(M,R);H.K.GetInverse(H.normalMass)}else{H.pointCount=1}}}};r.prototype.InitVelocityConstraints=function(D){for(var z=0;z<this.m_constraintCount;++z){var y=this.m_constraints[z],A=y.bodyA,K=y.bodyB,H=A.m_invMass,E=A.m_invI,I=K.m_invMass,G=K.m_invI,F=y.normal.x,B=y.normal.y,w=B,p=-F,k=0,l=0;if(D.warmStarting){l=y.pointCount;for(k=0;k<l;++k){var h=y.points[k];h.normalImpulse*=D.dtRatio;h.tangentImpulse*=D.dtRatio;var u=h.normalImpulse*F+h.tangentImpulse*w,d=h.normalImpulse*B+h.tangentImpulse*p;A.m_angularVelocity-=E*(h.rA.x*d-h.rA.y*u);A.m_linearVelocity.x-=H*u;A.m_linearVelocity.y-=H*d;K.m_angularVelocity+=G*(h.rB.x*d-h.rB.y*u);K.m_linearVelocity.x+=I*u;K.m_linearVelocity.y+=I*d}}else{l=y.pointCount;for(k=0;k<l;++k){A=y.points[k];A.normalImpulse=0;A.tangentImpulse=0}}}};r.prototype.SolveVelocityConstraints=function(){for(var K=0,G,E=0,H=0,R=0,O=H=H=E=E=0,L=E=E=0,Q=E=R=0,N=0,M,I=0;I<this.m_constraintCount;++I){R=this.m_constraints[I];var D=R.bodyA,A=R.bodyB,y=D.m_angularVelocity,z=A.m_angularVelocity,w=D.m_linearVelocity,B=A.m_linearVelocity,u=D.m_invMass,h=D.m_invI,p=A.m_invMass,d=A.m_invI;Q=R.normal.x;var k=N=R.normal.y;M=-Q;L=R.friction;for(K=0;K<R.pointCount;K++){G=R.points[K];E=B.x-z*G.rB.y-w.x+y*G.rA.y;H=B.y+z*G.rB.x-w.y-y*G.rA.x;E=E*k+H*M;E=G.tangentMass*-E;H=L*G.normalImpulse;H=j.Clamp(G.tangentImpulse+E,-H,H);E=H-G.tangentImpulse;O=E*k;E=E*M;w.x-=u*O;w.y-=u*E;y-=h*(G.rA.x*E-G.rA.y*O);B.x+=p*O;B.y+=p*E;z+=d*(G.rB.x*E-G.rB.y*O);G.tangentImpulse=H}parseInt(R.pointCount);if(R.pointCount==1){G=R.points[0];E=B.x+-z*G.rB.y-w.x- -y*G.rA.y;H=B.y+z*G.rB.x-w.y-y*G.rA.x;R=E*Q+H*N;E=-G.normalMass*(R-G.velocityBias);H=G.normalImpulse+E;H=H>0?H:0;E=H-G.normalImpulse;O=E*Q;E=E*N;w.x-=u*O;w.y-=u*E;y-=h*(G.rA.x*E-G.rA.y*O);B.x+=p*O;B.y+=p*E;z+=d*(G.rB.x*E-G.rB.y*O);G.normalImpulse=H}else{G=R.points[0];K=R.points[1];E=G.normalImpulse;L=K.normalImpulse;var l=(B.x-z*G.rB.y-w.x+y*G.rA.y)*Q+(B.y+z*G.rB.x-w.y-y*G.rA.x)*N,F=(B.x-z*K.rB.y-w.x+y*K.rA.y)*Q+(B.y+z*K.rB.x-w.y-y*K.rA.x)*N;H=l-G.velocityBias;O=F-K.velocityBias;M=R.K;H-=M.col1.x*E+M.col2.x*L;for(O-=M.col1.y*E+M.col2.y*L;;){M=R.normalMass;k=-(M.col1.x*H+M.col2.x*O);M=-(M.col1.y*H+M.col2.y*O);if(k>=0&&M>=0){E=k-E;L=M-L;R=E*Q;E=E*N;Q=L*Q;N=L*N;w.x-=u*(R+Q);w.y-=u*(E+N);y-=h*(G.rA.x*E-G.rA.y*R+K.rA.x*N-K.rA.y*Q);B.x+=p*(R+Q);B.y+=p*(E+N);z+=d*(G.rB.x*E-G.rB.y*R+K.rB.x*N-K.rB.y*Q);G.normalImpulse=k;K.normalImpulse=M;break}k=-G.normalMass*H;M=0;F=R.K.col1.y*k+O;if(k>=0&&F>=0){E=k-E;L=M-L;R=E*Q;E=E*N;Q=L*Q;N=L*N;w.x-=u*(R+Q);w.y-=u*(E+N);y-=h*(G.rA.x*E-G.rA.y*R+K.rA.x*N-K.rA.y*Q);B.x+=p*(R+Q);B.y+=p*(E+N);z+=d*(G.rB.x*E-G.rB.y*R+K.rB.x*N-K.rB.y*Q);G.normalImpulse=k;K.normalImpulse=M;break}k=0;M=-K.normalMass*O;l=R.K.col2.x*M+H;if(M>=0&&l>=0){E=k-E;L=M-L;R=E*Q;E=E*N;Q=L*Q;N=L*N;w.x-=u*(R+Q);w.y-=u*(E+N);y-=h*(G.rA.x*E-G.rA.y*R+K.rA.x*N-K.rA.y*Q);B.x+=p*(R+Q);B.y+=p*(E+N);z+=d*(G.rB.x*E-G.rB.y*R+K.rB.x*N-K.rB.y*Q);G.normalImpulse=k;K.normalImpulse=M;break}M=k=0;l=H;F=O;if(l>=0&&F>=0){E=k-E;L=M-L;R=E*Q;E=E*N;Q=L*Q;N=L*N;w.x-=u*(R+Q);w.y-=u*(E+N);y-=h*(G.rA.x*E-G.rA.y*R+K.rA.x*N-K.rA.y*Q);B.x+=p*(R+Q);B.y+=p*(E+N);z+=d*(G.rB.x*E-G.rB.y*R+K.rB.x*N-K.rB.y*Q);G.normalImpulse=k;K.normalImpulse=M;break}break}}D.m_angularVelocity=y;A.m_angularVelocity=z}};r.prototype.FinalizeVelocityConstraints=function(){for(var h=0;h<this.m_constraintCount;++h){for(var l=this.m_constraints[h],k=l.manifold,u=0;u<l.pointCount;++u){var d=k.m_points[u],p=l.points[u];d.m_normalImpulse=p.normalImpulse;d.m_tangentImpulse=p.tangentImpulse}}};r.prototype.SolvePositionConstraints=function(D){if(D===undefined){D=0}for(var z=0,y=0;y<this.m_constraintCount;y++){var A=this.m_constraints[y],K=A.bodyA,H=A.bodyB,E=K.m_mass*K.m_invMass,I=K.m_mass*K.m_invI,G=H.m_mass*H.m_invMass,F=H.m_mass*H.m_invI;r.s_psm.Initialize(A);for(var B=r.s_psm.m_normal,w=0;w<A.pointCount;w++){var p=A.points[w],k=r.s_psm.m_points[w],l=r.s_psm.m_separations[w],h=k.x-K.m_sweep.c.x,u=k.y-K.m_sweep.c.y,d=k.x-H.m_sweep.c.x;k=k.y-H.m_sweep.c.y;z=z<l?z:l;l=j.Clamp(D*(l+n.b2_linearSlop),-n.b2_maxLinearCorrection,0);l=-p.equalizedMass*l;p=l*B.x;l=l*B.y;K.m_sweep.c.x-=E*p;K.m_sweep.c.y-=E*l;K.m_sweep.a-=I*(h*l-u*p);K.SynchronizeTransform();H.m_sweep.c.x+=G*p;H.m_sweep.c.y+=G*l;H.m_sweep.a+=F*(d*l-k*p);H.SynchronizeTransform()}}return z>-1.5*n.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new ah;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new X});Box2D.inherit(C,Box2D.Dynamics.Contacts.b2Contact);C.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;C.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};C.Create=function(){return new C};C.Destroy=function(){};C.prototype.Reset=function(d,h){this.__super.Reset.call(this,d,h)};C.prototype.Evaluate=function(){var d=this.m_fixtureA.GetBody(),h=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape() instanceof T?this.m_fixtureA.GetShape():null,d.m_xf,this.m_fixtureB.GetShape() instanceof ab?this.m_fixtureB.GetShape():null,h.m_xf)};C.prototype.b2CollideEdgeAndCircle=function(){};Box2D.inherit(c,Box2D.Dynamics.Contacts.b2Contact);c.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;c.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};c.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};c.prototype.Evaluate=function(){};Box2D.inherit(b,Box2D.Dynamics.Contacts.b2Contact);b.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;b.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};b.Create=function(){return new b};b.Destroy=function(){};b.prototype.Reset=function(d,h){this.__super.Reset.call(this,d,h);n.b2Assert(d.GetType()==v.e_polygonShape);n.b2Assert(h.GetType()==v.e_circleShape)};b.prototype.Evaluate=function(){var d=this.m_fixtureA.m_body,h=this.m_fixtureB.m_body;g.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape() instanceof t?this.m_fixtureA.GetShape():null,d.m_xf,this.m_fixtureB.GetShape() instanceof ab?this.m_fixtureB.GetShape():null,h.m_xf)};Box2D.inherit(ai,Box2D.Dynamics.Contacts.b2Contact);ai.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;ai.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};ai.Create=function(){return new ai};ai.Destroy=function(){};ai.prototype.Reset=function(d,h){this.__super.Reset.call(this,d,h);n.b2Assert(d.GetType()==v.e_polygonShape);n.b2Assert(h.GetType()==v.e_edgeShape)};ai.prototype.Evaluate=function(){var d=this.m_fixtureA.GetBody(),h=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape() instanceof t?this.m_fixtureA.GetShape():null,d.m_xf,this.m_fixtureB.GetShape() instanceof T?this.m_fixtureB.GetShape():null,h.m_xf)};ai.prototype.b2CollidePolyAndEdge=function(){};Box2D.inherit(s,Box2D.Dynamics.Contacts.b2Contact);s.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;s.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};s.Create=function(){return new s};s.Destroy=function(){};s.prototype.Reset=function(d,h){this.__super.Reset.call(this,d,h)};s.prototype.Evaluate=function(){var d=this.m_fixtureA.GetBody(),h=this.m_fixtureB.GetBody();g.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape() instanceof t?this.m_fixtureA.GetShape():null,d.m_xf,this.m_fixtureB.GetShape() instanceof t?this.m_fixtureB.GetShape():null,h.m_xf)};X.b2PositionSolverManifold=function(){};X.prototype.b2PositionSolverManifold=function(){this.m_normal=new o;this.m_separations=new Vector_a2j_Number(n.b2_maxManifoldPoints);this.m_points=new Vector(n.b2_maxManifoldPoints);for(var d=0;d<n.b2_maxManifoldPoints;d++){this.m_points[d]=new o}};X.prototype.Initialize=function(k){n.b2Assert(k.pointCount>0);var u=0,p=0,y=0,h,w=0,l=0;switch(k.type){case a.e_circles:h=k.bodyA.m_xf.R;y=k.localPoint;u=k.bodyA.m_xf.position.x+(h.col1.x*y.x+h.col2.x*y.y);p=k.bodyA.m_xf.position.y+(h.col1.y*y.x+h.col2.y*y.y);h=k.bodyB.m_xf.R;y=k.points[0].localPoint;w=k.bodyB.m_xf.position.x+(h.col1.x*y.x+h.col2.x*y.y);h=k.bodyB.m_xf.position.y+(h.col1.y*y.x+h.col2.y*y.y);y=w-u;l=h-p;var d=y*y+l*l;if(d>Number.MIN_VALUE*Number.MIN_VALUE){d=Math.sqrt(d);this.m_normal.x=y/d;this.m_normal.y=l/d}else{this.m_normal.x=1;this.m_normal.y=0}this.m_points[0].x=0.5*(u+w);this.m_points[0].y=0.5*(p+h);this.m_separations[0]=y*this.m_normal.x+l*this.m_normal.y-k.radius;break;case a.e_faceA:h=k.bodyA.m_xf.R;y=k.localPlaneNormal;this.m_normal.x=h.col1.x*y.x+h.col2.x*y.y;this.m_normal.y=h.col1.y*y.x+h.col2.y*y.y;h=k.bodyA.m_xf.R;y=k.localPoint;w=k.bodyA.m_xf.position.x+(h.col1.x*y.x+h.col2.x*y.y);l=k.bodyA.m_xf.position.y+(h.col1.y*y.x+h.col2.y*y.y);h=k.bodyB.m_xf.R;for(u=0;u<k.pointCount;++u){y=k.points[u].localPoint;p=k.bodyB.m_xf.position.x+(h.col1.x*y.x+h.col2.x*y.y);y=k.bodyB.m_xf.position.y+(h.col1.y*y.x+h.col2.y*y.y);this.m_separations[u]=(p-w)*this.m_normal.x+(y-l)*this.m_normal.y-k.radius;this.m_points[u].x=p;this.m_points[u].y=y}break;case a.e_faceB:h=k.bodyB.m_xf.R;y=k.localPlaneNormal;this.m_normal.x=h.col1.x*y.x+h.col2.x*y.y;this.m_normal.y=h.col1.y*y.x+h.col2.y*y.y;h=k.bodyB.m_xf.R;y=k.localPoint;w=k.bodyB.m_xf.position.x+(h.col1.x*y.x+h.col2.x*y.y);l=k.bodyB.m_xf.position.y+(h.col1.y*y.x+h.col2.y*y.y);h=k.bodyA.m_xf.R;for(u=0;u<k.pointCount;++u){y=k.points[u].localPoint;p=k.bodyA.m_xf.position.x+(h.col1.x*y.x+h.col2.x*y.y);y=k.bodyA.m_xf.position.y+(h.col1.y*y.x+h.col2.y*y.y);this.m_separations[u]=(p-w)*this.m_normal.x+(y-l)*this.m_normal.y-k.radius;this.m_points[u].Set(p,y)}this.m_normal.x*=-1;this.m_normal.y*=-1}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new o;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new o})})();(function(){var l=Box2D.Common.Math.b2Mat22,k=Box2D.Common.Math.b2Math,h=Box2D.Common.Math.b2Vec2,g=Box2D.Common.b2Color,j=Box2D.Dynamics.Controllers.b2BuoyancyController,c=Box2D.Dynamics.Controllers.b2ConstantAccelController,e=Box2D.Dynamics.Controllers.b2ConstantForceController,b=Box2D.Dynamics.Controllers.b2Controller,a=Box2D.Dynamics.Controllers.b2ControllerEdge,f=Box2D.Dynamics.Controllers.b2GravityController,d=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(j,Box2D.Dynamics.Controllers.b2Controller);j.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;j.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new h(0,-1);this.density=this.offset=0;this.velocity=new h(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=false;this.useWorldGravity=true;this.gravity=null};j.prototype.Step=function(){if(this.m_bodyList){if(this.useWorldGravity){this.gravity=this.GetWorld().GetGravity().Copy()}for(var q=this.m_bodyList;q;q=q.nextBody){var s=q.body;if(s.IsAwake()!=false){for(var t=new h,o=new h,n=0,p=0,r=s.GetFixtureList();r;r=r.GetNext()){var w=new h,m=r.GetShape().ComputeSubmergedArea(this.normal,this.offset,s.GetTransform(),w);n+=m;t.x+=m*w.x;t.y+=m*w.y;var v=0;v=1;p+=m*v;o.x+=m*w.x*v;o.y+=m*w.y*v}t.x/=n;t.y/=n;o.x/=p;o.y/=p;if(!(n<Number.MIN_VALUE)){p=this.gravity.GetNegative();p.Multiply(this.density*n);s.ApplyForce(p,o);o=s.GetLinearVelocityFromWorldPoint(t);o.Subtract(this.velocity);o.Multiply(-this.linearDrag*n);s.ApplyForce(o,t);s.ApplyTorque(-s.GetInertia()/s.GetMass()*n*s.GetAngularVelocity()*this.angularDrag)}}}}};j.prototype.Draw=function(p){var n=new h,o=new h;n.x=this.normal.x*this.offset+this.normal.y*1000;n.y=this.normal.y*this.offset-this.normal.x*1000;o.x=this.normal.x*this.offset-this.normal.y*1000;o.y=this.normal.y*this.offset+this.normal.x*1000;var m=new g(0,0,1);p.DrawSegment(n,o,m)};Box2D.inherit(c,Box2D.Dynamics.Controllers.b2Controller);c.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;c.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new h(0,0)};c.prototype.Step=function(o){o=new h(this.A.x*o.dt,this.A.y*o.dt);for(var m=this.m_bodyList;m;m=m.nextBody){var n=m.body;n.IsAwake()&&n.SetLinearVelocity(new h(n.GetLinearVelocity().x+o.x,n.GetLinearVelocity().y+o.y))}};Box2D.inherit(e,Box2D.Dynamics.Controllers.b2Controller);e.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;e.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new h(0,0)};e.prototype.Step=function(){for(var n=this.m_bodyList;n;n=n.nextBody){var m=n.body;m.IsAwake()&&m.ApplyForce(this.F,m.GetWorldCenter())}};b.b2Controller=function(){};b.prototype.Step=function(){};b.prototype.Draw=function(){};b.prototype.AddBody=function(n){var m=new a;m.controller=this;m.body=n;m.nextBody=this.m_bodyList;m.prevBody=null;this.m_bodyList=m;if(m.nextBody){m.nextBody.prevBody=m}this.m_bodyCount++;m.nextController=n.m_controllerList;m.prevController=null;n.m_controllerList=m;if(m.nextController){m.nextController.prevController=m}n.m_controllerCount++};b.prototype.RemoveBody=function(n){for(var m=n.m_controllerList;m&&m.controller!=this;){m=m.nextController}if(m.prevBody){m.prevBody.nextBody=m.nextBody}if(m.nextBody){m.nextBody.prevBody=m.prevBody}if(m.nextController){m.nextController.prevController=m.prevController}if(m.prevController){m.prevController.nextController=m.nextController}if(this.m_bodyList==m){this.m_bodyList=m.nextBody}if(n.m_controllerList==m){n.m_controllerList=m.nextController}n.m_controllerCount--;this.m_bodyCount--};b.prototype.Clear=function(){for(;this.m_bodyList;){this.RemoveBody(this.m_bodyList.body)}};b.prototype.GetNext=function(){return this.m_next};b.prototype.GetWorld=function(){return this.m_world};b.prototype.GetBodyList=function(){return this.m_bodyList};a.b2ControllerEdge=function(){};Box2D.inherit(f,Box2D.Dynamics.Controllers.b2Controller);f.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;f.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=true};f.prototype.Step=function(){var q=null,s=null,t=null,o=0,n=null,p=null,r=null,w=0,m=0,v=0;w=null;if(this.invSqr){for(q=this.m_bodyList;q;q=q.nextBody){s=q.body;t=s.GetWorldCenter();o=s.GetMass();for(n=this.m_bodyList;n!=q;n=n.nextBody){p=n.body;r=p.GetWorldCenter();w=r.x-t.x;m=r.y-t.y;v=w*w+m*m;if(!(v<Number.MIN_VALUE)){w=new h(w,m);w.Multiply(this.G/v/Math.sqrt(v)*o*p.GetMass());s.IsAwake()&&s.ApplyForce(w,t);w.Multiply(-1);p.IsAwake()&&p.ApplyForce(w,r)}}}}else{for(q=this.m_bodyList;q;q=q.nextBody){s=q.body;t=s.GetWorldCenter();o=s.GetMass();for(n=this.m_bodyList;n!=q;n=n.nextBody){p=n.body;r=p.GetWorldCenter();w=r.x-t.x;m=r.y-t.y;v=w*w+m*m;if(!(v<Number.MIN_VALUE)){w=new h(w,m);w.Multiply(this.G/v*o*p.GetMass());s.IsAwake()&&s.ApplyForce(w,t);w.Multiply(-1);p.IsAwake()&&p.ApplyForce(w,r)}}}}};Box2D.inherit(d,Box2D.Dynamics.Controllers.b2Controller);d.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;d.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new l;this.maxTimestep=0};d.prototype.SetAxisAligned=function(n,m){if(n===undefined){n=0}if(m===undefined){m=0}this.T.col1.x=-n;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-m;this.maxTimestep=n>0||m>0?1/Math.max(n,m):0};d.prototype.Step=function(p){p=p.dt;if(!(p<=Number.MIN_VALUE)){if(p>this.maxTimestep&&this.maxTimestep>0){p=this.maxTimestep}for(var n=this.m_bodyList;n;n=n.nextBody){var o=n.body;if(o.IsAwake()){var m=o.GetWorldVector(k.MulMV(this.T,o.GetLocalVector(o.GetLinearVelocity())));o.SetLinearVelocity(new h(o.GetLinearVelocity().x+m.x*p,o.GetLinearVelocity().y+m.y*p))}}}}})();(function(){var P=Box2D.Common.b2Settings,C=Box2D.Common.Math.b2Mat22,q=Box2D.Common.Math.b2Mat33,r=Box2D.Common.Math.b2Math,v=Box2D.Common.Math.b2Vec2,ac=Box2D.Common.Math.b2Vec3,e=Box2D.Dynamics.Joints.b2DistanceJoint,ad=Box2D.Dynamics.Joints.b2DistanceJointDef,ab=Box2D.Dynamics.Joints.b2FrictionJoint,h=Box2D.Dynamics.Joints.b2FrictionJointDef,d=Box2D.Dynamics.Joints.b2GearJoint,m=Box2D.Dynamics.Joints.b2GearJointDef,n=Box2D.Dynamics.Joints.b2Jacobian,s=Box2D.Dynamics.Joints.b2Joint,c=Box2D.Dynamics.Joints.b2JointDef,b=Box2D.Dynamics.Joints.b2JointEdge,ae=Box2D.Dynamics.Joints.b2LineJoint,o=Box2D.Dynamics.Joints.b2LineJointDef,J=Box2D.Dynamics.Joints.b2MouseJoint,X=Box2D.Dynamics.Joints.b2MouseJointDef,t=Box2D.Dynamics.Joints.b2PrismaticJoint,j=Box2D.Dynamics.Joints.b2PrismaticJointDef,T=Box2D.Dynamics.Joints.b2PulleyJoint,g=Box2D.Dynamics.Joints.b2PulleyJointDef,l=Box2D.Dynamics.Joints.b2RevoluteJoint,f=Box2D.Dynamics.Joints.b2RevoluteJointDef,af=Box2D.Dynamics.Joints.b2WeldJoint,a=Box2D.Dynamics.Joints.b2WeldJointDef;Box2D.inherit(e,Box2D.Dynamics.Joints.b2Joint);e.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;e.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new v;this.m_localAnchor2=new v;this.m_u=new v};e.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};e.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};e.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new v(k*this.m_impulse*this.m_u.x,k*this.m_impulse*this.m_u.y)};e.prototype.GetReactionTorque=function(){return 0};e.prototype.GetLength=function(){return this.m_length};e.prototype.SetLength=function(k){if(k===undefined){k=0}this.m_length=k};e.prototype.GetFrequency=function(){return this.m_frequencyHz};e.prototype.SetFrequency=function(k){if(k===undefined){k=0}this.m_frequencyHz=k};e.prototype.GetDampingRatio=function(){return this.m_dampingRatio};e.prototype.SetDampingRatio=function(k){if(k===undefined){k=0}this.m_dampingRatio=k};e.prototype.b2DistanceJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);this.m_length=k.length;this.m_frequencyHz=k.frequencyHz;this.m_dampingRatio=k.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};e.prototype.InitVelocityConstraints=function(B){var z,w=0,y=this.m_bodyA,p=this.m_bodyB;z=y.m_xf.R;var k=this.m_localAnchor1.x-y.m_sweep.localCenter.x,u=this.m_localAnchor1.y-y.m_sweep.localCenter.y;w=z.col1.x*k+z.col2.x*u;u=z.col1.y*k+z.col2.y*u;k=w;z=p.m_xf.R;var F=this.m_localAnchor2.x-p.m_sweep.localCenter.x,D=this.m_localAnchor2.y-p.m_sweep.localCenter.y;w=z.col1.x*F+z.col2.x*D;D=z.col1.y*F+z.col2.y*D;F=w;this.m_u.x=p.m_sweep.c.x+F-y.m_sweep.c.x-k;this.m_u.y=p.m_sweep.c.y+D-y.m_sweep.c.y-u;w=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);w>P.b2_linearSlop?this.m_u.Multiply(1/w):this.m_u.SetZero();z=k*this.m_u.y-u*this.m_u.x;var A=F*this.m_u.y-D*this.m_u.x;z=y.m_invMass+y.m_invI*z*z+p.m_invMass+p.m_invI*A*A;this.m_mass=z!=0?1/z:0;if(this.m_frequencyHz>0){w=w-this.m_length;A=2*Math.PI*this.m_frequencyHz;var E=this.m_mass*A*A;this.m_gamma=B.dt*(2*this.m_mass*this.m_dampingRatio*A+B.dt*E);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_bias=w*B.dt*E*this.m_gamma;this.m_mass=z+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(B.warmStarting){this.m_impulse*=B.dtRatio;B=this.m_impulse*this.m_u.x;z=this.m_impulse*this.m_u.y;y.m_linearVelocity.x-=y.m_invMass*B;y.m_linearVelocity.y-=y.m_invMass*z;y.m_angularVelocity-=y.m_invI*(k*z-u*B);p.m_linearVelocity.x+=p.m_invMass*B;p.m_linearVelocity.y+=p.m_invMass*z;p.m_angularVelocity+=p.m_invI*(F*z-D*B)}else{this.m_impulse=0}};e.prototype.SolveVelocityConstraints=function(){var A,w=this.m_bodyA,p=this.m_bodyB;A=w.m_xf.R;var u=this.m_localAnchor1.x-w.m_sweep.localCenter.x,z=this.m_localAnchor1.y-w.m_sweep.localCenter.y,y=A.col1.x*u+A.col2.x*z;z=A.col1.y*u+A.col2.y*z;u=y;A=p.m_xf.R;var B=this.m_localAnchor2.x-p.m_sweep.localCenter.x,k=this.m_localAnchor2.y-p.m_sweep.localCenter.y;y=A.col1.x*B+A.col2.x*k;k=A.col1.y*B+A.col2.y*k;B=y;y=-this.m_mass*(this.m_u.x*(p.m_linearVelocity.x+-p.m_angularVelocity*k-(w.m_linearVelocity.x+-w.m_angularVelocity*z))+this.m_u.y*(p.m_linearVelocity.y+p.m_angularVelocity*B-(w.m_linearVelocity.y+w.m_angularVelocity*u))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=y;A=y*this.m_u.x;y=y*this.m_u.y;w.m_linearVelocity.x-=w.m_invMass*A;w.m_linearVelocity.y-=w.m_invMass*y;w.m_angularVelocity-=w.m_invI*(u*y-z*A);p.m_linearVelocity.x+=p.m_invMass*A;p.m_linearVelocity.y+=p.m_invMass*y;p.m_angularVelocity+=p.m_invI*(B*y-k*A)};e.prototype.SolvePositionConstraints=function(){var B;if(this.m_frequencyHz>0){return true}var z=this.m_bodyA,w=this.m_bodyB;B=z.m_xf.R;var y=this.m_localAnchor1.x-z.m_sweep.localCenter.x,p=this.m_localAnchor1.y-z.m_sweep.localCenter.y,k=B.col1.x*y+B.col2.x*p;p=B.col1.y*y+B.col2.y*p;y=k;B=w.m_xf.R;var u=this.m_localAnchor2.x-w.m_sweep.localCenter.x,E=this.m_localAnchor2.y-w.m_sweep.localCenter.y;k=B.col1.x*u+B.col2.x*E;E=B.col1.y*u+B.col2.y*E;u=k;k=w.m_sweep.c.x+u-z.m_sweep.c.x-y;var D=w.m_sweep.c.y+E-z.m_sweep.c.y-p;B=Math.sqrt(k*k+D*D);k/=B;D/=B;B=B-this.m_length;B=r.Clamp(B,-P.b2_maxLinearCorrection,P.b2_maxLinearCorrection);var A=-this.m_mass*B;this.m_u.Set(k,D);k=A*this.m_u.x;D=A*this.m_u.y;z.m_sweep.c.x-=z.m_invMass*k;z.m_sweep.c.y-=z.m_invMass*D;z.m_sweep.a-=z.m_invI*(y*D-p*k);w.m_sweep.c.x+=w.m_invMass*k;w.m_sweep.c.y+=w.m_invMass*D;w.m_sweep.a+=w.m_invI*(u*D-E*k);z.SynchronizeTransform();w.SynchronizeTransform();return r.Abs(B)<P.b2_linearSlop};Box2D.inherit(ad,Box2D.Dynamics.Joints.b2JointDef);ad.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;ad.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new v;this.localAnchorB=new v};ad.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=s.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};ad.prototype.Initialize=function(w,u,k,p){this.bodyA=w;this.bodyB=u;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(k));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(p));w=p.x-k.x;k=p.y-k.y;this.length=Math.sqrt(w*w+k*k);this.dampingRatio=this.frequencyHz=0};Box2D.inherit(ab,Box2D.Dynamics.Joints.b2Joint);ab.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;ab.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new v;this.m_localAnchorB=new v;this.m_linearMass=new C;this.m_linearImpulse=new v};ab.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};ab.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};ab.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new v(k*this.m_linearImpulse.x,k*this.m_linearImpulse.y)};ab.prototype.GetReactionTorque=function(k){if(k===undefined){k=0}return k*this.m_angularImpulse};ab.prototype.SetMaxForce=function(k){if(k===undefined){k=0}this.m_maxForce=k};ab.prototype.GetMaxForce=function(){return this.m_maxForce};ab.prototype.SetMaxTorque=function(k){if(k===undefined){k=0}this.m_maxTorque=k};ab.prototype.GetMaxTorque=function(){return this.m_maxTorque};ab.prototype.b2FrictionJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchorA.SetV(k.localAnchorA);this.m_localAnchorB.SetV(k.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=k.maxForce;this.m_maxTorque=k.maxTorque};ab.prototype.InitVelocityConstraints=function(D){var z,w=0,y=this.m_bodyA,p=this.m_bodyB;z=y.m_xf.R;var k=this.m_localAnchorA.x-y.m_sweep.localCenter.x,u=this.m_localAnchorA.y-y.m_sweep.localCenter.y;w=z.col1.x*k+z.col2.x*u;u=z.col1.y*k+z.col2.y*u;k=w;z=p.m_xf.R;var G=this.m_localAnchorB.x-p.m_sweep.localCenter.x,E=this.m_localAnchorB.y-p.m_sweep.localCenter.y;w=z.col1.x*G+z.col2.x*E;E=z.col1.y*G+z.col2.y*E;G=w;z=y.m_invMass;w=p.m_invMass;var A=y.m_invI,F=p.m_invI,B=new C;B.col1.x=z+w;B.col2.x=0;B.col1.y=0;B.col2.y=z+w;B.col1.x+=A*u*u;B.col2.x+=-A*k*u;B.col1.y+=-A*k*u;B.col2.y+=A*k*k;B.col1.x+=F*E*E;B.col2.x+=-F*G*E;B.col1.y+=-F*G*E;B.col2.y+=F*G*G;B.GetInverse(this.m_linearMass);this.m_angularMass=A+F;if(this.m_angularMass>0){this.m_angularMass=1/this.m_angularMass}if(D.warmStarting){this.m_linearImpulse.x*=D.dtRatio;this.m_linearImpulse.y*=D.dtRatio;this.m_angularImpulse*=D.dtRatio;D=this.m_linearImpulse;y.m_linearVelocity.x-=z*D.x;y.m_linearVelocity.y-=z*D.y;y.m_angularVelocity-=A*(k*D.y-u*D.x+this.m_angularImpulse);p.m_linearVelocity.x+=w*D.x;p.m_linearVelocity.y+=w*D.y;p.m_angularVelocity+=F*(G*D.y-E*D.x+this.m_angularImpulse)}else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}};ab.prototype.SolveVelocityConstraints=function(K){var F,D=0,E=this.m_bodyA,z=this.m_bodyB,y=E.m_linearVelocity,A=E.m_angularVelocity,N=z.m_linearVelocity,L=z.m_angularVelocity,G=E.m_invMass,M=z.m_invMass,I=E.m_invI,H=z.m_invI;F=E.m_xf.R;var B=this.m_localAnchorA.x-E.m_sweep.localCenter.x,w=this.m_localAnchorA.y-E.m_sweep.localCenter.y;D=F.col1.x*B+F.col2.x*w;w=F.col1.y*B+F.col2.y*w;B=D;F=z.m_xf.R;var u=this.m_localAnchorB.x-z.m_sweep.localCenter.x,k=this.m_localAnchorB.y-z.m_sweep.localCenter.y;D=F.col1.x*u+F.col2.x*k;k=F.col1.y*u+F.col2.y*k;u=D;F=0;D=-this.m_angularMass*(L-A);var p=this.m_angularImpulse;F=K.dt*this.m_maxTorque;this.m_angularImpulse=r.Clamp(this.m_angularImpulse+D,-F,F);D=this.m_angularImpulse-p;A-=I*D;L+=H*D;F=r.MulMV(this.m_linearMass,new v(-(N.x-L*k-y.x+A*w),-(N.y+L*u-y.y-A*B)));D=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(F);F=K.dt*this.m_maxForce;if(this.m_linearImpulse.LengthSquared()>F*F){this.m_linearImpulse.Normalize();this.m_linearImpulse.Multiply(F)}F=r.SubtractVV(this.m_linearImpulse,D);y.x-=G*F.x;y.y-=G*F.y;A-=I*(B*F.y-w*F.x);N.x+=M*F.x;N.y+=M*F.y;L+=H*(u*F.y-k*F.x);E.m_angularVelocity=A;z.m_angularVelocity=L};ab.prototype.SolvePositionConstraints=function(){return true};Box2D.inherit(h,Box2D.Dynamics.Joints.b2JointDef);h.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;h.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new v;this.localAnchorB=new v};h.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=s.e_frictionJoint;this.maxTorque=this.maxForce=0};h.prototype.Initialize=function(u,p,k){this.bodyA=u;this.bodyB=p;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(k));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(k))};Box2D.inherit(d,Box2D.Dynamics.Joints.b2Joint);d.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;d.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new v;this.m_groundAnchor2=new v;this.m_localAnchor1=new v;this.m_localAnchor2=new v;this.m_J=new n};d.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};d.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};d.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new v(k*this.m_impulse*this.m_J.linearB.x,k*this.m_impulse*this.m_J.linearB.y)};d.prototype.GetReactionTorque=function(y){if(y===undefined){y=0}var u=this.m_bodyB.m_xf.R,k=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,p=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,w=u.col1.x*k+u.col2.x*p;p=u.col1.y*k+u.col2.y*p;k=w;return y*(this.m_impulse*this.m_J.angularB-k*this.m_impulse*this.m_J.linearB.y+p*this.m_impulse*this.m_J.linearB.x)};d.prototype.GetRatio=function(){return this.m_ratio};d.prototype.SetRatio=function(k){if(k===undefined){k=0}this.m_ratio=k};d.prototype.b2GearJoint=function(y){this.__super.b2Joint.call(this,y);var u=parseInt(y.joint1.m_type),k=parseInt(y.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var p=0,w=0;this.m_ground1=y.joint1.GetBodyA();this.m_bodyA=y.joint1.GetBodyB();if(u==s.e_revoluteJoint){this.m_revolute1=y.joint1 instanceof l?y.joint1:null;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);p=this.m_revolute1.GetJointAngle()}else{this.m_prismatic1=y.joint1 instanceof t?y.joint1:null;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);p=this.m_prismatic1.GetJointTranslation()}this.m_ground2=y.joint2.GetBodyA();this.m_bodyB=y.joint2.GetBodyB();if(k==s.e_revoluteJoint){this.m_revolute2=y.joint2 instanceof l?y.joint2:null;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);w=this.m_revolute2.GetJointAngle()}else{this.m_prismatic2=y.joint2 instanceof t?y.joint2:null;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);w=this.m_prismatic2.GetJointTranslation()}this.m_ratio=y.ratio;this.m_constant=p+this.m_ratio*w;this.m_impulse=0};d.prototype.InitVelocityConstraints=function(B){var z=this.m_ground1,w=this.m_ground2,y=this.m_bodyA,p=this.m_bodyB,k=0,u=0,F=0,D=0,A=F=0,E=0;this.m_J.SetZero();if(this.m_revolute1){this.m_J.angularA=-1;E+=y.m_invI}else{z=z.m_xf.R;u=this.m_prismatic1.m_localXAxis1;k=z.col1.x*u.x+z.col2.x*u.y;u=z.col1.y*u.x+z.col2.y*u.y;z=y.m_xf.R;F=this.m_localAnchor1.x-y.m_sweep.localCenter.x;D=this.m_localAnchor1.y-y.m_sweep.localCenter.y;A=z.col1.x*F+z.col2.x*D;D=z.col1.y*F+z.col2.y*D;F=A;F=F*u-D*k;this.m_J.linearA.Set(-k,-u);this.m_J.angularA=-F;E+=y.m_invMass+y.m_invI*F*F}if(this.m_revolute2){this.m_J.angularB=-this.m_ratio;E+=this.m_ratio*this.m_ratio*p.m_invI}else{z=w.m_xf.R;u=this.m_prismatic2.m_localXAxis1;k=z.col1.x*u.x+z.col2.x*u.y;u=z.col1.y*u.x+z.col2.y*u.y;z=p.m_xf.R;F=this.m_localAnchor2.x-p.m_sweep.localCenter.x;D=this.m_localAnchor2.y-p.m_sweep.localCenter.y;A=z.col1.x*F+z.col2.x*D;D=z.col1.y*F+z.col2.y*D;F=A;F=F*u-D*k;this.m_J.linearB.Set(-this.m_ratio*k,-this.m_ratio*u);this.m_J.angularB=-this.m_ratio*F;E+=this.m_ratio*this.m_ratio*(p.m_invMass+p.m_invI*F*F)}this.m_mass=E>0?1/E:0;if(B.warmStarting){y.m_linearVelocity.x+=y.m_invMass*this.m_impulse*this.m_J.linearA.x;y.m_linearVelocity.y+=y.m_invMass*this.m_impulse*this.m_J.linearA.y;y.m_angularVelocity+=y.m_invI*this.m_impulse*this.m_J.angularA;p.m_linearVelocity.x+=p.m_invMass*this.m_impulse*this.m_J.linearB.x;p.m_linearVelocity.y+=p.m_invMass*this.m_impulse*this.m_J.linearB.y;p.m_angularVelocity+=p.m_invI*this.m_impulse*this.m_J.angularB}else{this.m_impulse=0}};d.prototype.SolveVelocityConstraints=function(){var u=this.m_bodyA,p=this.m_bodyB,k=-this.m_mass*this.m_J.Compute(u.m_linearVelocity,u.m_angularVelocity,p.m_linearVelocity,p.m_angularVelocity);this.m_impulse+=k;u.m_linearVelocity.x+=u.m_invMass*k*this.m_J.linearA.x;u.m_linearVelocity.y+=u.m_invMass*k*this.m_J.linearA.y;u.m_angularVelocity+=u.m_invI*k*this.m_J.angularA;p.m_linearVelocity.x+=p.m_invMass*k*this.m_J.linearB.x;p.m_linearVelocity.y+=p.m_invMass*k*this.m_J.linearB.y;p.m_angularVelocity+=p.m_invI*k*this.m_J.angularB};d.prototype.SolvePositionConstraints=function(){var w=this.m_bodyA,u=this.m_bodyB,k=0,p=0;k=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation();p=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();k=-this.m_mass*(this.m_constant-(k+this.m_ratio*p));w.m_sweep.c.x+=w.m_invMass*k*this.m_J.linearA.x;w.m_sweep.c.y+=w.m_invMass*k*this.m_J.linearA.y;w.m_sweep.a+=w.m_invI*k*this.m_J.angularA;u.m_sweep.c.x+=u.m_invMass*k*this.m_J.linearB.x;u.m_sweep.c.y+=u.m_invMass*k*this.m_J.linearB.y;u.m_sweep.a+=u.m_invI*k*this.m_J.angularB;w.SynchronizeTransform();u.SynchronizeTransform();return 0<P.b2_linearSlop};Box2D.inherit(m,Box2D.Dynamics.Joints.b2JointDef);m.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;m.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};m.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=s.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};n.b2Jacobian=function(){this.linearA=new v;this.linearB=new v};n.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};n.prototype.Set=function(w,u,k,p){if(u===undefined){u=0}if(p===undefined){p=0}this.linearA.SetV(w);this.angularA=u;this.linearB.SetV(k);this.angularB=p};n.prototype.Compute=function(w,u,k,p){if(u===undefined){u=0}if(p===undefined){p=0}return this.linearA.x*w.x+this.linearA.y*w.y+this.angularA*u+(this.linearB.x*k.x+this.linearB.y*k.y)+this.angularB*p};s.b2Joint=function(){this.m_edgeA=new b;this.m_edgeB=new b;this.m_localCenterA=new v;this.m_localCenterB=new v};s.prototype.GetType=function(){return this.m_type};s.prototype.GetAnchorA=function(){return null};s.prototype.GetAnchorB=function(){return null};s.prototype.GetReactionForce=function(){return null};s.prototype.GetReactionTorque=function(){return 0};s.prototype.GetBodyA=function(){return this.m_bodyA};s.prototype.GetBodyB=function(){return this.m_bodyB};s.prototype.GetNext=function(){return this.m_next};s.prototype.GetUserData=function(){return this.m_userData};s.prototype.SetUserData=function(k){this.m_userData=k};s.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};s.Create=function(p){var k=null;switch(p.type){case s.e_distanceJoint:k=new e(p instanceof ad?p:null);break;case s.e_mouseJoint:k=new J(p instanceof X?p:null);break;case s.e_prismaticJoint:k=new t(p instanceof j?p:null);break;case s.e_revoluteJoint:k=new l(p instanceof f?p:null);break;case s.e_pulleyJoint:k=new T(p instanceof g?p:null);break;case s.e_gearJoint:k=new d(p instanceof m?p:null);break;case s.e_lineJoint:k=new ae(p instanceof o?p:null);break;case s.e_weldJoint:k=new af(p instanceof a?p:null);break;case s.e_frictionJoint:k=new ab(p instanceof h?p:null)}return k};s.Destroy=function(){};s.prototype.b2Joint=function(k){P.b2Assert(k.bodyA!=k.bodyB);this.m_type=k.type;this.m_next=this.m_prev=null;this.m_bodyA=k.bodyA;this.m_bodyB=k.bodyB;this.m_collideConnected=k.collideConnected;this.m_islandFlag=false;this.m_userData=k.userData};s.prototype.InitVelocityConstraints=function(){};s.prototype.SolveVelocityConstraints=function(){};s.prototype.FinalizeVelocityConstraints=function(){};s.prototype.SolvePositionConstraints=function(){return false};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});c.b2JointDef=function(){};c.prototype.b2JointDef=function(){this.type=s.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=false};b.b2JointEdge=function(){};Box2D.inherit(ae,Box2D.Dynamics.Joints.b2Joint);ae.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;ae.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new v;this.m_localAnchor2=new v;this.m_localXAxis1=new v;this.m_localYAxis1=new v;this.m_axis=new v;this.m_perp=new v;this.m_K=new C;this.m_impulse=new v};ae.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};ae.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};ae.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new v(k*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),k*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};ae.prototype.GetReactionTorque=function(k){if(k===undefined){k=0}return k*this.m_impulse.y};ae.prototype.GetJointTranslation=function(){var w=this.m_bodyA,u=this.m_bodyB,k=w.GetWorldPoint(this.m_localAnchor1),p=u.GetWorldPoint(this.m_localAnchor2);u=p.x-k.x;k=p.y-k.y;w=w.GetWorldVector(this.m_localXAxis1);return w.x*u+w.y*k};ae.prototype.GetJointSpeed=function(){var B=this.m_bodyA,z=this.m_bodyB,w;w=B.m_xf.R;var y=this.m_localAnchor1.x-B.m_sweep.localCenter.x,p=this.m_localAnchor1.y-B.m_sweep.localCenter.y,k=w.col1.x*y+w.col2.x*p;p=w.col1.y*y+w.col2.y*p;y=k;w=z.m_xf.R;var u=this.m_localAnchor2.x-z.m_sweep.localCenter.x,F=this.m_localAnchor2.y-z.m_sweep.localCenter.y;k=w.col1.x*u+w.col2.x*F;F=w.col1.y*u+w.col2.y*F;u=k;w=z.m_sweep.c.x+u-(B.m_sweep.c.x+y);k=z.m_sweep.c.y+F-(B.m_sweep.c.y+p);var D=B.GetWorldVector(this.m_localXAxis1),A=B.m_linearVelocity,E=z.m_linearVelocity;B=B.m_angularVelocity;z=z.m_angularVelocity;return w*-B*D.y+k*B*D.x+(D.x*(E.x+-z*F-A.x- -B*p)+D.y*(E.y+z*u-A.y-B*y))};ae.prototype.IsLimitEnabled=function(){return this.m_enableLimit};ae.prototype.EnableLimit=function(k){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=k};ae.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};ae.prototype.GetUpperLimit=function(){return this.m_upperTranslation};ae.prototype.SetLimits=function(p,k){if(p===undefined){p=0}if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=p;this.m_upperTranslation=k};ae.prototype.IsMotorEnabled=function(){return this.m_enableMotor};ae.prototype.EnableMotor=function(k){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=k};ae.prototype.SetMotorSpeed=function(k){if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=k};ae.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};ae.prototype.SetMaxMotorForce=function(k){if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=k};ae.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};ae.prototype.GetMotorForce=function(){return this.m_motorImpulse};ae.prototype.b2LineJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);this.m_localXAxis1.SetV(k.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=k.lowerTranslation;this.m_upperTranslation=k.upperTranslation;this.m_maxMotorForce=k.maxMotorForce;this.m_motorSpeed=k.motorSpeed;this.m_enableLimit=k.enableLimit;this.m_enableMotor=k.enableMotor;this.m_limitState=s.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};ae.prototype.InitVelocityConstraints=function(B){var z=this.m_bodyA,w=this.m_bodyB,y,p=0;this.m_localCenterA.SetV(z.GetLocalCenter());this.m_localCenterB.SetV(w.GetLocalCenter());var k=z.GetTransform();w.GetTransform();y=z.m_xf.R;var u=this.m_localAnchor1.x-this.m_localCenterA.x,E=this.m_localAnchor1.y-this.m_localCenterA.y;p=y.col1.x*u+y.col2.x*E;E=y.col1.y*u+y.col2.y*E;u=p;y=w.m_xf.R;var D=this.m_localAnchor2.x-this.m_localCenterB.x,A=this.m_localAnchor2.y-this.m_localCenterB.y;p=y.col1.x*D+y.col2.x*A;A=y.col1.y*D+y.col2.y*A;D=p;y=w.m_sweep.c.x+D-z.m_sweep.c.x-u;p=w.m_sweep.c.y+A-z.m_sweep.c.y-E;this.m_invMassA=z.m_invMass;this.m_invMassB=w.m_invMass;this.m_invIA=z.m_invI;this.m_invIB=w.m_invI;this.m_axis.SetV(r.MulMV(k.R,this.m_localXAxis1));this.m_a1=(y+u)*this.m_axis.y-(p+E)*this.m_axis.x;this.m_a2=D*this.m_axis.y-A*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(r.MulMV(k.R,this.m_localYAxis1));this.m_s1=(y+u)*this.m_perp.y-(p+E)*this.m_perp.x;this.m_s2=D*this.m_perp.y-A*this.m_perp.x;k=this.m_invMassA;u=this.m_invMassB;E=this.m_invIA;D=this.m_invIB;this.m_K.col1.x=k+u+E*this.m_s1*this.m_s1+D*this.m_s2*this.m_s2;this.m_K.col1.y=E*this.m_s1*this.m_a1+D*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=k+u+E*this.m_a1*this.m_a1+D*this.m_a2*this.m_a2;if(this.m_enableLimit){y=this.m_axis.x*y+this.m_axis.y*p;if(r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*P.b2_linearSlop){this.m_limitState=s.e_equalLimits}else{if(y<=this.m_lowerTranslation){if(this.m_limitState!=s.e_atLowerLimit){this.m_limitState=s.e_atLowerLimit;this.m_impulse.y=0}}else{if(y>=this.m_upperTranslation){if(this.m_limitState!=s.e_atUpperLimit){this.m_limitState=s.e_atUpperLimit;this.m_impulse.y=0}}else{this.m_limitState=s.e_inactiveLimit;this.m_impulse.y=0}}}}else{this.m_limitState=s.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(B.warmStarting){this.m_impulse.x*=B.dtRatio;this.m_impulse.y*=B.dtRatio;this.m_motorImpulse*=B.dtRatio;B=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x;y=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y;p=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1;k=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;z.m_linearVelocity.x-=this.m_invMassA*B;z.m_linearVelocity.y-=this.m_invMassA*y;z.m_angularVelocity-=this.m_invIA*p;w.m_linearVelocity.x+=this.m_invMassB*B;w.m_linearVelocity.y+=this.m_invMassB*y;w.m_angularVelocity+=this.m_invIB*k}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};ae.prototype.SolveVelocityConstraints=function(B){var z=this.m_bodyA,w=this.m_bodyB,y=z.m_linearVelocity,p=z.m_angularVelocity,k=w.m_linearVelocity,u=w.m_angularVelocity,F=0,D=0,A=0,E=0;if(this.m_enableMotor&&this.m_limitState!=s.e_equalLimits){E=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(k.x-y.x)+this.m_axis.y*(k.y-y.y)+this.m_a2*u-this.m_a1*p));F=this.m_motorImpulse;D=B.dt*this.m_maxMotorForce;this.m_motorImpulse=r.Clamp(this.m_motorImpulse+E,-D,D);E=this.m_motorImpulse-F;F=E*this.m_axis.x;D=E*this.m_axis.y;A=E*this.m_a1;E=E*this.m_a2;y.x-=this.m_invMassA*F;y.y-=this.m_invMassA*D;p-=this.m_invIA*A;k.x+=this.m_invMassB*F;k.y+=this.m_invMassB*D;u+=this.m_invIB*E}D=this.m_perp.x*(k.x-y.x)+this.m_perp.y*(k.y-y.y)+this.m_s2*u-this.m_s1*p;if(this.m_enableLimit&&this.m_limitState!=s.e_inactiveLimit){A=this.m_axis.x*(k.x-y.x)+this.m_axis.y*(k.y-y.y)+this.m_a2*u-this.m_a1*p;F=this.m_impulse.Copy();B=this.m_K.Solve(new v,-D,-A);this.m_impulse.Add(B);if(this.m_limitState==s.e_atLowerLimit){this.m_impulse.y=r.Max(this.m_impulse.y,0)}else{if(this.m_limitState==s.e_atUpperLimit){this.m_impulse.y=r.Min(this.m_impulse.y,0)}}D=-D-(this.m_impulse.y-F.y)*this.m_K.col2.x;A=0;A=this.m_K.col1.x!=0?D/this.m_K.col1.x+F.x:F.x;this.m_impulse.x=A;B.x=this.m_impulse.x-F.x;B.y=this.m_impulse.y-F.y;F=B.x*this.m_perp.x+B.y*this.m_axis.x;D=B.x*this.m_perp.y+B.y*this.m_axis.y;A=B.x*this.m_s1+B.y*this.m_a1;E=B.x*this.m_s2+B.y*this.m_a2}else{B=0;B=this.m_K.col1.x!=0?-D/this.m_K.col1.x:0;this.m_impulse.x+=B;F=B*this.m_perp.x;D=B*this.m_perp.y;A=B*this.m_s1;E=B*this.m_s2}y.x-=this.m_invMassA*F;y.y-=this.m_invMassA*D;p-=this.m_invIA*A;k.x+=this.m_invMassB*F;k.y+=this.m_invMassB*D;u+=this.m_invIB*E;z.m_linearVelocity.SetV(y);z.m_angularVelocity=p;w.m_linearVelocity.SetV(k);w.m_angularVelocity=u};ae.prototype.SolvePositionConstraints=function(){var G=this.m_bodyA,B=this.m_bodyB,z=G.m_sweep.c,A=G.m_sweep.a,u=B.m_sweep.c,p=B.m_sweep.a,w,K=0,H=0,D=0,I=0,F=w=0,E=0;H=false;var y=0,k=C.FromAngle(A);D=C.FromAngle(p);w=k;E=this.m_localAnchor1.x-this.m_localCenterA.x;var M=this.m_localAnchor1.y-this.m_localCenterA.y;K=w.col1.x*E+w.col2.x*M;M=w.col1.y*E+w.col2.y*M;E=K;w=D;D=this.m_localAnchor2.x-this.m_localCenterB.x;I=this.m_localAnchor2.y-this.m_localCenterB.y;K=w.col1.x*D+w.col2.x*I;I=w.col1.y*D+w.col2.y*I;D=K;w=u.x+D-z.x-E;K=u.y+I-z.y-M;if(this.m_enableLimit){this.m_axis=r.MulMV(k,this.m_localXAxis1);this.m_a1=(w+E)*this.m_axis.y-(K+M)*this.m_axis.x;this.m_a2=D*this.m_axis.y-I*this.m_axis.x;var L=this.m_axis.x*w+this.m_axis.y*K;if(r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*P.b2_linearSlop){y=r.Clamp(L,-P.b2_maxLinearCorrection,P.b2_maxLinearCorrection);F=r.Abs(L);H=true}else{if(L<=this.m_lowerTranslation){y=r.Clamp(L-this.m_lowerTranslation+P.b2_linearSlop,-P.b2_maxLinearCorrection,0);F=this.m_lowerTranslation-L;H=true}else{if(L>=this.m_upperTranslation){y=r.Clamp(L-this.m_upperTranslation+P.b2_linearSlop,0,P.b2_maxLinearCorrection);F=L-this.m_upperTranslation;H=true}}}}this.m_perp=r.MulMV(k,this.m_localYAxis1);this.m_s1=(w+E)*this.m_perp.y-(K+M)*this.m_perp.x;this.m_s2=D*this.m_perp.y-I*this.m_perp.x;k=new v;M=this.m_perp.x*w+this.m_perp.y*K;F=r.Max(F,r.Abs(M));E=0;if(H){H=this.m_invMassA;D=this.m_invMassB;I=this.m_invIA;w=this.m_invIB;this.m_K.col1.x=H+D+I*this.m_s1*this.m_s1+w*this.m_s2*this.m_s2;this.m_K.col1.y=I*this.m_s1*this.m_a1+w*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=H+D+I*this.m_a1*this.m_a1+w*this.m_a2*this.m_a2;this.m_K.Solve(k,-M,-y)}else{H=this.m_invMassA;D=this.m_invMassB;I=this.m_invIA;w=this.m_invIB;y=H+D+I*this.m_s1*this.m_s1+w*this.m_s2*this.m_s2;H=0;H=y!=0?-M/y:0;k.x=H;k.y=0}y=k.x*this.m_perp.x+k.y*this.m_axis.x;H=k.x*this.m_perp.y+k.y*this.m_axis.y;M=k.x*this.m_s1+k.y*this.m_a1;k=k.x*this.m_s2+k.y*this.m_a2;z.x-=this.m_invMassA*y;z.y-=this.m_invMassA*H;A-=this.m_invIA*M;u.x+=this.m_invMassB*y;u.y+=this.m_invMassB*H;p+=this.m_invIB*k;G.m_sweep.a=A;B.m_sweep.a=p;G.SynchronizeTransform();B.SynchronizeTransform();return F<=P.b2_linearSlop&&E<=P.b2_angularSlop};Box2D.inherit(o,Box2D.Dynamics.Joints.b2JointDef);o.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;o.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new v;this.localAnchorB=new v;this.localAxisA=new v};o.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=s.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=false;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=false;this.motorSpeed=this.maxMotorForce=0};o.prototype.Initialize=function(w,u,k,p){this.bodyA=w;this.bodyB=u;this.localAnchorA=this.bodyA.GetLocalPoint(k);this.localAnchorB=this.bodyB.GetLocalPoint(k);this.localAxisA=this.bodyA.GetLocalVector(p)};Box2D.inherit(J,Box2D.Dynamics.Joints.b2Joint);J.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;J.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new C;this.K1=new C;this.K2=new C;this.m_localAnchor=new v;this.m_target=new v;this.m_impulse=new v;this.m_mass=new C;this.m_C=new v};J.prototype.GetAnchorA=function(){return this.m_target};J.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};J.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new v(k*this.m_impulse.x,k*this.m_impulse.y)};J.prototype.GetReactionTorque=function(){return 0};J.prototype.GetTarget=function(){return this.m_target};J.prototype.SetTarget=function(k){this.m_bodyB.IsAwake()==false&&this.m_bodyB.SetAwake(true);this.m_target=k};J.prototype.GetMaxForce=function(){return this.m_maxForce};J.prototype.SetMaxForce=function(k){if(k===undefined){k=0}this.m_maxForce=k};J.prototype.GetFrequency=function(){return this.m_frequencyHz};J.prototype.SetFrequency=function(k){if(k===undefined){k=0}this.m_frequencyHz=k};J.prototype.GetDampingRatio=function(){return this.m_dampingRatio};J.prototype.SetDampingRatio=function(k){if(k===undefined){k=0}this.m_dampingRatio=k};J.prototype.b2MouseJoint=function(w){this.__super.b2Joint.call(this,w);this.m_target.SetV(w.target);var u=this.m_target.x-this.m_bodyB.m_xf.position.x,k=this.m_target.y-this.m_bodyB.m_xf.position.y,p=this.m_bodyB.m_xf.R;this.m_localAnchor.x=u*p.col1.x+k*p.col1.y;this.m_localAnchor.y=u*p.col2.x+k*p.col2.y;this.m_maxForce=w.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=w.frequencyHz;this.m_dampingRatio=w.dampingRatio;this.m_gamma=this.m_beta=0};J.prototype.InitVelocityConstraints=function(z){var u=this.m_bodyB,k=u.GetMass(),p=2*Math.PI*this.m_frequencyHz,y=k*p*p;this.m_gamma=z.dt*(2*k*this.m_dampingRatio*p+z.dt*y);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=z.dt*y*this.m_gamma;y=u.m_xf.R;k=this.m_localAnchor.x-u.m_sweep.localCenter.x;p=this.m_localAnchor.y-u.m_sweep.localCenter.y;var w=y.col1.x*k+y.col2.x*p;p=y.col1.y*k+y.col2.y*p;k=w;y=u.m_invMass;w=u.m_invI;this.K1.col1.x=y;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=y;this.K2.col1.x=w*p*p;this.K2.col2.x=-w*k*p;this.K2.col1.y=-w*k*p;this.K2.col2.y=w*k*k;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=u.m_sweep.c.x+k-this.m_target.x;this.m_C.y=u.m_sweep.c.y+p-this.m_target.y;u.m_angularVelocity*=0.98;this.m_impulse.x*=z.dtRatio;this.m_impulse.y*=z.dtRatio;u.m_linearVelocity.x+=y*this.m_impulse.x;u.m_linearVelocity.y+=y*this.m_impulse.y;u.m_angularVelocity+=w*(k*this.m_impulse.y-p*this.m_impulse.x)};J.prototype.SolveVelocityConstraints=function(A){var w=this.m_bodyB,p,u=0,z=0;p=w.m_xf.R;var y=this.m_localAnchor.x-w.m_sweep.localCenter.x,B=this.m_localAnchor.y-w.m_sweep.localCenter.y;u=p.col1.x*y+p.col2.x*B;B=p.col1.y*y+p.col2.y*B;y=u;u=w.m_linearVelocity.x+-w.m_angularVelocity*B;var k=w.m_linearVelocity.y+w.m_angularVelocity*y;p=this.m_mass;u=u+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;z=k+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;k=-(p.col1.x*u+p.col2.x*z);z=-(p.col1.y*u+p.col2.y*z);p=this.m_impulse.x;u=this.m_impulse.y;this.m_impulse.x+=k;this.m_impulse.y+=z;A=A.dt*this.m_maxForce;this.m_impulse.LengthSquared()>A*A&&this.m_impulse.Multiply(A/this.m_impulse.Length());k=this.m_impulse.x-p;z=this.m_impulse.y-u;w.m_linearVelocity.x+=w.m_invMass*k;w.m_linearVelocity.y+=w.m_invMass*z;w.m_angularVelocity+=w.m_invI*(y*z-B*k)};J.prototype.SolvePositionConstraints=function(){return true};Box2D.inherit(X,Box2D.Dynamics.Joints.b2JointDef);X.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;X.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new v};X.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=s.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7};Box2D.inherit(t,Box2D.Dynamics.Joints.b2Joint);t.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;t.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new v;this.m_localAnchor2=new v;this.m_localXAxis1=new v;this.m_localYAxis1=new v;this.m_axis=new v;this.m_perp=new v;this.m_K=new q;this.m_impulse=new ac};t.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};t.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};t.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new v(k*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),k*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};t.prototype.GetReactionTorque=function(k){if(k===undefined){k=0}return k*this.m_impulse.y};t.prototype.GetJointTranslation=function(){var w=this.m_bodyA,u=this.m_bodyB,k=w.GetWorldPoint(this.m_localAnchor1),p=u.GetWorldPoint(this.m_localAnchor2);u=p.x-k.x;k=p.y-k.y;w=w.GetWorldVector(this.m_localXAxis1);return w.x*u+w.y*k};t.prototype.GetJointSpeed=function(){var B=this.m_bodyA,z=this.m_bodyB,w;w=B.m_xf.R;var y=this.m_localAnchor1.x-B.m_sweep.localCenter.x,p=this.m_localAnchor1.y-B.m_sweep.localCenter.y,k=w.col1.x*y+w.col2.x*p;p=w.col1.y*y+w.col2.y*p;y=k;w=z.m_xf.R;var u=this.m_localAnchor2.x-z.m_sweep.localCenter.x,F=this.m_localAnchor2.y-z.m_sweep.localCenter.y;k=w.col1.x*u+w.col2.x*F;F=w.col1.y*u+w.col2.y*F;u=k;w=z.m_sweep.c.x+u-(B.m_sweep.c.x+y);k=z.m_sweep.c.y+F-(B.m_sweep.c.y+p);var D=B.GetWorldVector(this.m_localXAxis1),A=B.m_linearVelocity,E=z.m_linearVelocity;B=B.m_angularVelocity;z=z.m_angularVelocity;return w*-B*D.y+k*B*D.x+(D.x*(E.x+-z*F-A.x- -B*p)+D.y*(E.y+z*u-A.y-B*y))};t.prototype.IsLimitEnabled=function(){return this.m_enableLimit};t.prototype.EnableLimit=function(k){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableLimit=k};t.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};t.prototype.GetUpperLimit=function(){return this.m_upperTranslation};t.prototype.SetLimits=function(p,k){if(p===undefined){p=0}if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_lowerTranslation=p;this.m_upperTranslation=k};t.prototype.IsMotorEnabled=function(){return this.m_enableMotor};t.prototype.EnableMotor=function(k){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_enableMotor=k};t.prototype.SetMotorSpeed=function(k){if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=k};t.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};t.prototype.SetMaxMotorForce=function(k){if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_maxMotorForce=k};t.prototype.GetMotorForce=function(){return this.m_motorImpulse};t.prototype.b2PrismaticJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);this.m_localXAxis1.SetV(k.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=k.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=k.lowerTranslation;this.m_upperTranslation=k.upperTranslation;this.m_maxMotorForce=k.maxMotorForce;this.m_motorSpeed=k.motorSpeed;this.m_enableLimit=k.enableLimit;this.m_enableMotor=k.enableMotor;this.m_limitState=s.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};t.prototype.InitVelocityConstraints=function(B){var z=this.m_bodyA,w=this.m_bodyB,y,p=0;this.m_localCenterA.SetV(z.GetLocalCenter());this.m_localCenterB.SetV(w.GetLocalCenter());var k=z.GetTransform();w.GetTransform();y=z.m_xf.R;var u=this.m_localAnchor1.x-this.m_localCenterA.x,E=this.m_localAnchor1.y-this.m_localCenterA.y;p=y.col1.x*u+y.col2.x*E;E=y.col1.y*u+y.col2.y*E;u=p;y=w.m_xf.R;var D=this.m_localAnchor2.x-this.m_localCenterB.x,A=this.m_localAnchor2.y-this.m_localCenterB.y;p=y.col1.x*D+y.col2.x*A;A=y.col1.y*D+y.col2.y*A;D=p;y=w.m_sweep.c.x+D-z.m_sweep.c.x-u;p=w.m_sweep.c.y+A-z.m_sweep.c.y-E;this.m_invMassA=z.m_invMass;this.m_invMassB=w.m_invMass;this.m_invIA=z.m_invI;this.m_invIB=w.m_invI;this.m_axis.SetV(r.MulMV(k.R,this.m_localXAxis1));this.m_a1=(y+u)*this.m_axis.y-(p+E)*this.m_axis.x;this.m_a2=D*this.m_axis.y-A*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE){this.m_motorMass=1/this.m_motorMass}this.m_perp.SetV(r.MulMV(k.R,this.m_localYAxis1));this.m_s1=(y+u)*this.m_perp.y-(p+E)*this.m_perp.x;this.m_s2=D*this.m_perp.y-A*this.m_perp.x;k=this.m_invMassA;u=this.m_invMassB;E=this.m_invIA;D=this.m_invIB;this.m_K.col1.x=k+u+E*this.m_s1*this.m_s1+D*this.m_s2*this.m_s2;this.m_K.col1.y=E*this.m_s1+D*this.m_s2;this.m_K.col1.z=E*this.m_s1*this.m_a1+D*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=E+D;this.m_K.col2.z=E*this.m_a1+D*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=k+u+E*this.m_a1*this.m_a1+D*this.m_a2*this.m_a2;if(this.m_enableLimit){y=this.m_axis.x*y+this.m_axis.y*p;if(r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*P.b2_linearSlop){this.m_limitState=s.e_equalLimits}else{if(y<=this.m_lowerTranslation){if(this.m_limitState!=s.e_atLowerLimit){this.m_limitState=s.e_atLowerLimit;this.m_impulse.z=0}}else{if(y>=this.m_upperTranslation){if(this.m_limitState!=s.e_atUpperLimit){this.m_limitState=s.e_atUpperLimit;this.m_impulse.z=0}}else{this.m_limitState=s.e_inactiveLimit;this.m_impulse.z=0}}}}else{this.m_limitState=s.e_inactiveLimit}if(this.m_enableMotor==false){this.m_motorImpulse=0}if(B.warmStarting){this.m_impulse.x*=B.dtRatio;this.m_impulse.y*=B.dtRatio;this.m_motorImpulse*=B.dtRatio;B=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x;y=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y;p=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;k=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;z.m_linearVelocity.x-=this.m_invMassA*B;z.m_linearVelocity.y-=this.m_invMassA*y;z.m_angularVelocity-=this.m_invIA*p;w.m_linearVelocity.x+=this.m_invMassB*B;w.m_linearVelocity.y+=this.m_invMassB*y;w.m_angularVelocity+=this.m_invIB*k}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};t.prototype.SolveVelocityConstraints=function(B){var z=this.m_bodyA,w=this.m_bodyB,y=z.m_linearVelocity,p=z.m_angularVelocity,k=w.m_linearVelocity,u=w.m_angularVelocity,F=0,D=0,A=0,E=0;if(this.m_enableMotor&&this.m_limitState!=s.e_equalLimits){E=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(k.x-y.x)+this.m_axis.y*(k.y-y.y)+this.m_a2*u-this.m_a1*p));F=this.m_motorImpulse;B=B.dt*this.m_maxMotorForce;this.m_motorImpulse=r.Clamp(this.m_motorImpulse+E,-B,B);E=this.m_motorImpulse-F;F=E*this.m_axis.x;D=E*this.m_axis.y;A=E*this.m_a1;E=E*this.m_a2;y.x-=this.m_invMassA*F;y.y-=this.m_invMassA*D;p-=this.m_invIA*A;k.x+=this.m_invMassB*F;k.y+=this.m_invMassB*D;u+=this.m_invIB*E}A=this.m_perp.x*(k.x-y.x)+this.m_perp.y*(k.y-y.y)+this.m_s2*u-this.m_s1*p;D=u-p;if(this.m_enableLimit&&this.m_limitState!=s.e_inactiveLimit){B=this.m_axis.x*(k.x-y.x)+this.m_axis.y*(k.y-y.y)+this.m_a2*u-this.m_a1*p;F=this.m_impulse.Copy();B=this.m_K.Solve33(new ac,-A,-D,-B);this.m_impulse.Add(B);if(this.m_limitState==s.e_atLowerLimit){this.m_impulse.z=r.Max(this.m_impulse.z,0)}else{if(this.m_limitState==s.e_atUpperLimit){this.m_impulse.z=r.Min(this.m_impulse.z,0)}}A=-A-(this.m_impulse.z-F.z)*this.m_K.col3.x;D=-D-(this.m_impulse.z-F.z)*this.m_K.col3.y;D=this.m_K.Solve22(new v,A,D);D.x+=F.x;D.y+=F.y;this.m_impulse.x=D.x;this.m_impulse.y=D.y;B.x=this.m_impulse.x-F.x;B.y=this.m_impulse.y-F.y;B.z=this.m_impulse.z-F.z;F=B.x*this.m_perp.x+B.z*this.m_axis.x;D=B.x*this.m_perp.y+B.z*this.m_axis.y;A=B.x*this.m_s1+B.y+B.z*this.m_a1;E=B.x*this.m_s2+B.y+B.z*this.m_a2}else{B=this.m_K.Solve22(new v,-A,-D);this.m_impulse.x+=B.x;this.m_impulse.y+=B.y;F=B.x*this.m_perp.x;D=B.x*this.m_perp.y;A=B.x*this.m_s1+B.y;E=B.x*this.m_s2+B.y}y.x-=this.m_invMassA*F;y.y-=this.m_invMassA*D;p-=this.m_invIA*A;k.x+=this.m_invMassB*F;k.y+=this.m_invMassB*D;u+=this.m_invIB*E;z.m_linearVelocity.SetV(y);z.m_angularVelocity=p;w.m_linearVelocity.SetV(k);w.m_angularVelocity=u};t.prototype.SolvePositionConstraints=function(){var G=this.m_bodyA,B=this.m_bodyB,z=G.m_sweep.c,A=G.m_sweep.a,u=B.m_sweep.c,p=B.m_sweep.a,w,K=0,H=0,D=0,I=K=w=0,F=0;H=false;var E=0,y=C.FromAngle(A),k=C.FromAngle(p);w=y;F=this.m_localAnchor1.x-this.m_localCenterA.x;var M=this.m_localAnchor1.y-this.m_localCenterA.y;K=w.col1.x*F+w.col2.x*M;M=w.col1.y*F+w.col2.y*M;F=K;w=k;k=this.m_localAnchor2.x-this.m_localCenterB.x;D=this.m_localAnchor2.y-this.m_localCenterB.y;K=w.col1.x*k+w.col2.x*D;D=w.col1.y*k+w.col2.y*D;k=K;w=u.x+k-z.x-F;K=u.y+D-z.y-M;if(this.m_enableLimit){this.m_axis=r.MulMV(y,this.m_localXAxis1);this.m_a1=(w+F)*this.m_axis.y-(K+M)*this.m_axis.x;this.m_a2=k*this.m_axis.y-D*this.m_axis.x;var L=this.m_axis.x*w+this.m_axis.y*K;if(r.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*P.b2_linearSlop){E=r.Clamp(L,-P.b2_maxLinearCorrection,P.b2_maxLinearCorrection);I=r.Abs(L);H=true}else{if(L<=this.m_lowerTranslation){E=r.Clamp(L-this.m_lowerTranslation+P.b2_linearSlop,-P.b2_maxLinearCorrection,0);I=this.m_lowerTranslation-L;H=true}else{if(L>=this.m_upperTranslation){E=r.Clamp(L-this.m_upperTranslation+P.b2_linearSlop,0,P.b2_maxLinearCorrection);I=L-this.m_upperTranslation;H=true}}}}this.m_perp=r.MulMV(y,this.m_localYAxis1);this.m_s1=(w+F)*this.m_perp.y-(K+M)*this.m_perp.x;this.m_s2=k*this.m_perp.y-D*this.m_perp.x;y=new ac;M=this.m_perp.x*w+this.m_perp.y*K;k=p-A-this.m_refAngle;I=r.Max(I,r.Abs(M));F=r.Abs(k);if(H){H=this.m_invMassA;D=this.m_invMassB;w=this.m_invIA;K=this.m_invIB;this.m_K.col1.x=H+D+w*this.m_s1*this.m_s1+K*this.m_s2*this.m_s2;this.m_K.col1.y=w*this.m_s1+K*this.m_s2;this.m_K.col1.z=w*this.m_s1*this.m_a1+K*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=w+K;this.m_K.col2.z=w*this.m_a1+K*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=H+D+w*this.m_a1*this.m_a1+K*this.m_a2*this.m_a2;this.m_K.Solve33(y,-M,-k,-E)}else{H=this.m_invMassA;D=this.m_invMassB;w=this.m_invIA;K=this.m_invIB;E=w*this.m_s1+K*this.m_s2;L=w+K;this.m_K.col1.Set(H+D+w*this.m_s1*this.m_s1+K*this.m_s2*this.m_s2,E,0);this.m_K.col2.Set(E,L,0);E=this.m_K.Solve22(new v,-M,-k);y.x=E.x;y.y=E.y;y.z=0}E=y.x*this.m_perp.x+y.z*this.m_axis.x;H=y.x*this.m_perp.y+y.z*this.m_axis.y;M=y.x*this.m_s1+y.y+y.z*this.m_a1;y=y.x*this.m_s2+y.y+y.z*this.m_a2;z.x-=this.m_invMassA*E;z.y-=this.m_invMassA*H;A-=this.m_invIA*M;u.x+=this.m_invMassB*E;u.y+=this.m_invMassB*H;p+=this.m_invIB*y;G.m_sweep.a=A;B.m_sweep.a=p;G.SynchronizeTransform();B.SynchronizeTransform();return I<=P.b2_linearSlop&&F<=P.b2_angularSlop};Box2D.inherit(j,Box2D.Dynamics.Joints.b2JointDef);j.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;j.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new v;this.localAnchorB=new v;this.localAxisA=new v};j.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=s.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=false;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=false;this.motorSpeed=this.maxMotorForce=0};j.prototype.Initialize=function(w,u,k,p){this.bodyA=w;this.bodyB=u;this.localAnchorA=this.bodyA.GetLocalPoint(k);this.localAnchorB=this.bodyB.GetLocalPoint(k);this.localAxisA=this.bodyA.GetLocalVector(p);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(T,Box2D.Dynamics.Joints.b2Joint);T.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;T.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new v;this.m_groundAnchor2=new v;this.m_localAnchor1=new v;this.m_localAnchor2=new v;this.m_u1=new v;this.m_u2=new v};T.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};T.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};T.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new v(k*this.m_impulse*this.m_u2.x,k*this.m_impulse*this.m_u2.y)};T.prototype.GetReactionTorque=function(){return 0};T.prototype.GetGroundAnchorA=function(){var k=this.m_ground.m_xf.position.Copy();k.Add(this.m_groundAnchor1);return k};T.prototype.GetGroundAnchorB=function(){var k=this.m_ground.m_xf.position.Copy();k.Add(this.m_groundAnchor2);return k};T.prototype.GetLength1=function(){var p=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),k=p.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);p=p.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(k*k+p*p)};T.prototype.GetLength2=function(){var p=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),k=p.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);p=p.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(k*k+p*p)};T.prototype.GetRatio=function(){return this.m_ratio};T.prototype.b2PulleyJoint=function(k){this.__super.b2Joint.call(this,k);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=k.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=k.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=k.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=k.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);this.m_ratio=k.ratio;this.m_constant=k.lengthA+this.m_ratio*k.lengthB;this.m_maxLength1=r.Min(k.maxLengthA,this.m_constant-this.m_ratio*T.b2_minPulleyLength);this.m_maxLength2=r.Min(k.maxLengthB,(this.m_constant-T.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};T.prototype.InitVelocityConstraints=function(B){var z=this.m_bodyA,w=this.m_bodyB,y;y=z.m_xf.R;var p=this.m_localAnchor1.x-z.m_sweep.localCenter.x,k=this.m_localAnchor1.y-z.m_sweep.localCenter.y,u=y.col1.x*p+y.col2.x*k;k=y.col1.y*p+y.col2.y*k;p=u;y=w.m_xf.R;var F=this.m_localAnchor2.x-w.m_sweep.localCenter.x,D=this.m_localAnchor2.y-w.m_sweep.localCenter.y;u=y.col1.x*F+y.col2.x*D;D=y.col1.y*F+y.col2.y*D;F=u;y=w.m_sweep.c.x+F;u=w.m_sweep.c.y+D;var A=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,E=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(z.m_sweep.c.x+p-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),z.m_sweep.c.y+k-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(y-A,u-E);y=this.m_u1.Length();u=this.m_u2.Length();y>P.b2_linearSlop?this.m_u1.Multiply(1/y):this.m_u1.SetZero();u>P.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero();if(this.m_constant-y-this.m_ratio*u>0){this.m_state=s.e_inactiveLimit;this.m_impulse=0}else{this.m_state=s.e_atUpperLimit}if(y<this.m_maxLength1){this.m_limitState1=s.e_inactiveLimit;this.m_limitImpulse1=0}else{this.m_limitState1=s.e_atUpperLimit}if(u<this.m_maxLength2){this.m_limitState2=s.e_inactiveLimit;this.m_limitImpulse2=0}else{this.m_limitState2=s.e_atUpperLimit}y=p*this.m_u1.y-k*this.m_u1.x;u=F*this.m_u2.y-D*this.m_u2.x;this.m_limitMass1=z.m_invMass+z.m_invI*y*y;this.m_limitMass2=w.m_invMass+w.m_invI*u*u;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;if(B.warmStarting){this.m_impulse*=B.dtRatio;this.m_limitImpulse1*=B.dtRatio;this.m_limitImpulse2*=B.dtRatio;B=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x;y=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y;u=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x;A=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;z.m_linearVelocity.x+=z.m_invMass*B;z.m_linearVelocity.y+=z.m_invMass*y;z.m_angularVelocity+=z.m_invI*(p*y-k*B);w.m_linearVelocity.x+=w.m_invMass*u;w.m_linearVelocity.y+=w.m_invMass*A;w.m_angularVelocity+=w.m_invI*(F*A-D*u)}else{this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0}};T.prototype.SolveVelocityConstraints=function(){var B=this.m_bodyA,z=this.m_bodyB,w;w=B.m_xf.R;var y=this.m_localAnchor1.x-B.m_sweep.localCenter.x,p=this.m_localAnchor1.y-B.m_sweep.localCenter.y,k=w.col1.x*y+w.col2.x*p;p=w.col1.y*y+w.col2.y*p;y=k;w=z.m_xf.R;var u=this.m_localAnchor2.x-z.m_sweep.localCenter.x,E=this.m_localAnchor2.y-z.m_sweep.localCenter.y;k=w.col1.x*u+w.col2.x*E;E=w.col1.y*u+w.col2.y*E;u=k;var D=k=w=0,A=0;w=A=w=A=D=k=w=0;if(this.m_state==s.e_atUpperLimit){w=B.m_linearVelocity.x+-B.m_angularVelocity*p;k=B.m_linearVelocity.y+B.m_angularVelocity*y;D=z.m_linearVelocity.x+-z.m_angularVelocity*E;A=z.m_linearVelocity.y+z.m_angularVelocity*u;w=-(this.m_u1.x*w+this.m_u1.y*k)-this.m_ratio*(this.m_u2.x*D+this.m_u2.y*A);A=this.m_pulleyMass*-w;w=this.m_impulse;this.m_impulse=r.Max(0,this.m_impulse+A);A=this.m_impulse-w;w=-A*this.m_u1.x;k=-A*this.m_u1.y;D=-this.m_ratio*A*this.m_u2.x;A=-this.m_ratio*A*this.m_u2.y;B.m_linearVelocity.x+=B.m_invMass*w;B.m_linearVelocity.y+=B.m_invMass*k;B.m_angularVelocity+=B.m_invI*(y*k-p*w);z.m_linearVelocity.x+=z.m_invMass*D;z.m_linearVelocity.y+=z.m_invMass*A;z.m_angularVelocity+=z.m_invI*(u*A-E*D)}if(this.m_limitState1==s.e_atUpperLimit){w=B.m_linearVelocity.x+-B.m_angularVelocity*p;k=B.m_linearVelocity.y+B.m_angularVelocity*y;w=-(this.m_u1.x*w+this.m_u1.y*k);A=-this.m_limitMass1*w;w=this.m_limitImpulse1;this.m_limitImpulse1=r.Max(0,this.m_limitImpulse1+A);A=this.m_limitImpulse1-w;w=-A*this.m_u1.x;k=-A*this.m_u1.y;B.m_linearVelocity.x+=B.m_invMass*w;B.m_linearVelocity.y+=B.m_invMass*k;B.m_angularVelocity+=B.m_invI*(y*k-p*w)}if(this.m_limitState2==s.e_atUpperLimit){D=z.m_linearVelocity.x+-z.m_angularVelocity*E;A=z.m_linearVelocity.y+z.m_angularVelocity*u;w=-(this.m_u2.x*D+this.m_u2.y*A);A=-this.m_limitMass2*w;w=this.m_limitImpulse2;this.m_limitImpulse2=r.Max(0,this.m_limitImpulse2+A);A=this.m_limitImpulse2-w;D=-A*this.m_u2.x;A=-A*this.m_u2.y;z.m_linearVelocity.x+=z.m_invMass*D;z.m_linearVelocity.y+=z.m_invMass*A;z.m_angularVelocity+=z.m_invI*(u*A-E*D)}};T.prototype.SolvePositionConstraints=function(){var G=this.m_bodyA,B=this.m_bodyB,z,A=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,p=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,w=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,K=0,H=0,D=0,I=0,F=z=0,E=0,y=0,k=F=y=z=F=z=0;if(this.m_state==s.e_atUpperLimit){z=G.m_xf.R;K=this.m_localAnchor1.x-G.m_sweep.localCenter.x;H=this.m_localAnchor1.y-G.m_sweep.localCenter.y;F=z.col1.x*K+z.col2.x*H;H=z.col1.y*K+z.col2.y*H;K=F;z=B.m_xf.R;D=this.m_localAnchor2.x-B.m_sweep.localCenter.x;I=this.m_localAnchor2.y-B.m_sweep.localCenter.y;F=z.col1.x*D+z.col2.x*I;I=z.col1.y*D+z.col2.y*I;D=F;z=G.m_sweep.c.x+K;F=G.m_sweep.c.y+H;E=B.m_sweep.c.x+D;y=B.m_sweep.c.y+I;this.m_u1.Set(z-A,F-u);this.m_u2.Set(E-p,y-w);z=this.m_u1.Length();F=this.m_u2.Length();z>P.b2_linearSlop?this.m_u1.Multiply(1/z):this.m_u1.SetZero();F>P.b2_linearSlop?this.m_u2.Multiply(1/F):this.m_u2.SetZero();z=this.m_constant-z-this.m_ratio*F;k=r.Max(k,-z);z=r.Clamp(z+P.b2_linearSlop,-P.b2_maxLinearCorrection,0);y=-this.m_pulleyMass*z;z=-y*this.m_u1.x;F=-y*this.m_u1.y;E=-this.m_ratio*y*this.m_u2.x;y=-this.m_ratio*y*this.m_u2.y;G.m_sweep.c.x+=G.m_invMass*z;G.m_sweep.c.y+=G.m_invMass*F;G.m_sweep.a+=G.m_invI*(K*F-H*z);B.m_sweep.c.x+=B.m_invMass*E;B.m_sweep.c.y+=B.m_invMass*y;B.m_sweep.a+=B.m_invI*(D*y-I*E);G.SynchronizeTransform();B.SynchronizeTransform()}if(this.m_limitState1==s.e_atUpperLimit){z=G.m_xf.R;K=this.m_localAnchor1.x-G.m_sweep.localCenter.x;H=this.m_localAnchor1.y-G.m_sweep.localCenter.y;F=z.col1.x*K+z.col2.x*H;H=z.col1.y*K+z.col2.y*H;K=F;z=G.m_sweep.c.x+K;F=G.m_sweep.c.y+H;this.m_u1.Set(z-A,F-u);z=this.m_u1.Length();if(z>P.b2_linearSlop){this.m_u1.x*=1/z;this.m_u1.y*=1/z}else{this.m_u1.SetZero()}z=this.m_maxLength1-z;k=r.Max(k,-z);z=r.Clamp(z+P.b2_linearSlop,-P.b2_maxLinearCorrection,0);y=-this.m_limitMass1*z;z=-y*this.m_u1.x;F=-y*this.m_u1.y;G.m_sweep.c.x+=G.m_invMass*z;G.m_sweep.c.y+=G.m_invMass*F;G.m_sweep.a+=G.m_invI*(K*F-H*z);G.SynchronizeTransform()}if(this.m_limitState2==s.e_atUpperLimit){z=B.m_xf.R;D=this.m_localAnchor2.x-B.m_sweep.localCenter.x;I=this.m_localAnchor2.y-B.m_sweep.localCenter.y;F=z.col1.x*D+z.col2.x*I;I=z.col1.y*D+z.col2.y*I;D=F;E=B.m_sweep.c.x+D;y=B.m_sweep.c.y+I;this.m_u2.Set(E-p,y-w);F=this.m_u2.Length();if(F>P.b2_linearSlop){this.m_u2.x*=1/F;this.m_u2.y*=1/F}else{this.m_u2.SetZero()}z=this.m_maxLength2-F;k=r.Max(k,-z);z=r.Clamp(z+P.b2_linearSlop,-P.b2_maxLinearCorrection,0);y=-this.m_limitMass2*z;E=-y*this.m_u2.x;y=-y*this.m_u2.y;B.m_sweep.c.x+=B.m_invMass*E;B.m_sweep.c.y+=B.m_invMass*y;B.m_sweep.a+=B.m_invI*(D*y-I*E);B.SynchronizeTransform()}return k<P.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(g,Box2D.Dynamics.Joints.b2JointDef);g.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;g.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new v;this.groundAnchorB=new v;this.localAnchorA=new v;this.localAnchorB=new v};g.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=s.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=true};g.prototype.Initialize=function(z,u,k,p,y,w,A){if(A===undefined){A=0}this.bodyA=z;this.bodyB=u;this.groundAnchorA.SetV(k);this.groundAnchorB.SetV(p);this.localAnchorA=this.bodyA.GetLocalPoint(y);this.localAnchorB=this.bodyB.GetLocalPoint(w);z=y.x-k.x;k=y.y-k.y;this.lengthA=Math.sqrt(z*z+k*k);k=w.x-p.x;p=w.y-p.y;this.lengthB=Math.sqrt(k*k+p*p);this.ratio=A;A=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=A-this.ratio*T.b2_minPulleyLength;this.maxLengthB=(A-T.b2_minPulleyLength)/this.ratio};Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint);l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;l.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new C;this.K1=new C;this.K2=new C;this.K3=new C;this.impulse3=new ac;this.impulse2=new v;this.reduced=new v;this.m_localAnchor1=new v;this.m_localAnchor2=new v;this.m_impulse=new ac;this.m_mass=new q};l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};l.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new v(k*this.m_impulse.x,k*this.m_impulse.y)};l.prototype.GetReactionTorque=function(k){if(k===undefined){k=0}return k*this.m_impulse.z};l.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};l.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};l.prototype.IsLimitEnabled=function(){return this.m_enableLimit};l.prototype.EnableLimit=function(k){this.m_enableLimit=k};l.prototype.GetLowerLimit=function(){return this.m_lowerAngle};l.prototype.GetUpperLimit=function(){return this.m_upperAngle};l.prototype.SetLimits=function(p,k){if(p===undefined){p=0}if(k===undefined){k=0}this.m_lowerAngle=p;this.m_upperAngle=k};l.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);return this.m_enableMotor};l.prototype.EnableMotor=function(k){this.m_enableMotor=k};l.prototype.SetMotorSpeed=function(k){if(k===undefined){k=0}this.m_bodyA.SetAwake(true);this.m_bodyB.SetAwake(true);this.m_motorSpeed=k};l.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};l.prototype.SetMaxMotorTorque=function(k){if(k===undefined){k=0}this.m_maxMotorTorque=k};l.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};l.prototype.b2RevoluteJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchor1.SetV(k.localAnchorA);this.m_localAnchor2.SetV(k.localAnchorB);this.m_referenceAngle=k.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=k.lowerAngle;this.m_upperAngle=k.upperAngle;this.m_maxMotorTorque=k.maxMotorTorque;this.m_motorSpeed=k.motorSpeed;this.m_enableLimit=k.enableLimit;this.m_enableMotor=k.enableMotor;this.m_limitState=s.e_inactiveLimit};l.prototype.InitVelocityConstraints=function(D){var z=this.m_bodyA,w=this.m_bodyB,y,p=0;y=z.m_xf.R;var k=this.m_localAnchor1.x-z.m_sweep.localCenter.x,u=this.m_localAnchor1.y-z.m_sweep.localCenter.y;p=y.col1.x*k+y.col2.x*u;u=y.col1.y*k+y.col2.y*u;k=p;y=w.m_xf.R;var G=this.m_localAnchor2.x-w.m_sweep.localCenter.x,E=this.m_localAnchor2.y-w.m_sweep.localCenter.y;p=y.col1.x*G+y.col2.x*E;E=y.col1.y*G+y.col2.y*E;G=p;y=z.m_invMass;p=w.m_invMass;var A=z.m_invI,F=w.m_invI;this.m_mass.col1.x=y+p+u*u*A+E*E*F;this.m_mass.col2.x=-u*k*A-E*G*F;this.m_mass.col3.x=-u*A-E*F;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=y+p+k*k*A+G*G*F;this.m_mass.col3.y=k*A+G*F;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=A+F;this.m_motorMass=1/(A+F);if(this.m_enableMotor==false){this.m_motorImpulse=0}if(this.m_enableLimit){var B=w.m_sweep.a-z.m_sweep.a-this.m_referenceAngle;if(r.Abs(this.m_upperAngle-this.m_lowerAngle)<2*P.b2_angularSlop){this.m_limitState=s.e_equalLimits}else{if(B<=this.m_lowerAngle){if(this.m_limitState!=s.e_atLowerLimit){this.m_impulse.z=0}this.m_limitState=s.e_atLowerLimit}else{if(B>=this.m_upperAngle){if(this.m_limitState!=s.e_atUpperLimit){this.m_impulse.z=0}this.m_limitState=s.e_atUpperLimit}else{this.m_limitState=s.e_inactiveLimit;this.m_impulse.z=0}}}}else{this.m_limitState=s.e_inactiveLimit}if(D.warmStarting){this.m_impulse.x*=D.dtRatio;this.m_impulse.y*=D.dtRatio;this.m_motorImpulse*=D.dtRatio;D=this.m_impulse.x;B=this.m_impulse.y;z.m_linearVelocity.x-=y*D;z.m_linearVelocity.y-=y*B;z.m_angularVelocity-=A*(k*B-u*D+this.m_motorImpulse+this.m_impulse.z);w.m_linearVelocity.x+=p*D;w.m_linearVelocity.y+=p*B;w.m_angularVelocity+=F*(G*B-E*D+this.m_motorImpulse+this.m_impulse.z)}else{this.m_impulse.SetZero();this.m_motorImpulse=0}};l.prototype.SolveVelocityConstraints=function(G){var B=this.m_bodyA,z=this.m_bodyB,A=0,u=A=0,p=0,w=0,K=0,H=B.m_linearVelocity,D=B.m_angularVelocity,I=z.m_linearVelocity,F=z.m_angularVelocity,E=B.m_invMass,y=z.m_invMass,k=B.m_invI,M=z.m_invI;if(this.m_enableMotor&&this.m_limitState!=s.e_equalLimits){u=this.m_motorMass*-(F-D-this.m_motorSpeed);p=this.m_motorImpulse;w=G.dt*this.m_maxMotorTorque;this.m_motorImpulse=r.Clamp(this.m_motorImpulse+u,-w,w);u=this.m_motorImpulse-p;D-=k*u;F+=M*u}if(this.m_enableLimit&&this.m_limitState!=s.e_inactiveLimit){G=B.m_xf.R;u=this.m_localAnchor1.x-B.m_sweep.localCenter.x;p=this.m_localAnchor1.y-B.m_sweep.localCenter.y;A=G.col1.x*u+G.col2.x*p;p=G.col1.y*u+G.col2.y*p;u=A;G=z.m_xf.R;w=this.m_localAnchor2.x-z.m_sweep.localCenter.x;K=this.m_localAnchor2.y-z.m_sweep.localCenter.y;A=G.col1.x*w+G.col2.x*K;K=G.col1.y*w+G.col2.y*K;w=A;G=I.x+-F*K-H.x- -D*p;var L=I.y+F*w-H.y-D*u;this.m_mass.Solve33(this.impulse3,-G,-L,-(F-D));if(this.m_limitState==s.e_equalLimits){this.m_impulse.Add(this.impulse3)}else{if(this.m_limitState==s.e_atLowerLimit){A=this.m_impulse.z+this.impulse3.z;if(A<0){this.m_mass.Solve22(this.reduced,-G,-L);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}else{if(this.m_limitState==s.e_atUpperLimit){A=this.m_impulse.z+this.impulse3.z;if(A>0){this.m_mass.Solve22(this.reduced,-G,-L);this.impulse3.x=this.reduced.x;this.impulse3.y=this.reduced.y;this.impulse3.z=-this.m_impulse.z;this.m_impulse.x+=this.reduced.x;this.m_impulse.y+=this.reduced.y;this.m_impulse.z=0}}}}H.x-=E*this.impulse3.x;H.y-=E*this.impulse3.y;D-=k*(u*this.impulse3.y-p*this.impulse3.x+this.impulse3.z);I.x+=y*this.impulse3.x;I.y+=y*this.impulse3.y;F+=M*(w*this.impulse3.y-K*this.impulse3.x+this.impulse3.z)}else{G=B.m_xf.R;u=this.m_localAnchor1.x-B.m_sweep.localCenter.x;p=this.m_localAnchor1.y-B.m_sweep.localCenter.y;A=G.col1.x*u+G.col2.x*p;p=G.col1.y*u+G.col2.y*p;u=A;G=z.m_xf.R;w=this.m_localAnchor2.x-z.m_sweep.localCenter.x;K=this.m_localAnchor2.y-z.m_sweep.localCenter.y;A=G.col1.x*w+G.col2.x*K;K=G.col1.y*w+G.col2.y*K;w=A;this.m_mass.Solve22(this.impulse2,-(I.x+-F*K-H.x- -D*p),-(I.y+F*w-H.y-D*u));this.m_impulse.x+=this.impulse2.x;this.m_impulse.y+=this.impulse2.y;H.x-=E*this.impulse2.x;H.y-=E*this.impulse2.y;D-=k*(u*this.impulse2.y-p*this.impulse2.x);I.x+=y*this.impulse2.x;I.y+=y*this.impulse2.y;F+=M*(w*this.impulse2.y-K*this.impulse2.x)}B.m_linearVelocity.SetV(H);B.m_angularVelocity=D;z.m_linearVelocity.SetV(I);z.m_angularVelocity=F};l.prototype.SolvePositionConstraints=function(){var G=0,B,z=this.m_bodyA,A=this.m_bodyB,u=0,p=B=0,w=0,K=0;if(this.m_enableLimit&&this.m_limitState!=s.e_inactiveLimit){G=A.m_sweep.a-z.m_sweep.a-this.m_referenceAngle;var H=0;if(this.m_limitState==s.e_equalLimits){G=r.Clamp(G-this.m_lowerAngle,-P.b2_maxAngularCorrection,P.b2_maxAngularCorrection);H=-this.m_motorMass*G;u=r.Abs(G)}else{if(this.m_limitState==s.e_atLowerLimit){G=G-this.m_lowerAngle;u=-G;G=r.Clamp(G+P.b2_angularSlop,-P.b2_maxAngularCorrection,0);H=-this.m_motorMass*G}else{if(this.m_limitState==s.e_atUpperLimit){u=G=G-this.m_upperAngle;G=r.Clamp(G-P.b2_angularSlop,0,P.b2_maxAngularCorrection);H=-this.m_motorMass*G}}}z.m_sweep.a-=z.m_invI*H;A.m_sweep.a+=A.m_invI*H;z.SynchronizeTransform();A.SynchronizeTransform()}B=z.m_xf.R;H=this.m_localAnchor1.x-z.m_sweep.localCenter.x;G=this.m_localAnchor1.y-z.m_sweep.localCenter.y;p=B.col1.x*H+B.col2.x*G;G=B.col1.y*H+B.col2.y*G;H=p;B=A.m_xf.R;var D=this.m_localAnchor2.x-A.m_sweep.localCenter.x,I=this.m_localAnchor2.y-A.m_sweep.localCenter.y;p=B.col1.x*D+B.col2.x*I;I=B.col1.y*D+B.col2.y*I;D=p;w=A.m_sweep.c.x+D-z.m_sweep.c.x-H;K=A.m_sweep.c.y+I-z.m_sweep.c.y-G;var F=w*w+K*K;B=Math.sqrt(F);p=z.m_invMass;var E=A.m_invMass,y=z.m_invI,k=A.m_invI,L=10*P.b2_linearSlop;if(F>L*L){F=1/(p+E);w=F*-w;K=F*-K;z.m_sweep.c.x-=0.5*p*w;z.m_sweep.c.y-=0.5*p*K;A.m_sweep.c.x+=0.5*E*w;A.m_sweep.c.y+=0.5*E*K;w=A.m_sweep.c.x+D-z.m_sweep.c.x-H;K=A.m_sweep.c.y+I-z.m_sweep.c.y-G}this.K1.col1.x=p+E;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=p+E;this.K2.col1.x=y*G*G;this.K2.col2.x=-y*H*G;this.K2.col1.y=-y*H*G;this.K2.col2.y=y*H*H;this.K3.col1.x=k*I*I;this.K3.col2.x=-k*D*I;this.K3.col1.y=-k*D*I;this.K3.col2.y=k*D*D;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(l.tImpulse,-w,-K);w=l.tImpulse.x;K=l.tImpulse.y;z.m_sweep.c.x-=z.m_invMass*w;z.m_sweep.c.y-=z.m_invMass*K;z.m_sweep.a-=z.m_invI*(H*K-G*w);A.m_sweep.c.x+=A.m_invMass*w;A.m_sweep.c.y+=A.m_invMass*K;A.m_sweep.a+=A.m_invI*(D*K-I*w);z.SynchronizeTransform();A.SynchronizeTransform();return B<=P.b2_linearSlop&&u<=P.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new v});Box2D.inherit(f,Box2D.Dynamics.Joints.b2JointDef);f.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;f.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new v;this.localAnchorB=new v};f.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=s.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=false};f.prototype.Initialize=function(u,p,k){this.bodyA=u;this.bodyB=p;this.localAnchorA=this.bodyA.GetLocalPoint(k);this.localAnchorB=this.bodyB.GetLocalPoint(k);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(af,Box2D.Dynamics.Joints.b2Joint);af.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;af.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new v;this.m_localAnchorB=new v;this.m_impulse=new ac;this.m_mass=new q};af.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};af.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};af.prototype.GetReactionForce=function(k){if(k===undefined){k=0}return new v(k*this.m_impulse.x,k*this.m_impulse.y)};af.prototype.GetReactionTorque=function(k){if(k===undefined){k=0}return k*this.m_impulse.z};af.prototype.b2WeldJoint=function(k){this.__super.b2Joint.call(this,k);this.m_localAnchorA.SetV(k.localAnchorA);this.m_localAnchorB.SetV(k.localAnchorB);this.m_referenceAngle=k.referenceAngle;this.m_impulse.SetZero();this.m_mass=new q};af.prototype.InitVelocityConstraints=function(B){var z,w=0,y=this.m_bodyA,p=this.m_bodyB;z=y.m_xf.R;var k=this.m_localAnchorA.x-y.m_sweep.localCenter.x,u=this.m_localAnchorA.y-y.m_sweep.localCenter.y;w=z.col1.x*k+z.col2.x*u;u=z.col1.y*k+z.col2.y*u;k=w;z=p.m_xf.R;var F=this.m_localAnchorB.x-p.m_sweep.localCenter.x,D=this.m_localAnchorB.y-p.m_sweep.localCenter.y;w=z.col1.x*F+z.col2.x*D;D=z.col1.y*F+z.col2.y*D;F=w;z=y.m_invMass;w=p.m_invMass;var A=y.m_invI,E=p.m_invI;this.m_mass.col1.x=z+w+u*u*A+D*D*E;this.m_mass.col2.x=-u*k*A-D*F*E;this.m_mass.col3.x=-u*A-D*E;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=z+w+k*k*A+F*F*E;this.m_mass.col3.y=k*A+F*E;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=A+E;if(B.warmStarting){this.m_impulse.x*=B.dtRatio;this.m_impulse.y*=B.dtRatio;this.m_impulse.z*=B.dtRatio;y.m_linearVelocity.x-=z*this.m_impulse.x;y.m_linearVelocity.y-=z*this.m_impulse.y;y.m_angularVelocity-=A*(k*this.m_impulse.y-u*this.m_impulse.x+this.m_impulse.z);p.m_linearVelocity.x+=w*this.m_impulse.x;p.m_linearVelocity.y+=w*this.m_impulse.y;p.m_angularVelocity+=E*(F*this.m_impulse.y-D*this.m_impulse.x+this.m_impulse.z)}else{this.m_impulse.SetZero()}};af.prototype.SolveVelocityConstraints=function(){var K,F=0,D=this.m_bodyA,E=this.m_bodyB,z=D.m_linearVelocity,y=D.m_angularVelocity,A=E.m_linearVelocity,N=E.m_angularVelocity,L=D.m_invMass,G=E.m_invMass,M=D.m_invI,I=E.m_invI;K=D.m_xf.R;var H=this.m_localAnchorA.x-D.m_sweep.localCenter.x,B=this.m_localAnchorA.y-D.m_sweep.localCenter.y;F=K.col1.x*H+K.col2.x*B;B=K.col1.y*H+K.col2.y*B;H=F;K=E.m_xf.R;var w=this.m_localAnchorB.x-E.m_sweep.localCenter.x,u=this.m_localAnchorB.y-E.m_sweep.localCenter.y;F=K.col1.x*w+K.col2.x*u;u=K.col1.y*w+K.col2.y*u;w=F;K=A.x-N*u-z.x+y*B;F=A.y+N*w-z.y-y*H;var k=N-y,p=new ac;this.m_mass.Solve33(p,-K,-F,-k);this.m_impulse.Add(p);z.x-=L*p.x;z.y-=L*p.y;y-=M*(H*p.y-B*p.x+p.z);A.x+=G*p.x;A.y+=G*p.y;N+=I*(w*p.y-u*p.x+p.z);D.m_angularVelocity=y;E.m_angularVelocity=N};af.prototype.SolvePositionConstraints=function(){var G,B=0,z=this.m_bodyA,A=this.m_bodyB;G=z.m_xf.R;var u=this.m_localAnchorA.x-z.m_sweep.localCenter.x,p=this.m_localAnchorA.y-z.m_sweep.localCenter.y;B=G.col1.x*u+G.col2.x*p;p=G.col1.y*u+G.col2.y*p;u=B;G=A.m_xf.R;var w=this.m_localAnchorB.x-A.m_sweep.localCenter.x,K=this.m_localAnchorB.y-A.m_sweep.localCenter.y;B=G.col1.x*w+G.col2.x*K;K=G.col1.y*w+G.col2.y*K;w=B;G=z.m_invMass;B=A.m_invMass;var H=z.m_invI,D=A.m_invI,I=A.m_sweep.c.x+w-z.m_sweep.c.x-u,F=A.m_sweep.c.y+K-z.m_sweep.c.y-p,E=A.m_sweep.a-z.m_sweep.a-this.m_referenceAngle,y=10*P.b2_linearSlop,k=Math.sqrt(I*I+F*F),L=r.Abs(E);if(k>y){H*=1;D*=1}this.m_mass.col1.x=G+B+p*p*H+K*K*D;this.m_mass.col2.x=-p*u*H-K*w*D;this.m_mass.col3.x=-p*H-K*D;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=G+B+u*u*H+w*w*D;this.m_mass.col3.y=u*H+w*D;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=H+D;y=new ac;this.m_mass.Solve33(y,-I,-F,-E);z.m_sweep.c.x-=G*y.x;z.m_sweep.c.y-=G*y.y;z.m_sweep.a-=H*(u*y.y-p*y.x+y.z);A.m_sweep.c.x+=B*y.x;A.m_sweep.c.y+=B*y.y;A.m_sweep.a+=D*(w*y.y-K*y.x+y.z);z.SynchronizeTransform();A.SynchronizeTransform();return k<=P.b2_linearSlop&&L<=P.b2_angularSlop};Box2D.inherit(a,Box2D.Dynamics.Joints.b2JointDef);a.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;a.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new v;this.localAnchorB=new v};a.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=s.e_weldJoint;this.referenceAngle=0};a.prototype.Initialize=function(u,p,k){this.bodyA=u;this.bodyB=p;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(k));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(k));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var a=Box2D.Dynamics.b2DebugDraw;a.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var b=this;this.m_sprite={graphics:{clear:function(){b.m_ctx.clearRect(0,0,1000,1000)}}}};a.prototype._color=function(c,b){return"rgba("+((c&16711680)>>16)+","+((c&65280)>>8)+","+(c&255)+","+b+")"};a.prototype.b2DebugDraw=function(){this.m_drawFlags=0};a.prototype.SetFlags=function(b){if(b===undefined){b=0}this.m_drawFlags=b};a.prototype.GetFlags=function(){return this.m_drawFlags};a.prototype.AppendFlags=function(b){if(b===undefined){b=0}this.m_drawFlags|=b};a.prototype.ClearFlags=function(b){if(b===undefined){b=0}this.m_drawFlags&=~b};a.prototype.SetSprite=function(b){this.m_ctx=b};a.prototype.GetSprite=function(){return this.m_ctx};a.prototype.SetDrawScale=function(b){if(b===undefined){b=0}this.m_drawScale=b};a.prototype.GetDrawScale=function(){return this.m_drawScale};a.prototype.SetLineThickness=function(b){if(b===undefined){b=0}this.m_lineThickness=b;this.m_ctx.strokeWidth=b};a.prototype.GetLineThickness=function(){return this.m_lineThickness};a.prototype.SetAlpha=function(b){if(b===undefined){b=0}this.m_alpha=b};a.prototype.GetAlpha=function(){return this.m_alpha};a.prototype.SetFillAlpha=function(b){if(b===undefined){b=0}this.m_fillAlpha=b};a.prototype.GetFillAlpha=function(){return this.m_fillAlpha};a.prototype.SetXFormScale=function(b){if(b===undefined){b=0}this.m_xformScale=b};a.prototype.GetXFormScale=function(){return this.m_xformScale};a.prototype.DrawPolygon=function(e,d,f){if(d){var c=this.m_ctx,b=this.m_drawScale;c.beginPath();c.strokeStyle=this._color(f.color,this.m_alpha);c.moveTo(e[0].x*b,e[0].y*b);for(f=1;f<d;f++){c.lineTo(e[f].x*b,e[f].y*b)}c.lineTo(e[0].x*b,e[0].y*b);c.closePath();c.stroke()}};a.prototype.DrawSolidPolygon=function(e,d,f){if(d){var c=this.m_ctx,b=this.m_drawScale;c.beginPath();c.strokeStyle=this._color(f.color,this.m_alpha);c.fillStyle=this._color(f.color,this.m_fillAlpha);c.moveTo(e[0].x*b,e[0].y*b);for(f=1;f<d;f++){c.lineTo(e[f].x*b,e[f].y*b)}c.lineTo(e[0].x*b,e[0].y*b);c.closePath();c.fill();c.stroke()}};a.prototype.DrawCircle=function(e,d,f){if(d){var c=this.m_ctx,b=this.m_drawScale;c.beginPath();c.strokeStyle=this._color(f.color,this.m_alpha);c.arc(e.x*b,e.y*b,d*b,0,Math.PI*2,true);c.closePath();c.stroke()}};a.prototype.DrawSolidCircle=function(f,d,j,c){if(d){var b=this.m_ctx,e=this.m_drawScale,g=f.x*e,h=f.y*e;b.moveTo(0,0);b.beginPath();b.strokeStyle=this._color(c.color,this.m_alpha);b.fillStyle=this._color(c.color,this.m_fillAlpha);b.arc(g,h,d*e,0,Math.PI*2,true);b.moveTo(g,h);b.lineTo((f.x+j.x*d)*e,(f.y+j.y*d)*e);b.closePath();b.fill();b.stroke()}};a.prototype.DrawSegment=function(e,d,f){var c=this.m_ctx,b=this.m_drawScale;c.strokeStyle=this._color(f.color,this.m_alpha);c.beginPath();c.moveTo(e.x*b,e.y*b);c.lineTo(d.x*b,d.y*b);c.closePath();c.stroke()};a.prototype.DrawTransform=function(c){var b=this.m_ctx,d=this.m_drawScale;b.beginPath();b.strokeStyle=this._color(16711680,this.m_alpha);b.moveTo(c.position.x*d,c.position.y*d);b.lineTo((c.position.x+this.m_xformScale*c.R.col1.x)*d,(c.position.y+this.m_xformScale*c.R.col1.y)*d);b.strokeStyle=this._color(65280,this.m_alpha);b.moveTo(c.position.x*d,c.position.y*d);b.lineTo((c.position.x+this.m_xformScale*c.R.col2.x)*d,(c.position.y+this.m_xformScale*c.R.col2.y)*d);b.closePath();b.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i){Box2D.postDefs[i]()}delete Box2D.postDefs;function Vec2(a,b){this.x=a;this.y=b}vMath=new function(){this.mulS=function(a,b){a.x*=b;a.y*=b};this.mulV=function(b,a){b.x*=a.x;b.y*=a.y};this.divS=function(a,b){a.x/=b;a.y/=b};this.addS=function(a,b){a.x+=b;a.y+=b};this.addV=function(b,a){b.x+=a.x;b.y+=a.y};this.subS=function(a,b){a.x-=b;a.y-=b};this.subV=function(b,a){b.x-=a.x;b.y-=a.y};this.abs=function(a){Math.abs(a.x);Math.abs(a.y)};this.dot=function(b,a){return(b.x*vec_.x+a.y*vec_.y)};this.length=function(a){return Math.sqrt(a.dot(a))};this.dist=function(b,a){return(a.subV(b)).length()};this.lengthSqr=function(a){return a.dot(a)};this.lerp=function(a,d,c,b){a.x=d.x+(c.x-d.x)*b;a.y=d.y+(c.y-d.y)*b};this.normalize=function(a){var b=a.length();a.x=a.x/b;a.y=a.y/b}};function Area2(b,a){var c=this;c.topleft=b;c.botright=a}window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1000/60)}})();function deepCopy(d){if(Object.prototype.toString.call(d)==="[object Array]"){var b=[],c=0,a=d.length;for(;c<a;c++){b[c]=arguments.callee(d[c])}return b}if(typeof d==="object"){var b={},c;for(c in d){b[c]=arguments.callee(d[c])}return b}return d}var b2Vec2=Box2D.Common.Math.b2Vec2,b2AABB=Box2D.Collision.b2AABB,b2BodyDef=Box2D.Dynamics.b2BodyDef,b2Body=Box2D.Dynamics.b2Body,b2FixtureDef=Box2D.Dynamics.b2FixtureDef,b2Fixture=Box2D.Dynamics.b2Fixture,b2World=Box2D.Dynamics.b2World,b2MassData=Box2D.Collision.Shapes.b2MassData,b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,b2DebugDraw=Box2D.Dynamics.b2DebugDraw,b2MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef;var yTouch=function(){var a=this;a.isTouched=false;a.wasTouched=false;a.position=new Vec2(-1,-1);a.lastPosition=new Vec2(-1,-1);a.wasMoved=false;yTouch.prototype.update=function(){a.wasTouched=a.isTouched;a.lastPosition=deepCopy(a.position);if(a.position.x!=a.lastPosition.x||a.position.y!=a.lastPosition.y){a.wasMoved=true}else{a.wasMoved=false}}};var game;var canvas;var ctx;var delta=0;var input;var x=10;var world=new b2World(new b2Vec2(0,2),true);var physicsDelta=1/30;var accumulator=0;var entities=[];var yGame=function(){var f=this;var d=Date.now();f.gameState=new yGameState();f.camera=null;var g=new b2FixtureDef;g.density=1;g.friction=0.5;g.restitution=0.2;var b=new b2BodyDef;b.type=b2Body.b2_staticBody;g.shape=new b2PolygonShape;g.shape.SetAsBox(canvas.width,2);b.position.Set(2,canvas.height-2);world.CreateBody(b).CreateFixture(g);b.position.Set(0,2);world.CreateBody(b).CreateFixture(g);g.shape.SetAsBox(2,canvas.height);b.position.Set(canvas.width-2,2);world.CreateBody(b).CreateFixture(g);b.position.Set(2,2);world.CreateBody(b).CreateFixture(g);graphic=new Image();graphic.src="test.png";b.type=b2Body.b2_dynamicBody;for(var c=0;c<10;++c){g.shape=new b2CircleShape(15);b.position.x=Math.random()*canvas.width;b.position.y=Math.random()*canvas.height;var a=world.CreateBody(b);var e=a.CreateFixture(g);entities.push(new yEntity(graphic,a,e))}var h=new b2DebugDraw();h.SetSprite(canvas.getContext("2d"));h.SetDrawScale(1);h.SetFillAlpha(0.5);h.SetLineThickness(1);h.SetFlags(b2DebugDraw.e_shapeBit|b2DebugDraw.e_jointBit);world.SetDebugDraw(h);yGame.prototype.update=function(){var j=Date.now();delta=j-d;d=j;accumulator+=physicsDelta;f.gameState.update();while(accumulator>physicsDelta){world.Step(physicsDelta,10,10);accumulator-=physicsDelta}world.ClearForces();if(x<canvas.width-20){x+=0.5*delta}if(input.isDown(input.mouseLeft)||input.touches[0].isTouched){if(x>0){x-=delta}}for(var k=0;k<entities.length;k++){entities[k].update()}input.update()};yGame.prototype.draw=function(){ctx.fillStyle="rgb(255, 255, 255)";ctx.fillRect(0,0,canvas.width,canvas.height);requestAnimFrame(f.draw);f.gameState.draw();ctx.fillStyle="rgb("+Math.floor(255-255*(x/canvas.width))+","+Math.ceil(255*(x/canvas.width))+",0)";ctx.fillRect(10,10,Math.floor(x),canvas.height-20);ctx.fillStyle="#000";ctx.font="20px Arial";ctx.fillText("X: "+input.mousePosition.x+"   Y: "+input.mousePosition.y,100,30);var k=0;for(var j=0;j<input.touches.length;j++){if(input.touches[j].isTouched){k++}}ctx.fillText("Touches: "+k,100,60);for(var j=0;j<entities.length;j++){entities[j].draw()}};setInterval(f.update,1);window.requestAnimFrame(f.draw)};window.addEventListener("load",function(){canvas=document.createElement("canvas");canvas.width=window.innerWidth;canvas.height=window.innerHeight;ctx=canvas.getContext("2d");document.body.appendChild(canvas);input=new yInputManager();game=new yGame()},false);var yGameState=function(){var a=this;a.layers=new Array();a.layers.push(new yLayer());yGameState.prototype.update=function(){for(var b=0;b<a.layers.length;b++){a.layers[b].update()}};yGameState.prototype.draw=function(){for(var b=0;b<a.layers.length;b++){a.layers[b].draw()}}};var yLayer=function(){var a=this;yLayer.prototype.update=function(){};yLayer.prototype.draw=function(){}};var yInputManager=function(){var b=this;b.keyState=[];b.lastKeyState=[];b.touches=[];b.lastTouches=[];for(var a=0;a<10;a++){b.touches[a]=new yTouch()}b.mousePosition=new Vec2(-1,-1);for(var a=0;a<300;a++){b.keyState[a]=false;b.lastKeyState[a]=false}b.mouseLeft=0;b.mouseRight=2;b.mouseMiddle=1;b.BACKSPACE=8;b.TAB=9;b.ENTER=13;b.SHIFT=16;b.CTRL=17;b.ALT=18;b.PAUSE=19;b.CAPS=20;b.ESCAPE=27;b.PAGEUP=33;b.PAGEDOWN=34;b.END=35;b.HOME=36;b.LEFT=37;b.UP=38;b.RIGHT=39;b.DOWN=40;b.INSERT=45;b.DELETE=46;b.ZERO=48;b.ONE=49;b.TWO=50;b.THREE=51;b.FOUR=52;b.FIVE=53;b.SIX=54;b.SEVEN=55;b.EIGHT=56;b.NINE=57;b.A=65;b.B=66;b.C=67;b.D=68;b.E=69;b.F=70;b.G=71;b.H=72;b.I=73;b.J=74;b.K=75;b.L=76;b.M=77;b.N=78;b.O=79;b.P=80;b.Q=81;b.R=82;b.S=83;b.T=84;b.U=85;b.V=86;b.W=87;b.X=88;b.Y=89;b.Z=90;b.WINDOWsLEFT=91;b.WINDOWSRIGHT=92;b.SELECT=93;b.NUMZERO=96;b.NUMONE=97;b.NUMTWO=98;b.NUMTHREE=99;b.NUMFOUR=100;b.NUMFIVE=101;b.NUMSIX=102;b.NUMSEVEN=103;b.NUMEIGHT=104;b.NUMNINE=105;b.MULTIPLY=106;b.ADD=107;b.SUBTRACT=109;b.DECIMALPOINT=110;b.DIVIDE=111;b.F1=112;b.F2=113;b.F3=114;b.F4=115;b.F5=116;b.F6=117;b.F7=118;b.F8=119;b.F9=120;b.F10=121;b.F11=122;b.F12=123;b.NUMLOCK=144;b.SCROLLLOCK=145;b.SEMICOLON=186;b.EQUALSIGN=187;b.COMMA=188;b.DASH=189;b.PERIOD=190;b.FORWARDSLASH=191;b.GRAVEACCENT=192;b.OPENBRACKET=219;b.BACKSLASH=220;b.CLOSEBRACKET=221;b.SINGLEQUOTE=222;yInputManager.prototype.isDown=function(c){return b.keyState[c]};yInputManager.prototype.isUp=function(c){return !b.keyState[c]};yInputManager.prototype.isReleased=function(c){return(!b.keyState[c]&&b.lastKeyState[c])};yInputManager.prototype.isAreaPressed=function(d){if(b.mousePosition.x>d.topleft.x&&b.mousePosition.y>d.topleft.y&&b.mousePosition.x<d.botright.x&&b.mousePosition.y<d.botright.y){return true}for(var c=0;c<b.touches.length;c++){var e=b.touches[c];if(e.isTouched){if(e.position.x>d.topleft.x&&e.position.y>d.topleft.y&&e.position.x<d.botright.x&&e.position.y<d.botright.y){return true}}}return false};yInputManager.prototype.isAreaPressed=function(d){if(b.isDown(b.mouseLeft)&&b.mousePosition.x>d.topleft.x&&b.mousePosition.y>d.topleft.y&&b.mousePosition.x<d.botright.x&&b.mousePosition.y<d.botright.y){return true}for(var c=0;c<b.touches.length;c++){var e=b.touches[c];if(e.isTouched){if(e.position.x>d.topleft.x&&e.position.y>d.topleft.y&&e.position.x<d.botright.x&&e.position.y<d.botright.y){return true}}}return false};yInputManager.prototype.isAreaReleased=function(d){if(b.isReleased(b.mouseLeft)&&b.mousePosition.x>d.topleft.x&&b.mousePosition.y>d.topleft.y&&b.mousePosition.x<d.botright.x&&b.mousePosition.y<d.botright.y){return true}for(var c=0;c<b.touches.length;c++){var e=b.touches[c];if(e.wasTouched&&!e.isTouched){if(e.position.x>d.topleft.x&&e.position.y>d.topleft.y&&e.position.x<d.botright.x&&e.position.y<d.botright.y){return true}}}return false};yInputManager.prototype.onKeydown=function(c){b.keyState[c.keyCode]=true};yInputManager.prototype.onKeyup=function(c){b.keyState[c.keyCode]=false};yInputManager.prototype.onMouseDown=function(c){b.keyState[c.button]=true;c.preventDefault()};yInputManager.prototype.onMouseUp=function(c){b.keyState[c.button]=false;c.preventDefault()};yInputManager.prototype.onMouseMove=function(c){b.mousePosition.x=c.clientX;b.mousePosition.y=c.clientY};yInputManager.prototype.onTouchStart=function(d){for(var c=0;c<d.changedTouches.length;c++){var e=d.changedTouches[c].identifier;if(b.touches[e]==null){b.touches[e]=new yTouch()}b.touches[e].isTouched=true;if(c==0){b.keyState[b.mouseLeft]=true}}d.preventDefault()};yInputManager.prototype.onTouchEnd=function(d){for(var c=0;c<d.changedTouches.length;c++){var e=d.changedTouches[c].identifier;if(b.touches[e]==null){b.touches[e]=new yTouch()}b.touches[e].isTouched=false;if(c==0){b.keyState[b.mouseLeft]=false}}d.preventDefault()};yInputManager.prototype.onTouchMove=function(d){for(var c=0;c<d.changedTouches.length;c++){b.touches[d.changedTouches[c].identifier].position.x=d.changedTouches[c].pageX;b.touches[d.changedTouches[c].identifier].position.y=d.changedTouches[c].pageY;if(c==0){b.mousePosition.x=d.changedTouches[c].pageX;b.mousePosition.y=d.changedTouches[c].pageY}}d.preventDefault()};yInputManager.prototype.update=function(){b.lastKeyState=deepCopy(b.keyState);for(var c=0;c<b.lastTouches.length;c++){b.touches[c].update()}};canvas.addEventListener("keyup",b.onKeyup,false);canvas.addEventListener("keydown",b.onKeydown,false);canvas.addEventListener("touchstart",b.onTouchStart,true);canvas.addEventListener("touchmove",b.onTouchMove,true);canvas.addEventListener("touchend",b.onTouchEnd,true);canvas.addEventListener("touchleave",b.onTouchEnd,true);canvas.addEventListener("touchcancel",b.onTouchEnd,true);canvas.addEventListener("mousedown",b.onMouseDown,true);canvas.addEventListener("mousemove",b.onMouseMove,true);canvas.addEventListener("mouseup",b.onMouseUp,true)};var ySoundManager=function(){var a=this};var yEntity=function(a,b,d){var c=this;c.sprite=a;c.physModel=b;c.position=new Vec2(c.physModel.GetPosition().x,c.physModel.GetPosition().y);c.fixture=d;yEntity.prototype.update=function(){};yEntity.prototype.draw=function(){ctx.drawImage(this.sprite,c.physModel.GetPosition().x-15,c.physModel.GetPosition().y-15)}};var yCamera=function(){var a=this;a.position=$V([0,0])};var ySprite=function(a){var b=this;this.sprite=new Image();this.sprite.src=a;yGameState.prototype.draw=function(){for(layer in b.layers){layer.draw()}}};var ySpriteSheet=function(){var a=this};var yAnimation=function(){var a=this};var yTileMap=function(){var a=this};var yTileSet=function(){var a=this};var yTimer=function(){var a=this};var ySound=function(){var a=this};var yMusic=function(){var a=this};